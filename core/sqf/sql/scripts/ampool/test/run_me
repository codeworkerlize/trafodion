# Test basic monarch apis

function do_it {
  echo "####### Execute: $* ===="

  $*
}

function jdo {
  do_it java io.esgyn.client.$1 $2 $3 $4 $5 $6 $7 $8 $9
}

lv_start_time=`date`
lv_arg="N"

echo $1
if [[ ! -z $1 ]]; then
if [[ $1 == "Y" ]]; then
   lv_arg="Y"
   shift
fi
fi
echo "lv_arg = ${lv_arg}"

if [[ ${lv_arg} == "Y" ]]; then
  do_it ampool_restart
fi

export EM_TESTS_JAR=$TRAF_HOME/src/seatrans/monarch/target/esgyn_monarch-trx-${TRAFODION_VER}-tests.jar
export CLASSPATH=${CLASSPATH}:${EM_TESTS_JAR}

jdo MTableDelete -t EmployeeTable
jdo MTableCPSetup -t EmployeeTable
jdo MTableCPSetup -v -n 1000 -l -P 1000-row -t EmployeeTable
jdo CPTInfo -t EmployeeTable
jdo MTableCPSetup -v -n 1000 -l -P rowkey-1 -t EmployeeTable
jdo CPTInfo -t EmployeeTable
jdo CPCounter -t EmployeeTable

jdo MTableDelete -t EmployeeTable2
jdo MTableCPSetup -t EmployeeTable2
jdo MTableCPSetup -t EmployeeTable2 -l -n 10 -P 8000-row
jdo CPTInfo -t EmployeeTable2
jdo MTableCPSetup -t EmployeeTable2 -l -n 10 -P MMMM-row
jdo CPTInfo -t EmployeeTable2
jdo CPCounter -t EmployeeTable2

# Check if the current bash argument is to do a 'S[hort]' run
if [[ ! -z $1 ]]; then
if [[ $1 == "S" ]]; then
  return 0
fi
fi

jdo CPNumTransactions -t EmployeeTable
jdo CPNumTransactions -t EmployeeTable2

jdo CPCheckAndPut -t EmployeeTable -x 101 -k 10100
jdo CPCheckAndPut -t EmployeeTable -x 101 -k 10100
jdo CPCheckAndPut -t EmployeeTable2 -x 506 -k 50600
jdo CPCheckAndPut -t EmployeeTable -x 102 -k 10200
jdo CPCheckAndPut -t EmployeeTable -x 103 -k 10300

jdo CPNumTransactions -t EmployeeTable
jdo CPNumTransactions -t EmployeeTable2
jdo CPTransactionList -t EmployeeTable
jdo CPTransactionList -t EmployeeTable2

jdo CPPrepare -t EmployeeTable -x 101 -k 10100
jdo CPTransactionList -t EmployeeTable
jdo CPCommit  -t EmployeeTable -x 101 -k 10100
jdo CPCounter -t EmployeeTable

jdo CPTransactionList -t EmployeeTable
jdo CPCommit  -t EmployeeTable -x 102 -k 10200
jdo CPTransactionList -t EmployeeTable
jdo CPAbort  -t EmployeeTable -x 102 -k 10200
jdo CPTransactionList -t EmployeeTable

jdo CPPut -t EmployeeTable -x 107 -k 89900
jdo CPPut -t EmployeeTable -x 107 -k 89901
jdo CPTransactionList -t EmployeeTable
jdo CPPrepare -t EmployeeTable -x 107 -k 89900
jdo CPTransactionList -t EmployeeTable
jdo CPCommit -t EmployeeTable -x 107 -k 89900
jdo CPTransactionList -t EmployeeTable
jdo CPCounter -t EmployeeTable

jdo CPPrepare -t EmployeeTable2 -x 506 -k 50600
jdo CPTransactionList -t EmployeeTable2
jdo CPCommit -t EmployeeTable2 -x 506 -k 50600
jdo CPTransactionList -t EmployeeTable2
jdo CPCounter -t EmployeeTable2

jdo CPPut -t EmployeeTable -x 108 -k 89905
jdo CPCheckAndPut -t EmployeeTable -x 108 -k 89906
jdo CPGet -t EmployeeTable -x 108 -k 89906
jdo CPTransactionList -t EmployeeTable
jdo CPPut -t EmployeeTable2 -x 108 -k 89907
jdo CPGet -t EmployeeTable2 -x 108 -k 89907
jdo CPPrepare -t EmployeeTable -x 108 -k 89905
jdo CPPrepare -t EmployeeTable2 -x 108 -k 89907
jdo CPTransactionList -t EmployeeTable
jdo CPTransactionList -t EmployeeTable2
jdo CPCommit -t EmployeeTable -x 108 -k 89905
jdo CPCommit -t EmployeeTable2 -x 108 -k 89907
jdo CPCounter -t EmployeeTable
jdo CPCounter -t EmployeeTable2

jdo CPPut -t EmployeeTable -x 110 -k 89908
jdo CPPrepare -t EmployeeTable -x 110 -k 89908
jdo CPCommit -t EmployeeTable -x 110 -k 89908
jdo CPCounter -t EmployeeTable

jdo CPPut -t EmployeeTable -x 111 -k 89909
jdo CPPrepare -t EmployeeTable -x 111 -k 89909
jdo CPCommit -t EmployeeTable -x 111 -k 89909
jdo CPCounter -t EmployeeTable

jdo CPCheckAndPut -t EmployeeTable -x 112 -k 89910
jdo CPPrepare -t EmployeeTable -x 112 -k 89910
jdo CPCommit -t EmployeeTable -x 112 -k 89910
jdo CPCounter -t EmployeeTable

# Disabled for the time being. MTable.delete(MDelete) has issues.
jdo CPDelete -t EmployeeTable -x 113 -k 89909
jdo CPPrepare -t EmployeeTable -x 113 -k 89909
jdo CPCommit -t EmployeeTable -x 113 -k 89909
jdo CPCounter -t EmployeeTable

# Clear up one transaction left around
jdo CPAbort -x 103 -t EmployeeTable -k 10300

jdo CPNumCalls -t EmployeeTable
echo "Start time: ${lv_start_time}"
echo "End time  : `date`"
