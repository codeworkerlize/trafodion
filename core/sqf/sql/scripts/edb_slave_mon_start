#!/bin/bash

if [[ -z $TRAF_HOME ]]; then
    echo
    echo "The TRAF_HOME environment variable does not exist."
    echo "Please ensure sqenv.sh has been sourced."
    echo
    exit 1;
fi

if [ -z ${MASTER_MONITOR_HOST} ]; then
    echo "Please set the variable MASTER_MONITOR_HOST"
    exit 1;
fi
if [ -z ${MONITOR_COMM_PORT} ]; then
    echo "Please set the variable MONITOR_COMM_PORT"
    exit 1;
fi

cd $TRAF_HOME/sql/scripts

LOG_FILE="slave_monitor_startup.log"

edb_startup_cleanup >> ${LOG_FILE} 2>&1
lv_ret=$?
echo "`date`:edb_startup_cleanup done, return code= ${lv_ret}" >> ${LOG_FILE}
if [[ ${lv_ret} != 0 ]]; then
    echo "`date`: Exitting..." >> ${LOG_FILE}
    exit $lv_ret
fi

echo "`date`: starting monitor" >> ${LOG_FILE}
monitor COLD_AGENT &
lv_ret=$?
echo "`date`:monitor startup done, return code= ${lv_ret}" >> ${LOG_FILE}

jobs | tee -a ${LOG_FILE}
disown %1

sleep 2
sqcheckmon >> ${LOG_FILE}
let lv_checkmon_ret=$?

exit ${lv_checkmon_ret}
