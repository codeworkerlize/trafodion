#!/bin/bash
#
function Usage {
    echo 
    echo "Usage: $0 <program>"
}

if [ $# -lt 1 ]; then
    Usage;
    exit 1;
elif [ "$1" = "--help" ]; then
    Usage;
    exit 0;
else
    prog=$1
fi

echo "lsof of all the $prog processes"
w=`whoami`

hosts=$(trafconf -name)


progall=0
proglist=$prog

for host in $hosts; do
    if [ -e $SQ_PDSH ]; then
	ssh="edb_pdsh -w $host"
    fi
    echo $ssh
    for prog in $proglist; do
	pids=`pstat | grep -w $prog |awk '{ print $2 }'`
#	echo $pids
	for pid in $pids; do
	    echo -n "$pid : "
	    $ssh lsof -p $pid | wc -l
	done
	echo "--"
    done
done
