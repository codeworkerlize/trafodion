#!/usr/bin/env bash

function print_usage() {
    echo "usage: atrxdc_start_replay [options]"
    echo "description: start binlog replayer"
    echo "options:"
    echo "  bcstr: optional, format: binlog zk quorum ip list:[zk port]"
    echo "         zk port is optional, default is 2181"
    echo "  -h   : print this help message."
    echo "example:"
    echo "  atrxdc_start_replay"
    echo "  atrxdc_start_replay somehost"
}

if [[ $# > 1 ]] || [[ $1 == "-h" ]]; then
    print_usage
    exit 1
fi
lv_stderr_file="$TRAF_LOG/atrxdc.log"
atrxdc start replayer $1 2>${lv_stderr_file}

if [[ $? != 0  ]]; then
    exit $?
fi

sleep 2
pname=`ps -af | grep HBaseBinlogReplayer | grep -v grep`
if [[ $pname == "" ]]; then
    echo "replayer start failed"
    echo "look for details on $TRAF_LOG/"
else
    echo "replayer started:"
fi

atrxdc start seqreplayer $1 2>>${lv_stderr_file}

if [[ $? != 0  ]]; then
    exit $?
fi

sleep 2
pname=`ps -af | grep TrafHbaseTableReplayer | grep -v grep`
if [[ $pname == "" ]]; then
    echo "sequence replayer start failed"
    echo "look for details on $TRAF_LOG/"
else
    echo "sequence replayer started:"
    atrxdc check
fi

