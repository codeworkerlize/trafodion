>>
>>?section clnup
>>set schema trafodion.lob132;

--- SQL operation complete.
>>drop table if exists t132lob1 cascade;

--- SQL operation complete.
>>drop table if exists t132lob2 cascade;

--- SQL operation complete.
>>drop table if exists t132srclob cascade;

--- SQL operation complete.
>>drop table if exists t132tgtlob cascade;

--- SQL operation complete.
>>drop schema if exists trafodion.lob132 cascade;

--- SQL operation complete.
>>
>>?section setup
>>cqd traf_lob_version2 'ON';

--- SQL operation complete.
>>cqd traf_lob_inlined_data_maxbytes '40';

--- SQL operation complete.
>>
>>create schema if not exists trafodion.lob132;

--- SQL operation complete.
>>create table if not exists t132lob1 (c1 int not null, c2 blob, primary key (c1));

--- SQL operation complete.
>>create table if not exists t132lob2 ( c2 clob(10));

--- SQL operation complete.
>>create table if not exists t132srclob (c1 int not null, c2 blob, c3 blob, primary key (c1));

--- SQL operation complete.
>>create table if not exists t132tgtlob (c1 int not null, c2 blob, c3 blob, primary key (c1));

--- SQL operation complete.
>>
>>?section inline_insert
>>--insert 4 rows which fit inline
>>insert into t132lob1 values (1, stringtolob('inserted inline row1'));

--- 1 row(s) inserted.
>>insert into t132lob1 values (2, stringtolob('inserted inline row2'));

--- 1 row(s) inserted.
>>insert into t132lob1 values (3, stringtolob('inserted inline row3'));

--- 1 row(s) inserted.
>>insert into t132lob1 values (4, stringtolob('inserted inline row4'));

--- 1 row(s) inserted.
>>select lobtostring(c2,40)from t132lob1;

(EXPR)                                  
----------------------------------------

inserted inline row1                    
inserted inline row2                    
inserted inline row3                    
inserted inline row4                    

--- 4 row(s) selected.
>>
>>
>>--test limit 
>>insert into t132lob2 values (stringtolob('ffffffffffffffff'));

*** ERROR[8442] Unable to access ExpLOBinsert:evalV2 interface. Call to ExpLOBinsert:evalV2 returned error LOB_MAX_LIMIT_ERROR(561). Error detail: -99999. Cause: .

--- 0 row(s) inserted.
>>insert into t132lob2 values (stringtolob('ffff'));

--- 1 row(s) inserted.
>>select lobtostring(c2,8) from t132lob2;

(EXPR)  
--------

ffff    

--- 1 row(s) selected.
>>update t132lob2 set c2=stringtolob('ggggggggggggggggggggggg');

*** ERROR[8442] Unable to access ExpLOBupdate:evalV2 interface. Call to ExpLOBupdate:evalV2 returned error LOB_MAX_LIMIT_ERROR(561). Error detail: -99999. Cause: .

--- 0 row(s) updated.
>>delete from t132lob2;

--- 1 row(s) deleted.
>>insert into t132lob2 values (stringtolob('ffff'));

--- 1 row(s) inserted.
>>select lobtostring(c2,8) from t132lob2;

(EXPR)  
--------

ffff    

--- 1 row(s) selected.
>>update t132lob2 set c2=stringtolob('ggggggggggggggggggggggg',append);

*** ERROR[8442] Unable to access ExpLOBupdate:evalV2 interface. Call to ExpLOBupdate:evalV2 returned error LOB_MAX_LIMIT_ERROR(561). Error detail: -99999. Cause: .

--- 0 row(s) updated.
>>delete from t132lob2;

--- 1 row(s) deleted.
>>
>>
>>?section inline_update
>>-- update one row inline
>>update t132lob1 set c2=stringtolob('updating inline row1')where c1 =1;

--- 1 row(s) updated.
>>select lobtostring(c2,40)from t132lob1;

(EXPR)                                  
----------------------------------------

updating inline row1                    
inserted inline row2                    
inserted inline row3                    
inserted inline row4                    

--- 4 row(s) selected.
>>
>>--append one row inline
>>update t132lob1 set c2=stringtolob('upd row2',append) where c1=2;

--- 1 row(s) updated.
>>select lobtostring(c2,40)from t132lob1;

(EXPR)                                  
----------------------------------------

updating inline row1                    
inserted inline row2upd row2            
inserted inline row3                    
inserted inline row4                    

--- 4 row(s) selected.
>>
>>?section outline_update
>>--update row transitioning from inline to outline
>>update t132lob1 set c2=stringtolob('updating a string that will overflow the inline limit and will be stored in hdfs') where c1=3;

--- 1 row(s) updated.
>>select lobtostring(c2,100)from t132lob1;

(EXPR)
----------------------------------------------------------------------------------------------------

updating inline row1                                                                                
inserted inline row2upd row2                                                                        
updating a string that will overflow the inline limit and will be stored in hdfs                    
inserted inline row4                                                                                

--- 4 row(s) selected.
>>
>>--append one row outline
>>update t132lob1 set c2=stringtolob('updating a string that will overflow the inline limit and will be stored in hdfs',append) where c1=4;

--- 1 row(s) updated.
>>select lobtostring(c2,100)from t132lob1;

(EXPR)
----------------------------------------------------------------------------------------------------

updating inline row1                                                                                
inserted inline row2upd row2                                                                        
updating a string that will overflow the inline limit and will be stored in hdfs                    
inserted inline row4updating a string that will overflow the inline limit and will be stored in hdfs

--- 4 row(s) selected.
>>
>>--transition back to inline for both rows
>>
>>update t132lob1 set c2=stringtolob('updating inline row3') where c1=3;

--- 1 row(s) updated.
>>update t132lob1 set c2=stringtolob('updating inline row4') where c1=4;

--- 1 row(s) updated.
>>select lobtostring(c2,100)from t132lob1 where c1=3;

(EXPR)
----------------------------------------------------------------------------------------------------

updating inline row3                                                                                

--- 1 row(s) selected.
>>select lobtostring(c2,100)from t132lob1 where c1=4;

(EXPR)
----------------------------------------------------------------------------------------------------

updating inline row4                                                                                

--- 1 row(s) selected.
>>select * from t132lob1;

C1           C2
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH00010002000104006719423025686062000000004800000000000400671942307271236000000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH00010002000104006719423025686062000000004800000000000400671942307273090800000000000000000002                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          3  LOBH00010002000104006719423025686062000000004800000000000400671942307273976000000000000000000003                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          4  LOBH00010002000104006719423025686062000000004800000000000400671942307274847600000000000000000004                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 4 row(s) selected.
>>
>>?section empty_update
>>update t132lob1 set c2=empty_blob();

--- 4 row(s) updated.
>>--empty_blob to inline
>>update t132lob1 set c2=stringtolob('update empty to inline') where c1=1;

--- 1 row(s) updated.
>>select lobtostring(c2,40)from t132lob1;

(EXPR)                                  
----------------------------------------

update empty to inline                  
                                        
                                        
                                        

--- 4 row(s) selected.
>>select * from t132lob1;

C1           C2
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH00010002000104006719423025686062000000004800000000000400671942307271236000000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH00010002000104006719423025686062000000000000000000000400671942307273090800000000000000000002                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          3  LOBH00010002000104006719423025686062000000000000000000000400671942307273976000000000000000000003                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          4  LOBH00010002000104006719423025686062000000000000000000000400671942307274847600000000000000000004                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 4 row(s) selected.
>>--empty_blob to outline
>>update t132lob1 set c2=stringtolob('update empty to inline') where c1=2;

--- 1 row(s) updated.
>>update t132lob1 set c2=stringtolob('updating a string that will overflow the inline limit and will be stored in hdfs',append) where c1=2;

--- 1 row(s) updated.
>>select lobtostring(c2,100)from t132lob1;

(EXPR)
----------------------------------------------------------------------------------------------------

update empty to inline                                                                              
update empty to inlineupdating a string that will overflow the inline limit and will be stored in hd
                                                                                                    
                                                                                                    

--- 4 row(s) selected.
>>select * from t132lob1;

C1           C2
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH00010002000104006719423025686062000000004800000000000400671942307271236000000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH00010002000104006719423025686062000000004800000000000400671942307273090800000000000000000002                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          3  LOBH00010002000104006719423025686062000000000000000000000400671942307273976000000000000000000003                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          4  LOBH00010002000104006719423025686062000000000000000000000400671942307274847600000000000000000004                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 4 row(s) selected.
>>
>>--insert-select
>>--insert 2 rows. 1 inline and 1 outline in each row
>>insert into t132srclob values (1,stringtolob('c2_inline'), stringtolob('c3_outline_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'));

--- 1 row(s) inserted.
>>insert into t132srclob values (2,stringtolob('c2_outline_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'), stringtolob('c3_inline'));

--- 1 row(s) inserted.
>>select * from t132srclob;

C1           C2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                C3
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH00010002000104006719423025687791000000004800000000000400671942307985295400000000000000000007                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LOBH00010002000204006719423025687791000000004800000000000400671942307985297500000000000000000008                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH00010002000104006719423025687791000000004800000000000400671942308142131800000000000000000009                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LOBH00010002000204006719423025687791000000004800000000000400671942308170502800000000000000000010                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 2 row(s) selected.
>>insert into t132tgtlob select * from t132srclob;

--- 2 row(s) inserted.
>>select * from t132tgtlob;

C1           C2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                C3
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH00010002000104006719423025688618000000004800000000000400671942308208134700000000000000000011                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LOBH00010002000204006719423025688618000000004800000000000400671942308364238700000000000000000012                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH00010002000104006719423025688618000000004800000000000400671942308417418000000000000000000013                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  LOBH00010002000204006719423025688618000000004800000000000400671942308449208800000000000000000014                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 2 row(s) selected.
>>select lobtostring(c2,40), lobtostring(c3,40) from t132tgtlob;

(EXPR)                                    (EXPR)
----------------------------------------  ----------------------------------------

c2_inline                                 c3_outline_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
c2_outline_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx  c3_inline                               

--- 2 row(s) selected.
>>
>>obey TEST132(clnup);
>>set schema trafodion.lob132;

--- SQL operation complete.
>>drop table if exists t132lob1 cascade;

--- SQL operation complete.
>>drop table if exists t132lob2 cascade;

--- SQL operation complete.
>>drop table if exists t132srclob cascade;

--- SQL operation complete.
>>drop table if exists t132tgtlob cascade;

--- SQL operation complete.
>>drop schema if exists trafodion.lob132 cascade;

--- SQL operation complete.
>>
>>
>>log;
