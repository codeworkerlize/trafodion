>>
>>cqd TRAF_LOB_VERSION2 'OFF';

--- SQL operation complete.
>>set envvar TESTNUM '130';

--- SQL operation complete.
>>
>>initialize trafodion, create lob metadata;

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(clnup);
>>set schema trafodion.lob$$TESTNUM$$;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob1 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob2 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob3 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob4 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob5 cascade;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$ext cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$char cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$var cascade;

--- SQL operation complete.
>>drop table if exists myloben cascade;

--- SQL operation complete.
>>drop external table if exists date_dim for hive.hive.date_dim;

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(setup);
>>drop schema if exists trafodion.lob$$TESTNUM$$ cascade;

--- SQL operation complete.
>>create schema trafodion.lob$$TESTNUM$$;

--- SQL operation complete.
>>set schema trafodion.lob$$TESTNUM$$;

--- SQL operation complete.
>>create table t$$TESTNUM$$lob1 (c1 blob);

--- SQL operation complete.
>>create table t$$TESTNUM$$lob2 (c1 int not null, c2 blob , primary key (c1));

--- SQL operation complete.
>>create table t$$TESTNUM$$lob3 (c1 int not null,
+>c2 blob, c3 blob, primary key (c1));

--- SQL operation complete.
>>create table t$$TESTNUM$$lob4 (c1 int not null,
+>c2 char(10), c3 clob(10M) , primary key (c1));

--- SQL operation complete.
>>create table t$$TESTNUM$$lob5 (c1 int not null,
+>c2 clob(10M) character set utf8, c3 clob(20M) character set iso88591 , primary key (c1));

--- SQL operation complete.
>>create table t$$TESTNUM$$char(c1 int not null, c2 char (20), primary key (c1));

--- SQL operation complete.
>>create table t$$TESTNUM$$var(c1 int not null, c2 varchar(100), primary key (c1));

--- SQL operation complete.
>>create external table date_dim
+>  (d_date_sk int, d_date_id varchar(100 bytes) character set utf8, d_date date)
+>  for hive.hive.date_dim;

--- SQL operation complete.
>>
>>sh cp -f $scriptsdir/executor/TEST$$TESTNUM$$_argfile* $rundir/executor/;
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(dml_insert);
>>insert into t$$TESTNUM$$lob1 values(NULL);

--- 1 row(s) inserted.
>>select * from t$$TESTNUM$$lob1;

C1
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

--- 1 row(s) selected.
>>delete from t$$TESTNUM$$lob2;

--- 0 row(s) deleted.
>>insert into t$$TESTNUM$$lob2 values(1,stringtolob('inserted row11'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values(2,stringtolob('inserted row12'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values(3,stringtolob('inserted row13'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values(3,stringtolob('xxxx'));

*** ERROR[8102] The operation is prevented by a unique constraint.

--- 0 row(s) inserted.
>>select * from t$$TESTNUM$$lob2;

C1           C2
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH0000000200010820746102937090992519820746102951816332518212445791027440378016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH0000000200010820746102937090992519820746102951956021418212445791030082580016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          3  LOBH0000000200010820746102937090992519820746102951962376018212445791030147324016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 3 row(s) selected.
>>select lobtostring(c2,10) from t$$TESTNUM$$lob2;

(EXPR)    
----------

inserted r
inserted r
inserted r

--- 3 row(s) selected.
>>select lobtostring(c2,2) from t$$TESTNUM$$lob2;

(EXPR)
------

in    
in    
in    

--- 3 row(s) selected.
>>select c1,lobtostring(c2,100) from t$$TESTNUM$$lob2;

C1           (EXPR)
-----------  ----------------------------------------------------------------------------------------------------

          1  inserted row11                                                                                      
          2  inserted row12                                                                                      
          3  inserted row13                                                                                      

--- 3 row(s) selected.
>>
>>delete from t$$TESTNUM$$lob2;

--- 3 row(s) deleted.
>>--test insert with param (assumes that caller will pass in string format.)
>>prepare s from insert into t$$TESTNUM$$lob2 values (1, ?);

--- SQL command prepared.
>>execute s using 'fgfgfhfhfhfhhfhfhfhjfkkfkffllflflfll';

--- 1 row(s) inserted.
>>select lobtostring(c2,50) from t$$TESTNUM$$lob2;

(EXPR)                                            
--------------------------------------------------

fgfgfhfhfhfhhfhfhfhjfkkfkffllflflfll              

--- 1 row(s) selected.
>>
>>-- this will succeed
>>prepare s from insert into t$$TESTNUM$$lob2 values (1,'gg');

--- SQL command prepared.
>>prepare s from insert into t$$TESTNUM$$lob2 values (2,'hh');

--- SQL command prepared.
>>
>>--negative test for values tuple list
>>prepare s from insert into t$$TESTNUM$$lob2 values (1,stringtolob('hh')),(2,stringtolob('gg'));

*** ERROR[4483] This LOB conversion function is not allowed in the VALUES clause with multiple input value rows. Use it with a single value row.

*** ERROR[8822] The statement was not prepared.

>>
>>--test update with param 
>>prepare s from update t$$TESTNUM$$lob2 set c2=? where c1 =1;

--- SQL command prepared.
>>execute s using 'xyxyxyxyxyxyx';

--- 1 row(s) updated.
>>select lobtostring(c2,50) from t$$TESTNUM$$lob2;

(EXPR)                                            
--------------------------------------------------

xyxyxyxyxyxyx                                     

--- 1 row(s) selected.
>>
>>--test insert select from a source char column to lob
>>delete from t$$TESTNUM$$lob2;

--- 1 row(s) deleted.
>>insert into t$$TESTNUM$$char values (1,'fixed char 1'),(2,'fixed char 2'),(3,'fixed char 3');

--- 3 row(s) inserted.
>>insert into t$$TESTNUM$$lob2(c1,c2) select c1,c2 from t$$TESTNUM$$char;

--- 3 row(s) inserted.
>>select lobtostring(c2,50) from t$$TESTNUM$$lob2;

(EXPR)                                            
--------------------------------------------------

fixed char 1                                      
fixed char 2                                      
fixed char 3                                      

--- 3 row(s) selected.
>>
>>--test insert select from a source varchar column to lob
>>delete from t$$TESTNUM$$lob2;

--- 3 row(s) deleted.
>>insert into t$$TESTNUM$$var values (1,'var char 1'),(2,'var char 22222222222222222222222'),(3,'var char 33333333333333333333333333333333333333333333333333333');

--- 3 row(s) inserted.
>>insert into t$$TESTNUM$$lob2(c1,c2) select c1,c2 from t$$TESTNUM$$var;

--- 3 row(s) inserted.
>>select lobtostring(c2,100) from t$$TESTNUM$$lob2;

(EXPR)
----------------------------------------------------------------------------------------------------

var char 1                                                                                          
var char 22222222222222222222222                                                                    
var char 33333333333333333333333333333333333333333333333333333                                      

--- 3 row(s) selected.
>>
>>--insert select from a source lob column to a target varchar column.
>>delete from t$$TESTNUM$$var;

--- 3 row(s) deleted.
>>insert into t$$TESTNUM$$var select c1, lobtostring(c2,100) from t$$TESTNUM$$lob2;

--- 3 row(s) inserted.
>>delete from t$$TESTNUM$$var;

--- 3 row(s) deleted.
>>----negative case
>>insert into t$$TESTNUM$$var select c1,c2 from t$$TESTNUM$$lob2;

*** ERROR[8414] The attempted conversion is not supported on this platform. Conversion of Source Type:BLOB(REC_BLOB) Source Value:0x000000000200000001000000F87F0000E5D4833B52C2E67118C97B4452C2E671A3BB7B4452C2F2021000545241464F44494F4E2E4C4F42313330000000000000 to Target Type:VARCHAR(100) CHARACTER SET ISO88591(REC_BYTE_V_ASCII).

--- 0 row(s) inserted.
>>delete from t$$TESTNUM$$var;

--- 0 row(s) deleted.
>>delete from t$$TESTNUM$$lob2;

--- 3 row(s) deleted.
>>
>>--test insert select from a source hive varchar column to lob
>>delete from t$$TESTNUM$$lob2;

--- 0 row(s) deleted.
>>insert into t$$TESTNUM$$lob2 select [first 10] d_date_sk,d_date_id from hive.hive.date_dim;

--- 10 row(s) inserted.
>>select lobtostring(c2,4) from t$$TESTNUM$$lob2 order by c1;

(EXPR)
------

AAAA  
AAAA  
AAAA  
AAAA  
AAAA  
AAAA  
AAAA  
AAAA  
AAAA  
AAAA  

--- 10 row(s) selected.
>>delete from t$$TESTNUM$$lob2;

--- 10 row(s) deleted.
>>
>>
>>--insert select from a source lob column to a target lob column
>>delete from t$$TESTNUM$$lob3;

--- 0 row(s) deleted.
>>insert into t$$TESTNUM$$lob2 values(1,stringtolob('inserted row11'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values(2,stringtolob('inserted row12'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values(3,stringtolob('inserted row13'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob3 select c1,c2,c2 from t$$TESTNUM$$lob2;

--- 3 row(s) inserted.
>>select c1, lobtostring(c2,100),lobtostring(c3,100) from t$$TESTNUM$$lob3;

C1           (EXPR)                                                                                                (EXPR)
-----------  ----------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------

          1  inserted row11                                                                                        inserted row11                                                                                      
          2  inserted row12                                                                                        inserted row12                                                                                      
          3  inserted row13                                                                                        inserted row13                                                                                      

--- 3 row(s) selected.
>>delete from t$$TESTNUM$$lob3;

--- 3 row(s) deleted.
>>delete from t$$TESTNUM$$lob2;

--- 3 row(s) deleted.
>>
>>
>>--test values clause
>>values((select * from t$$TESTNUM$$lob1));

C1
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

--- 1 row(s) selected.
>>
>>--test empty_blob(), empty_clob()
>>delete from t$$TESTNUM$$lob2;

--- 0 row(s) deleted.
>>insert into t$$TESTNUM$$lob2 values(0,stringtolob('inserted row10'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values (1, empty_blob());

--- 1 row(s) inserted.
>>select lobtostring(c2,10) from t$$TESTNUM$$lob2;

(EXPR)    
----------

inserted r
          

--- 2 row(s) selected.
>>delete from t$$TESTNUM$$lob2;

--- 2 row(s) deleted.
>>insert into t$$TESTNUM$$lob2 values(0,stringtolob('inserted row10'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob2 values (1, empty_clob());

--- 1 row(s) inserted.
>>select lobtostring(c2,10) from t$$TESTNUM$$lob2;

(EXPR)    
----------

inserted r
          

--- 2 row(s) selected.
>>update t$$TESTNUM$$lob2 set c2=stringtolob('inserted row11');

--- 2 row(s) updated.
>>select lobtostring(c2,30) from t$$TESTNUM$$lob2;

(EXPR)                        
------------------------------

inserted row11                
inserted row11                

--- 2 row(s) selected.
>>update t$$TESTNUM$$lob2 set c2=empty_blob();

--- 2 row(s) updated.
>>select lobtostring(c2,10) from t$$TESTNUM$$lob2;

(EXPR)    
----------

          
          

--- 2 row(s) selected.
>>update t$$TESTNUM$$lob2 set c2=stringtolob('inserted row11',append);

--- 2 row(s) updated.
>>select lobtostring(c2,30) from t$$TESTNUM$$lob2;

(EXPR)                        
------------------------------

inserted row11                
inserted row11                

--- 2 row(s) selected.
>>update t$$TESTNUM$$lob2 set c2=stringtolob('more inserted row11',append);

--- 2 row(s) updated.
>>select lobtostring(c2,50) from t$$TESTNUM$$lob2;

(EXPR)                                            
--------------------------------------------------

inserted row11more inserted row11                 
inserted row11more inserted row11                 

--- 2 row(s) selected.
>>update t$$TESTNUM$$lob2 set c2=empty_blob();

--- 2 row(s) updated.
>>select lobtostring(c2,10) from t$$TESTNUM$$lob2;

(EXPR)    
----------

          
          

--- 2 row(s) selected.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(dml_join);
>>insert into t$$TESTNUM$$lob3 values (1,stringtolob('inserted row21a'),stringtolob('inserted row21b'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob3 values (2,stringtolob('inserted row22a'),stringtolob('inserted row22b'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob3 values (3,stringtolob('inserted row23a'),stringtolob('inserted row23b'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob3 values (4,stringtolob('inserted row24a'),stringtolob('inserted row24b'));

--- 1 row(s) inserted.
>>
>>prepare s from 
+>select c1, lobtostring(c2,25), lobtostring(c3,25)  from t$$TESTNUM$$lob3;

--- SQL command prepared.
>>
>>
>>
>>select lobtostring(t$$TESTNUM$$lob2.c2,30) from t$$TESTNUM$$lob2, t$$TESTNUM$$lob3 where t$$TESTNUM$$lob2.c1 = t$$TESTNUM$$lob3.c1;

(EXPR)                        
------------------------------

                              

--- 1 row(s) selected.
>>
>>values (filetolob('./myfile.txt'));

*** ERROR[8434] Invalid target column for LOB function. The column needs to be blob/clob type.

--- 0 row(s) selected.
>>values( stringtolob('xxxxxx'));

*** ERROR[8434] Invalid target column for LOB function. The column needs to be blob/clob type.

--- 0 row(s) selected.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(dml_update);
>>
>>update t$$TESTNUM$$lob2 set c2=stringtolob('updated c2 in all rows');

--- 2 row(s) updated.
>>select c1, lobtostring(c2,30) from t$$TESTNUM$$lob2;

C1           (EXPR)                        
-----------  ------------------------------

          0  updated c2 in all rows        
          1  updated c2 in all rows        

--- 2 row(s) selected.
>>
>>update t$$TESTNUM$$lob2 set c2=stringtolob('updated row21a') where c1=1;

--- 1 row(s) updated.
>>select c1, lobtostring(c2,30) from t$$TESTNUM$$lob2;

C1           (EXPR)                        
-----------  ------------------------------

          0  updated c2 in all rows        
          1  updated row21a                

--- 2 row(s) selected.
>>select c1, lobtostring(c2,30) from t$$TESTNUM$$lob2 where c1=1;

C1           (EXPR)                        
-----------  ------------------------------

          1  updated row21a                

--- 1 row(s) selected.
>>
>>-- update primary key 
>>-- return error
>>update t$$TESTNUM$$lob2 set c1 = 10, c2=stringtolob('updated c2 in all rows');

*** ERROR[3242] This statement is not supported. Reason: Primary key and lob column cannot be updated in the same statement.

*** ERROR[8822] The statement was not prepared.

>>
>>-- update successfully
>>update t$$TESTNUM$$lob2 set c1 = c1 + 100;

--- 2 row(s) updated.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(dml_update_append);
>>
>>update t$$TESTNUM$$lob2 set c2=stringtolob('appended row21a',append) where c1=101;

--- 1 row(s) updated.
>>select c1, lobtostring(c2,100) from t$$TESTNUM$$lob2;

C1           (EXPR)
-----------  ----------------------------------------------------------------------------------------------------

        100  updated c2 in all rows                                                                              
        101  updated row21aappended row21a                                                                       

--- 2 row(s) selected.
>>select c1, lobtostring(c2,100) from t$$TESTNUM$$lob2 where c1=101;

C1           (EXPR)
-----------  ----------------------------------------------------------------------------------------------------

        101  updated row21aappended row21a                                                                       

--- 1 row(s) selected.
>>
>>update t$$TESTNUM$$lob2 set c2=stringtolob(' appended c2 to all rows',append);

--- 2 row(s) updated.
>>select c1, lobtostring(c2,60) from t$$TESTNUM$$lob2;

C1           (EXPR)
-----------  ------------------------------------------------------------

        100  updated c2 in all rows appended c2 to all rows              
        101  updated row21aappended row21a appended c2 to all rows       

--- 2 row(s) selected.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(dml_delete);
>>
>>delete from t$$TESTNUM$$lob3 where c1=1;

--- 1 row(s) deleted.
>>select c1, lobtostring(c2,30), lobtostring(c3,30)  from t$$TESTNUM$$lob3;

C1           (EXPR)                          (EXPR)
-----------  ------------------------------  ------------------------------

          2  inserted row22a                 inserted row22b               
          3  inserted row23a                 inserted row23b               
          4  inserted row24a                 inserted row24b               

--- 3 row(s) selected.
>>
>>delete from t$$TESTNUM$$lob2 ;

--- 2 row(s) deleted.
>>select * from t$$TESTNUM$$lob2;

--- 0 row(s) selected.
>>
>>insert into t$$TESTNUM$$lob2 values(1, NULL);

--- 1 row(s) inserted.
>>select c1 from (delete from t$$TESTNUM$$lob2) x;

C1         
-----------

          1

--- 1 row(s) selected.
>>select * from t$$TESTNUM$$lob2;

--- 0 row(s) selected.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(update_stats);
>>
>>-- positive tests; LOB columns should be silently skipped
>>update statistics for table t$$TESTNUM$$lob1 on every column;

--- SQL operation complete.
>>
>>update statistics for table t$$TESTNUM$$lob4 on c1 to c2;

--- SQL operation complete.
>>
>>-- negative tests; attempts to explicitly create stats on LOB
>>-- columns should fail with error 9246
>>update statistics for table t$$TESTNUM$$lob4 on c3;

*** ERROR[9246] UPDATE STATISTICS is not supported on LOB columns. Column C3 is a LOB column.

--- SQL operation failed with errors.
>>
>>update statistics for table t$$TESTNUM$$lob2 on (c1,c2);

*** ERROR[9246] UPDATE STATISTICS is not supported on LOB columns. Column C2 is a LOB column.

--- SQL operation failed with errors.
>>
>>update statistics for table t$$TESTNUM$$lob4 on c2 to c3;

*** ERROR[9246] UPDATE STATISTICS is not supported on LOB columns. Column C3 is a LOB column.

--- SQL operation failed with errors.
>>
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(clob_specific_tests);
>>
>>insert into t$$TESTNUM$$lob4 values (1, 'one',stringtolob('gggggghhhhhhhh'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob4 values (2,'two', stringtolob('fff')) ;

--- 1 row(s) inserted.
>>select c1,substring(c3,1,1) from t$$TESTNUM$$lob4 order by c1;

C1           (EXPR)
-----------  ------

          1  g     
          2  f     

--- 2 row(s) selected.
>>select c1,substring(c3,3,2) from t$$TESTNUM$$lob4 order by c1;

C1           (EXPR)
-----------  ------

          1  gg    
          2  f     

--- 2 row(s) selected.
>>select c1,instr(c3,'g') from t$$TESTNUM$$lob4 order by c1;

C1           (EXPR)    
-----------  ----------

          1           1
          2           0

--- 2 row(s) selected.
>>select c1,instr(c3,'h') from t$$TESTNUM$$lob4 order by c1;

C1           (EXPR)    
-----------  ----------

          1           7
          2           0

--- 2 row(s) selected.
>>select c1,instr(c3,'a') from t$$TESTNUM$$lob4 order by c1;

C1           (EXPR)    
-----------  ----------

          1           0
          2           0

--- 2 row(s) selected.
>>select * from t$$TESTNUM$$lob4 where c3 like 'ggg%';

C1           C2          C3
-----------  ----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  one         LOBH0000000200020820746102937091457919820746102959968111318212445791109260604016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>select * from t$$TESTNUM$$lob4 where c3='fff';

C1           C2          C3
-----------  ----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          2  two         LOBH0000000200020820746102937091457919820746102960090188318212445791111425637016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>invoke t$$TESTNUM$$lob5;

-- Definition of Trafodion table TRAFODION.LOB130.T130LOB5
-- Definition of hbase table TRAF_regr:TRAFODION.LOB130.T130LOB5
-- Definition current  Tue Jan 14 11:45:20 2020

  (
    C1                               INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C2                               CLOB( 10485760 bytes) CHARACTER SET UTF8
      DEFAULT NULL
  , C3                               CLOB( 20971520 bytes) CHARACTER SET
      ISO88591 DEFAULT NULL
  )
  PRIMARY KEY (C1 ASC)

--- SQL operation complete.
>>insert into t$$TESTNUM$$lob5 values (1,stringtolob('fff'), stringtolob('fff'));

--- 1 row(s) inserted.
>>insert into t$$TESTNUM$$lob5 values (2,stringtolob('aaa'),stringtolob('bbb'));

--- 1 row(s) inserted.
>>select lobtostring(c2,12),lobtostring(c3,12) from t$$TESTNUM$$lob5 order by c1;

(EXPR)                                            (EXPR)      
------------------------------------------------  ------------

fff                                               fff         
aaa                                               bbb         

--- 2 row(s) selected.
>>select c1 from t$$TESTNUM$$lob5 where c2=c3;

*** WARNING[4181] String funtions on CLOB type are limited to process CLOB data upto CQD value LOB_OUTPUT_SIZE (16777216)

C1         
-----------

          1

--- 1 row(s) selected.
>>obey $$REGRTSTDIR$$/../executor/TEST130(clnup);
>>set schema trafodion.lob$$TESTNUM$$;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob1 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob2 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob3 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob4 cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob5 cascade;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$ext cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$char cascade;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$var cascade;

--- SQL operation complete.
>>drop table if exists myloben cascade;

--- SQL operation complete.
>>drop external table if exists date_dim for hive.hive.date_dim;

--- SQL operation complete.
>>
>>
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_local_cleanup);
>>drop table if exists tlob$$TESTNUM$$txt1;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin1;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$_limit50;

--- SQL operation complete.
>>sh rm -f TMPLOG;
>>sh rm -f tlob$$TESTNUM$$txt1;
>>sh rm -f tlob$$TESTNUM$$_txt1.txt;
>>sh rm -f tlob$$TESTNUM$$_deep.jpg;
>>sh rm -f tlob$$TESTNUM$$_anoush.jpg;
>>
>>
>>-- Test for local input
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_local_file);
>>log LOG$$TESTNUM$$;
>>--setup
>>sh echo "Test for file input and extract";
>>create table tlob$$TESTNUM$$txt1 (c1 int not null, c2 clob, primary key (c1));

--- SQL operation complete.
>>create table tlob$$TESTNUM$$bin1 (c1 int not null, c2 blob, primary key (c1));

--- SQL operation complete.
>>create table tlob$$TESTNUM$$txt_limit50(c1 int not null, c2 clob(50), primary key (c1));

--- SQL operation complete.
>>create table tlob$$TESTNUM$$bin_limit1K(c1 int not null, c2 blob(1 K), primary key (c1));

--- SQL operation complete.
>>
>>sh cp -f $scriptsdir/executor/deep.jpg $rundir/executor/;
>>sh cp -f $scriptsdir/executor/anoush.jpg $rundir/executor/;
>>sh cp -f $scriptsdir/executor/lob_input_* $rundir/executor/;
>>sh cp -f $scriptsdir/executor/TEST$$TESTNUM$$_argfile* $rundir/executor/;
>>
>>-- inserts
>>-- first line
>>insert into tlob$$TESTNUM$$txt1 values (1, filetolob('lob_input_a1.txt'));

--- 1 row(s) inserted.
>>
>>-- second line
>>insert into tlob$$TESTNUM$$txt1 values (2, filetolob('lob_input_b1.txt'));

--- 1 row(s) inserted.
>>
>>-- third line
>>insert into tlob$$TESTNUM$$txt1 values (3, filetolob('lob_input_c1.txt'));

--- 1 row(s) inserted.
>>
>>select lobtostring(c2, 40 ) from tlob$$TESTNUM$$txt1;

(EXPR)                                  
----------------------------------------

Hey diddle diddle,
                     
The cat and the fiddle,
                
The cow jumped over the moon.
          

--- 3 row(s) selected.
>>
>>--updates
>>
>>--should update with full poem
>>update tlob$$TESTNUM$$txt1 set c2=filetolob('lob_input_d1.txt', append) where c1 = 3;

--- 1 row(s) updated.
>>
>>select lobtostring(c2, 200 ) from tlob$$TESTNUM$$txt1;

(EXPR)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hey diddle diddle,
                                                                                                                                                                                     
The cat and the fiddle,
                                                                                                                                                                                
The cow jumped over the moon.
The little dog laughed,
To see such sport,

And the dish ran away with the spoon.
                                                                                        

--- 3 row(s) selected.
>>
>>-- should see wrong text in the last few lines
>>update tlob$$TESTNUM$$txt1 set c2=filetolob('lob_input_e1.txt') where c1 =3 ;

--- 1 row(s) updated.
>>
>>select lobtostring(c2, 200 ) from tlob$$TESTNUM$$txt1;

(EXPR)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hey diddle diddle,
                                                                                                                                                                                     
The cat and the fiddle,
                                                                                                                                                                                
The little dog cried,
To see such sport,

And the dish ran away with the fork !
                                                                                                                        

--- 3 row(s) selected.
>>
>>--delete
>>
>>-- go back to having just the first  line. 
>>delete from tlob$$TESTNUM$$txt1 where c1 =2;

--- 1 row(s) deleted.
>>delete from tlob$$TESTNUM$$txt1 where c1 =3;

--- 1 row(s) deleted.
>>
>>--test limits
>>
>>insert into tlob$$TESTNUM$$txt_limit50 values(1,filetolob('lob_input_e1.txt'));

*** ERROR[8442] Unable to access ExpLOBInterfaceInsert interface. Call to ExpLOBInterfaceInsert returned error LOB_MAX_LIMIT_ERROR(561). Error detail: -99999. Cause: .

--- 0 row(s) inserted.
>>insert into tlob$$TESTNUM$$bin_limit1K values(1,filetolob('anoush.jpg'));

*** ERROR[8442] Unable to access ExpLOBInterfaceInsert interface. Call to ExpLOBInterfaceInsert returned error LOB_MAX_LIMIT_ERROR(561). Error detail: -99999. Cause: .

--- 0 row(s) inserted.
>>--test extract 
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>
>>select c2 from tlob$$TESTNUM$$txt1;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937095185319820746102990413440218212445791413625678016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'tlob"$TESTNUM"_txt1.txt');/g" >> tLOB_extract_command;
>>
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200010820746102937095185319820746102990413440218212445791413625678016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'tlob130_txt1.txt');
Success. Targetfile :tlob130_txt1.txt  Length : 19

--- SQL operation complete.
>>
>>--binary input/update
>>
>>insert into tlob$$TESTNUM$$bin1 values (1 , filetolob('deep.jpg'));

--- 1 row(s) inserted.
>>--extract // should have a viewable picture file
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>select c2 from tlob$$TESTNUM$$bin1;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'tlob"$TESTNUM"_deep.jpg');/g" >> tLOB_extract_command;
>>
>>
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'tlob130_deep.jpg');
Success. Targetfile :tlob130_deep.jpg  Length : 159018

--- SQL operation complete.
>>
>>update tlob$$TESTNUM$$bin1 set c2=filetolob('anoush.jpg') ;

--- 1 row(s) updated.
>>
>>--extract into a different file // should have a different viewable picture.
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>select c2 from tlob$$TESTNUM$$bin1;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'tlob"$TESTNUM"_anoush.jpg');/g" >> tLOB_extract_command;
>>
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'tlob130_anoush.jpg');
Success. Targetfile :tlob130_anoush.jpg  Length : 230150

--- SQL operation complete.
>>
>>
>>-- Test for hdfs input
>>--cleanup -- comment the following lines out if you want to debug this test and save intermediate files.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_hdfs_cleanup);
>>drop table if exists tlob$$TESTNUM$$txt2;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin2;

--- SQL operation complete.
>>sh rm -f TMPLOG;
>>sh rm -f tlob$$TESTNUM$$txt2;
>>sh rm -f tlob$$TESTNUM$$_txt2.txt;
>>sh regrhadoop.ksh fs -rm /user/trafodion/lobs/tlob$$TESTNUM$$_deep.jpg;
>>sh regrhadoop.ksh fs -rm /user/trafodion/lobs/tlob$$TESTNUM$$_anoush.jpg;
>>sh regrhadoop.ksh fs -rm /user/trafodion/lobs/tlob$$TESTNUM$$_txt2.txt;
>>
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_hdfs_file);
>>create table tlob$$TESTNUM$$txt2 (c1 int not null, c2 clob, primary key (c1));

--- SQL operation complete.
>>create table tlob$$TESTNUM$$bin2 (c1 int not null, c2 blob, primary key (c1));

--- SQL operation complete.
>>
>>sh regrhadoop.ksh fs -copyFromLocal lob_input_a1.txt /user/trafodion/lobs/lob_input_a1.txt;
>>sh regrhadoop.ksh fs -copyFromLocal lob_input_b1.txt /user/trafodion/lobs/lob_input_b1.txt;
>>sh regrhadoop.ksh fs -copyFromLocal lob_input_c1.txt /user/trafodion/lobs/lob_input_c1.txt;
>>sh regrhadoop.ksh fs -copyFromLocal lob_input_d1.txt /user/trafodion/lobs/lob_input_d1.txt;
>>sh regrhadoop.ksh fs -copyFromLocal lob_input_e1.txt /user/trafodion/lobs/lob_input_e1.txt;
>>sh regrhadoop.ksh fs -copyFromLocal deep.jpg /user/trafodion/lobs/deep.jpg;
>>sh regrhadoop.ksh fs -copyFromLocal anoush.jpg /user/trafodion/lobs/anoush.jpg;
>>-- the next one is a really long file name intended to test error message 8557
>>sh regrhadoop.ksh fs -copyFromLocal lob_input_a1.txt /user/trafodion/lobs/reallyLongDirectoryName0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789/lob_input_a1012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789.txt;
>>sh sleep(20);
>>
>>
>>insert into tlob$$TESTNUM$$txt2 values (1, filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'));

--- 1 row(s) inserted.
>>
>>-- second line
>>insert into tlob$$TESTNUM$$txt2 values (2, filetolob('hdfs:///user/trafodion/lobs/lob_input_b1.txt'));

--- 1 row(s) inserted.
>>
>>-- third line
>>insert into tlob$$TESTNUM$$txt2 values (3, filetolob('hdfs:///user/trafodion/lobs/lob_input_c1.txt'));

--- 1 row(s) inserted.
>>select lobtostring(c2, 40 ) from tlob$$TESTNUM$$txt2;

(EXPR)                                  
----------------------------------------

Hey diddle diddle,
                     
The cat and the fiddle,
                
The cow jumped over the moon.
          

--- 3 row(s) selected.
>>
>>--updates
>>
>>--should update with full poem
>>update tlob$$TESTNUM$$txt2 set c2=filetolob('hdfs:///user/trafodion/lobs/lob_input_d1.txt', append) where c1 = 3;

--- 1 row(s) updated.
>>select lobtostring(c2, 200 ) from tlob$$TESTNUM$$txt2;

(EXPR)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hey diddle diddle,
                                                                                                                                                                                     
The cat and the fiddle,
                                                                                                                                                                                
The cow jumped over the moon.
The little dog laughed,
To see such sport,

And the dish ran away with the spoon.
                                                                                        

--- 3 row(s) selected.
>>update tlob$$TESTNUM$$txt2 set c2=NULL where c1=3;

--- 1 row(s) updated.
>>select * from tlob$$TESTNUM$$txt2;

C1           C2
-----------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

          1  LOBH0000000200010820746102937096112719820746102997072616818212445791480203442016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          2  LOBH0000000200010820746102937096112719820746102997199810918212445791482520164016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          3  ?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

--- 3 row(s) selected.
>>update tlob$$TESTNUM$$txt2 set c2=filetolob('hdfs:///user/trafodion/lobs/lob_input_d1.txt', append) where c1 = 3;

--- 1 row(s) updated.
>>select lobtostring(c2, 200 ) from tlob$$TESTNUM$$txt2;

(EXPR)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hey diddle diddle,
                                                                                                                                                                                     
The cat and the fiddle,
                                                                                                                                                                                
The little dog laughed,
To see such sport,

And the dish ran away with the spoon.
                                                                                                                      

--- 3 row(s) selected.
>>
>>-- should see wrong text in the last few lines
>>update tlob$$TESTNUM$$txt2 set c2=filetolob('hdfs:///user/trafodion/lobs/lob_input_e1.txt') where c1 =3 ;

--- 1 row(s) updated.
>>select lobtostring(c2, 200 ) from tlob$$TESTNUM$$txt2;

(EXPR)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hey diddle diddle,
                                                                                                                                                                                     
The cat and the fiddle,
                                                                                                                                                                                
The little dog cried,
To see such sport,

And the dish ran away with the fork !
                                                                                                                        

--- 3 row(s) selected.
>>
>>--delete
>>
>>
>>-- go back to having just the first  line. 
>>delete from tlob$$TESTNUM$$txt2 where c1 =2;

--- 1 row(s) deleted.
>>delete from tlob$$TESTNUM$$txt2 where c1 =3;

--- 1 row(s) deleted.
>>-- test extract 
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>select c2 from tlob$$TESTNUM$$txt2;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937096112719820746102997072616818212445791480203442016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'hdfs:\/\/\/user\/trafodion\/lobs\/tlob"$TESTNUM"_txt2.txt');/g" >> tLOB_extract_command;
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200010820746102937096112719820746102997072616818212445791480203442016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'hdfs:///user/trafodion/lobs/tlob130_txt2.txt');
Success. Targetfile :hdfs:///user/trafodion/lobs/tlob130_txt2.txt  Length : 19

--- SQL operation complete.
>>
>>--binary input/update
>>
>>insert into tlob$$TESTNUM$$bin2 values (1 , filetolob('deep.jpg'));

--- 1 row(s) inserted.
>>--extract // should have a viewable picture file
>>
>>log;
>>select c2 from tlob$$TESTNUM$$bin2;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937096310019820746102997589039018212445791485395330016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>
>>sh rm -f tLOB_extract_command;
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'hdfs:\/\/\/user\/trafodion\/lobs\/tlob"$TESTNUM"_deep.jpg');/g" >> tLOB_extract_command;
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200010820746102937096310019820746102997589039018212445791485395330016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'hdfs:///user/trafodion/lobs/tlob130_deep.jpg');
Success. Targetfile :hdfs:///user/trafodion/lobs/tlob130_deep.jpg  Length : 159018

--- SQL operation complete.
>>
>>update tlob$$TESTNUM$$bin2 set c2=filetolob('anoush.jpg') ;

--- 1 row(s) updated.
>>
>>--extract into a different file // should have a different viewable picture.
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>select c2 from tlob$$TESTNUM$$bin1;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'hdfs:\/\/\/user\/trafodion\/lobs\/tlob"$TESTNUM"_anoush.jpg');/g" >> tLOB_extract_command;
>>
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'hdfs:///user/trafodion/lobs/tlob130_anoush.jpg');
Success. Targetfile :hdfs:///user/trafodion/lobs/tlob130_anoush.jpg  Length : 230150

--- SQL operation complete.
>>
>>
>>sh clitestdriver 2 < TEST$$TESTNUM$$_argfile 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test extract to file in chunks 
************************************
Extract from a lob column in a lob table

Input lob table name :
Table name : TRAFODION.LOB130.tlob130bin1
Input lob column name to extract from :
Column Name : c2
Input a filename to extract to : 
Output File Name : lobc2out.jpg
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937095408819820746102990956354118212445791419061116016TRAFODION.LOB130
Extracting LOB data length for the above handle...
LOB data length :230150
Extracting lob data into file in chunks ...
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 10000 bytes to file : lobc2out.jpg
Wrote 150 bytes to file : lobc2out.jpg
>>
>>
>>
>>------------------------------------------------------------------------------
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_misc_cleanup);
>>drop table if exists tlob$$TESTNUM$$txt3;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin3;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bt;

--- SQL operation complete.
>>sh rm -f tlob$$TETSNUM$$_deep2.jpg;
>>sh rm -f tlob$$TESTNUM$$_txt1.txt;
>>sh regrhadoop.ksh fs -rm /user/trafodion/lobs/tlob$$TESTNUM$$_anoush2.jpg;
>>sh rm -f tlob$$TESTNUM$$_anoush3.jpg;
>>
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_miscfile_test);
>>log LOG$$TESTNUM$$;
>>-- 2 clob columns
>>create table tlob$$TESTNUM$$txt3 (c1 int not null, c2 int, c3 clob, c4 clob, primary key (c1));

--- SQL operation complete.
>>insert into tlob$$TESTNUM$$txt3 values (1, 1,filetolob('lob_input_a1.txt'), filetolob('lob_input_b1.txt'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$txt3 values (2, 2,filetolob('lob_input_c1.txt'), filetolob('lob_input_d1.txt'));

--- 1 row(s) inserted.
>>select lobtostring(c3,100), lobtostring(c4,100)from tlob$$TESTNUM$$txt3;

(EXPR)                                                                                                (EXPR)
----------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------

Hey diddle diddle,
                                                                                   The cat and the fiddle,
                                                                            
The cow jumped over the moon.
                                                                        The little dog laughed,
To see such sport,

And the dish ran away with the spoon.
                  

--- 2 row(s) selected.
>>
>>-- 2 blob columns
>>create table tlob$$TESTNUM$$bin3 (c1 int not null, c2 int, c3 blob, c4 blob, primary key (c1));

--- SQL operation complete.
>>insert into tlob$$TESTNUM$$bin3 values (1, 1, filetolob('deep.jpg'), filetolob('anoush.jpg'));

--- 1 row(s) inserted.
>>
>>log;
>>select c3 from tlob$$TESTNUM$$bin3;

C3
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200020820746102937097260019820746103006333262318212445791572833447016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>
>>sh rm -f tLOB_extract_command;
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'tlob"$TESTNUM"_deep2.jpg');/g" >> tLOB_extract_command;
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200020820746102937097260019820746103006333262318212445791572833447016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'tlob130_deep2.jpg');
Success. Targetfile :tlob130_deep2.jpg  Length : 159018

--- SQL operation complete.
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>select c4 from tlob$$TESTNUM$$bin3;

C4
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200030820746102937097260019820746103006556194118212445791575065830016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'hdfs:\/\/\/user\/trafodion\/lobs\/tlob"$TESTNUM"_anoush2.jpg');/g" >> tLOB_extract_command;
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200030820746102937097260019820746103006556194118212445791575065830016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'hdfs:///user/trafodion/lobs/tlob130_anoush2.jpg');
Success. Targetfile :hdfs:///user/trafodion/lobs/tlob130_anoush2.jpg  Length : 230150

--- SQL operation complete.
>>
>>-- combination blob and clob columns
>>create table tlob$$TESTNUM$$bt (c1 int not null, c2 int, c3 blob, c4 clob, primary key (c1));

--- SQL operation complete.
>>insert into tlob$$TESTNUM$$bt values (1,1, filetolob('lob_input_a1.txt'), filetolob('anoush.jpg'));

--- 1 row(s) inserted.
>>
>>select lobtostring(c3,40) from tlob$$TESTNUM$$bt;

(EXPR)                                  
----------------------------------------

Hey diddle diddle,
                     

--- 1 row(s) selected.
>>
>>log;
>>sh rm -f tLOB_extract_command;
>>select c4 from tlob$$TESTNUM$$bt;

C4
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200030820746102937097622719820746103010511578218212445791614645298016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>sh grep "^LOBH" TMPLOG | sed "s/^/extract lobtofile(LOB '/g" | sed "s/$/' , 'tlob"$TESTNUM"_anoush3.jpg',create,truncate);/g" >> tLOB_extract_command;
>>obey tLOB_extract_command;
>>extract lobtofile(LOB 'LOBH0000000200030820746102937097622719820746103010511578218212445791614645298016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' , 'tlob130_anoush3.jpg',create,truncate);
Success. Targetfile :tlob130_anoush3.jpg  Length : 230150

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_alter);
>>log LOG$$TESTNUM$$;
>>--test alter 
>>create table if not exists tlob$$TESTNUM$$bt (c1 int not null, c2 int, c3 blob, c4 clob, primary key (c1));

--- SQL operation complete.
>>delete from tlob$$TESTNUM$$bt;

--- 1 row(s) deleted.
>>insert into tlob$$TESTNUM$$bt values (1,1, stringtolob('lob_input_a1.txt'), stringtolob('anoush.jpg'));

--- 1 row(s) inserted.
>>alter table tlob$$TESTNUM$$bt add column c5 blob;

--- SQL operation complete.
>>--should show default value NULL
>>select c5 from tlob$$TESTNUM$$bt;

C5
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

--- 1 row(s) selected.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_gc_cleanup);
>>drop table if exists tlob$$TESTNUM$$gc;

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_gc_test);
>>log LOG$$TESTNUM$$;
>>create table tlob$$TESTNUM$$gc (c1 int not null, c2 blob, c3 blob, primary key (c1));

--- SQL operation complete.
>>--insert a few rows
>>insert into tlob$$TESTNUM$$gc values (1, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (2, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (3, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (4, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (5, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (6, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (7, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gc values (8, stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>--create holes in the lob data file
>>delete from tlob$$TESTNUM$$gc where c1=2;

--- 1 row(s) deleted.
>>delete from tlob$$TESTNUM$$gc where c1=6;

--- 1 row(s) deleted.
>>update tlob$$TESTNUM$$gc set c2=stringtolob('xxxx')where c1=7;

--- 1 row(s) updated.
>>--check contents of table
>>select c1,lobtostring(c2,10),lobtostring(c3,10) from tlob$$TESTNUM$$gc;

C1           (EXPR)      (EXPR)    
-----------  ----------  ----------

          1  aaaa        bbbbb     
          3  aaaa        bbbbb     
          4  aaaa        bbbbb     
          5  aaaa        bbbbb     
          7  xxxx        bbbbb     
          8  aaaa        bbbbb     

--- 6 row(s) selected.
>>cqd LOB_GC_LIMIT_SIZE '0';

--- SQL operation complete.
>>--this next insert should trigger a GC
>>insert into tlob$$TESTNUM$$gc values(9,stringtolob('aaaa'), stringtolob('bbbbb'));

--- 1 row(s) inserted.
>>--check contents of table. Should have one extra row compared to above select
>>select c1,lobtostring(c2,10),lobtostring(c3,10) from tlob$$TESTNUM$$gc;

C1           (EXPR)      (EXPR)    
-----------  ----------  ----------

          1  aaaa        bbbbb     
          3  aaaa        bbbbb     
          4  aaaa        bbbbb     
          5  aaaa        bbbbb     
          7  xxxx        bbbbb     
          8  aaaa        bbbbb     
          9  aaaa        bbbbb     

--- 7 row(s) selected.
>>cqd LOB_GC_LIMIT_SIZE reset;

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_get_cleanup);
>>drop table if exists tlob$$TESTNUM$$gt;

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_get_test);
>>log LOG$$TESTNUM$$;
>>
>>drop table if exists tlob$$TESTNUM$$gt;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$gt2;

--- SQL operation complete.
>>create table tlob$$TESTNUM$$gt2 (c1 int not null, c2 blob, c3 clob, c4 blob storage 'external', primary key (c1));

--- SQL operation complete.
>>get lob stats for table tlob$$TESTNUM$$gt2;


Lob Information for table: "TRAFODION".LOB130.TLOB130GT2
=========================

  ColumnName :  C2
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370985115
  LOB Data File:  LOBP_08207461029370985115_0001
  LOB EOD :  0
  Total EOD :  0
  LOB Used Len :  0
  ColumnName :  C3
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370985115
  LOB Data File:  LOBP_08207461029370985115_0002
  LOB EOD :  0
  Total EOD :  0
  LOB Used Len :  0
  ColumnName :  C4
  Lob Location :  External HDFS Location
  LOB Data File:  External HDFS File
  LOB EOD :  0
  LOB Used Len :  0

--- SQL operation complete.
>>select catalog_name,schema_name,object_name,column_name,lob_location,lob_data_file
+> from table(lob stats(tlob$$TESTNUM$$gt2)) order by 1,2,3,4,5,6;

CATALOG_NAME                                                                                                                                                                                                                                                      SCHEMA_NAME                                                                                                                                                                                                                                                       OBJECT_NAME                                                                                                                                                                                                                                                       COLUMN_NAME                                                                                                                                                                                                                                                       LOB_LOCATION                                                                                                                                                                                                                                                      LOB_DATA_FILE
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT2                                                                                                                                                                                                                                                        C2                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370985115                                                                                                                                                                                                       LOBP_08207461029370985115_0001                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT2                                                                                                                                                                                                                                                        C3                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370985115                                                                                                                                                                                                       LOBP_08207461029370985115_0002                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT2                                                                                                                                                                                                                                                        C4                                                                                                                                                                                                                                                                External HDFS Location                                                                                                                                                                                                                                            External HDFS File                                                                                                                                                                                                                                              

--- 3 row(s) selected.
>>select sum(lob_data_file_size_eod), sum(lob_data_file_size_used)
+>  from table(lob stats(tlob$$TESTNUM$$gt2));

(EXPR)                (EXPR)              
--------------------  --------------------

                   0                     0

--- 1 row(s) selected.
>>
>>create table tlob$$TESTNUM$$gt (c1 int not null, c2 blob, c3 clob, c4 blob, primary key (c1));

--- SQL operation complete.
>>insert into tlob$$TESTNUM$$gt values (1, stringtolob('xxxx'), stringtolob('yyyy'), stringtolob('zzzzzzzzzzzzzz'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gt values (2, stringtolob('xxxxx'), stringtolob('yyyyy'), stringtolob('zzzzzzzzzzzzzzz'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$gt values (3, stringtolob('xxxxxx'), stringtolob('yyyyyy'), stringtolob('zzzzzzzzzzzzzzzz'));

--- 1 row(s) inserted.
>>get lob stats for table tlob$$TESTNUM$$gt;


Lob Information for table: "TRAFODION".LOB130.TLOB130GT
=========================

  ColumnName :  C2
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913
  LOB Data File:  LOBP_08207461029370989913_0001
  LOB EOD :  15
  Total EOD :  15
  LOB Used Len :  15
  ColumnName :  C3
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913
  LOB Data File:  LOBP_08207461029370989913_0002
  LOB EOD :  15
  Total EOD :  15
  LOB Used Len :  15
  ColumnName :  C4
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913
  LOB Data File:  LOBP_08207461029370989913_0003
  LOB EOD :  45
  Total EOD :  45
  LOB Used Len :  45

--- SQL operation complete.
>>select catalog_name,schema_name,object_name,column_name,lob_location,lob_data_file
+> from table(lob stats(tlob$$TESTNUM$$gt)) order by 1,2,3,4,5,6;

CATALOG_NAME                                                                                                                                                                                                                                                      SCHEMA_NAME                                                                                                                                                                                                                                                       OBJECT_NAME                                                                                                                                                                                                                                                       COLUMN_NAME                                                                                                                                                                                                                                                       LOB_LOCATION                                                                                                                                                                                                                                                      LOB_DATA_FILE
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT                                                                                                                                                                                                                                                         C2                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913                                                                                                                                                                                                       LOBP_08207461029370989913_0001                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT                                                                                                                                                                                                                                                         C3                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913                                                                                                                                                                                                       LOBP_08207461029370989913_0002                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT                                                                                                                                                                                                                                                         C4                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913                                                                                                                                                                                                       LOBP_08207461029370989913_0003                                                                                                                                                                                                                                  

--- 3 row(s) selected.
>>select sum(lob_data_file_size_eod), sum(lob_data_file_size_used)
+>  from table(lob stats(tlob$$TESTNUM$$gt));

(EXPR)                (EXPR)              
--------------------  --------------------

                  75                    75

--- 1 row(s) selected.
>>
>>delete from tlob$$TESTNUM$$gt where c1=2;

--- 1 row(s) deleted.
>>insert into tlob$$TESTNUM$$gt values (2, stringtolob('xxxxxxxxxxxxxxx'), stringtolob('yyyyyyyyyyyyyyyy'), stringtolob('zzzzzzzzzzzzzzzzzzzzzzzzzz'));

--- 1 row(s) inserted.
>>get lob stats for table tlob$$TESTNUM$$gt;


Lob Information for table: "TRAFODION".LOB130.TLOB130GT
=========================

  ColumnName :  C2
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913
  LOB Data File:  LOBP_08207461029370989913_0001
  LOB EOD :  30
  Total EOD :  30
  LOB Used Len :  25
  ColumnName :  C3
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913
  LOB Data File:  LOBP_08207461029370989913_0002
  LOB EOD :  31
  Total EOD :  31
  LOB Used Len :  26
  ColumnName :  C4
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913
  LOB Data File:  LOBP_08207461029370989913_0003
  LOB EOD :  71
  Total EOD :  71
  LOB Used Len :  56

--- SQL operation complete.
>>select catalog_name,schema_name,object_name,column_name,lob_location,lob_data_file
+> from table(lob stats(tlob$$TESTNUM$$gt)) order by 1,2,3,4,5,6;

CATALOG_NAME                                                                                                                                                                                                                                                      SCHEMA_NAME                                                                                                                                                                                                                                                       OBJECT_NAME                                                                                                                                                                                                                                                       COLUMN_NAME                                                                                                                                                                                                                                                       LOB_LOCATION                                                                                                                                                                                                                                                      LOB_DATA_FILE
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT                                                                                                                                                                                                                                                         C2                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913                                                                                                                                                                                                       LOBP_08207461029370989913_0001                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT                                                                                                                                                                                                                                                         C3                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913                                                                                                                                                                                                       LOBP_08207461029370989913_0002                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130GT                                                                                                                                                                                                                                                         C4                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370989913                                                                                                                                                                                                       LOBP_08207461029370989913_0003                                                                                                                                                                                                                                  

--- 3 row(s) selected.
>>select sum(lob_data_file_size_eod), sum(lob_data_file_size_used)
+>  from table(lob stats(tlob$$TESTNUM$$gt));

(EXPR)                (EXPR)              
--------------------  --------------------

                 132                   107

--- 1 row(s) selected.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_external);
>>--test external lobs
>>create table tlob$$TESTNUM$$ext (c1 int not null, c2 blob, c3 clob, c4 blob storage 'external', primary key (c1));

--- SQL operation complete.
>>
>>create table tlob$$TESTNUM$$ext2 (c1 int not null, c2 blob, c3 clob, c4 blob storage 'external', primary key (c1));

--- SQL operation complete.
>>create table tlob$$TESTNUM$$_not_external (c1 int not null , c2 blob, c3 blob, c4 blob, primary key (c1));

--- SQL operation complete.
>>insert into tlob$$TESTNUM$$ext values(1, stringtolob('first lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$ext values(2, stringtolob('second lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_b1.txt'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_b1.txt'));

--- 1 row(s) inserted.
>>insert into tlob$$TESTNUM$$ext values(3, stringtolob('third lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_c1.txt'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_c1.txt'));

--- 1 row(s) inserted.
>>
>>--log;
>>--log TMP130 clear;
>>--select c3 from tlob130ext where c1=3;
>>--log;
>>
>>--log LOG130;
>>--sh rm -f t130_extract_command;
>>--sh grep "^LOBH" TMP130 | sed "s/^/extract name(LOB '/g" | sed "s/$/');/g" >> t130_extract_command;
>>--obey t130_extract_command;
>>--sh rm -f t130_extract_command;
>>--sh grep "^LOBH" TMP130 | sed "s/^/extract offset(LOB '/g" | sed "s/$/');/g" >> t130_extract_command;
>>--obey t130_extract_command;
>>
>>--negative cases
>>insert into tlob$$TESTNUM$$ext values(2, externaltolob('first lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'));

*** ERROR[1432] Input LOB type 5 does not match column's storage type: 2 Column name: C2 .

*** ERROR[8822] The statement was not prepared.

>>insert into tlob$$TESTNUM$$ext values(3, stringtolob('first lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'),filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'));

*** ERROR[1432] Input LOB type 2 does not match column's storage type: 5 Column name: C4 .

*** ERROR[8822] The statement was not prepared.

>>update tlob$$TESTNUM$$ext set c4=stringtolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt', append) where c1=1;

*** ERROR[1432] Input LOB type 2 does not match column's storage type: 5 Column name: C4 .

*** ERROR[8822] The statement was not prepared.

>>update tlob$$TESTNUM$$ext set c4=externaltolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt', append) where c1=1;

*** ERROR[15001] A syntax error occurred at or before: 
update tlob130ext set c4=externaltolob('hdfs:///user/trafodion/lobs/lob_input_a
1.txt', append) where c1=1;
              ^ (94 characters from start of SQL statement)

*** ERROR[8822] The statement was not prepared.

>>update tlob$$TESTNUM$$ext set c3=externaltolob('hdfs:///user/trafodion/lobs/lob_input_b1.txt') where c1=1;

*** ERROR[1432] Input LOB type 5 does not match column's storage type: 2 Column name: C3 .

*** ERROR[8822] The statement was not prepared.

>>update tlob$$TESTNUM$$ext set c4=stringtolob('cannot allow this') where c1=1;

*** ERROR[1432] Input LOB type 2 does not match column's storage type: 5 Column name: C4 .

*** ERROR[8822] The statement was not prepared.

>>delete from tlob$$TESTNUM$$ext where c1=1;

--- 1 row(s) deleted.
>>insert into tlob$$TESTNUM$$ext values(1, stringtolob('first lob'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'));

*** ERROR[1432] Input LOB type 5 does not match column's storage type: 2 Column name: C3 .

*** ERROR[8822] The statement was not prepared.

>>insert into tlob$$TESTNUM$$ext values(1, stringtolob('first lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'),externaltolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'));

--- 1 row(s) inserted.
>>-- the next one should see error 8557
>>insert into tlob$$TESTNUM$$ext values(1, stringtolob('first lob'), filetolob('hdfs:///user/trafodion/lobs/lob_input_a1.txt'),
+>externaltolob('hdfs:///user/trafodion/lobs/reallyLongDirectoryName0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789/lob_input_a1012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789.txt'));

*** ERROR[8557] The file name passed to externaltolob exceeds 256 bytes.

--- 0 row(s) inserted.
>>
>>select lobtostring(c2,50),lobtostring(c3,50),lobtostring(c4,50) from tlob$$TESTNUM$$ext;

(EXPR)                                              (EXPR)                                              (EXPR)
--------------------------------------------------  --------------------------------------------------  --------------------------------------------------

first lob                                           Hey diddle diddle,
                                 Hey diddle diddle,
                               
second lob                                          The cat and the fiddle,
                            The cat and the fiddle,
                          
third lob                                           The cow jumped over the moon.
                      The cow jumped over the moon.
                    

--- 3 row(s) selected.
>>update tlob$$TESTNUM$$ext set c3=stringtolob('can allow this') where c1=1;

--- 1 row(s) updated.
>>select lobtostring(c2,50),lobtostring(c3,50),lobtostring(c4,50) from tlob$$TESTNUM$$ext;

(EXPR)                                              (EXPR)                                              (EXPR)
--------------------------------------------------  --------------------------------------------------  --------------------------------------------------

first lob                                           can allow this                                      Hey diddle diddle,
                               
second lob                                          The cat and the fiddle,
                            The cat and the fiddle,
                          
third lob                                           The cow jumped over the moon.
                      The cow jumped over the moon.
                    

--- 3 row(s) selected.
>>
>>
>>
>>update tlob$$TESTNUM$$ext set c4=externaltolob('hdfs:///user/trafodion/lobs/lob_input_d1.txt') where c1=2;

--- 1 row(s) updated.
>>select lobtostring(c2,50),lobtostring(c3,50),lobtostring(c4,50) from tlob$$TESTNUM$$ext;

(EXPR)                                              (EXPR)                                              (EXPR)
--------------------------------------------------  --------------------------------------------------  --------------------------------------------------

first lob                                           can allow this                                      Hey diddle diddle,
                               
second lob                                          The cat and the fiddle,
                            The little dog laughed,
To see such sport,

And th
third lob                                           The cow jumped over the moon.
                      The cow jumped over the moon.
                    

--- 3 row(s) selected.
>>
>>
>>update tlob$$TESTNUM$$ext set c2=filetolob('hdfs:///user/trafodion/lobs/lob_input_b1.txt') where c1=2;

--- 1 row(s) updated.
>>select lobtostring(c2,50),lobtostring(c3,50),lobtostring(c3,50) from tlob$$TESTNUM$$ext;

(EXPR)                                              (EXPR)                                              (EXPR)
--------------------------------------------------  --------------------------------------------------  --------------------------------------------------

first lob                                           can allow this                                      can allow this                                    
The cat and the fiddle,
                            The cat and the fiddle,
                            The cat and the fiddle,
                          
third lob                                           The cow jumped over the moon.
                      The cow jumped over the moon.
                    

--- 3 row(s) selected.
>>get lob stats for table tlob$$TESTNUM$$ext;


Lob Information for table: "TRAFODION".LOB130.TLOB130EXT
=========================

  ColumnName :  C2
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370994947
  LOB Data File:  LOBP_08207461029370994947_0001
  LOB EOD :  70
  Total EOD :  70
  LOB Used Len :  42
  ColumnName :  C3
  Lob Location :  /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370994947
  LOB Data File:  LOBP_08207461029370994947_0002
  LOB EOD :  125
  Total EOD :  125
  LOB Used Len :  68
  ColumnName :  C4
  Lob Location :  External HDFS Location
  LOB Data File:  External HDFS File
  LOB EOD :  0
  LOB Used Len :  0

--- SQL operation complete.
>>select catalog_name,schema_name,object_name,column_name,lob_location,lob_data_file
+> from table(lob stats(tlob$$TESTNUM$$ext)) order by 1,2,3,4,5,6;

CATALOG_NAME                                                                                                                                                                                                                                                      SCHEMA_NAME                                                                                                                                                                                                                                                       OBJECT_NAME                                                                                                                                                                                                                                                       COLUMN_NAME                                                                                                                                                                                                                                                       LOB_LOCATION                                                                                                                                                                                                                                                      LOB_DATA_FILE
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130EXT                                                                                                                                                                                                                                                        C2                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370994947                                                                                                                                                                                                       LOBP_08207461029370994947_0001                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130EXT                                                                                                                                                                                                                                                        C3                                                                                                                                                                                                                                                                /user/trafodion/lobs/TRAF_1500000/LOBP_08207461029370994947                                                                                                                                                                                                       LOBP_08207461029370994947_0002                                                                                                                                                                                                                                  
TRAFODION                                                                                                                                                                                                                                                         LOB130                                                                                                                                                                                                                                                            TLOB130EXT                                                                                                                                                                                                                                                        C4                                                                                                                                                                                                                                                                External HDFS Location                                                                                                                                                                                                                                            External HDFS File                                                                                                                                                                                                                                              

--- 3 row(s) selected.
>>select sum(lob_data_file_size_eod), sum(lob_data_file_size_used)
+>  from table(lob stats(tlob$$TESTNUM$$ext));

(EXPR)                (EXPR)              
--------------------  --------------------

                 195                   110

--- 1 row(s) selected.
>>
>>sh clitestdriver 2 < TEST$$TESTNUM$$_argfile2 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test extract to file in chunks 
************************************
Extract from a lob column in a lob table

Input lob table name :
Table name : TRAFODION.LOB130.tlob130ext
Input lob column name to extract from :
Column Name : c4
Input a filename to extract to : 
Output File Name : lobc4ext.txt
Extracting  lob handle for column c4...
LOB handle for c4: LOBH0000000500030820746102937099494719820746103038557071318212445791896093131016TRAFODION.LOB130
Extracting LOB data length for the above handle...
LOB data length :19
Extracting lob data into file in chunks ...
Wrote 19 bytes to file : lobc4ext.txt
>>sh cat lobc4ext.txt |tee -a LOG$$TESTNUM$$;
Hey diddle diddle,
>>
>>--insert select from a source external lob column to a target external lob column
>>select lobtostring(c2,50),lobtostring(c3,50),lobtostring(c3,50) from tlob$$TESTNUM$$ext;

(EXPR)                                              (EXPR)                                              (EXPR)
--------------------------------------------------  --------------------------------------------------  --------------------------------------------------

first lob                                           can allow this                                      can allow this                                    
The cat and the fiddle,
                            The cat and the fiddle,
                            The cat and the fiddle,
                          
third lob                                           The cow jumped over the moon.
                      The cow jumped over the moon.
                    

--- 3 row(s) selected.
>>insert into tlob$$TESTNUM$$ext2 select * from tlob$$TESTNUM$$ext;

--- 3 row(s) inserted.
>>select lobtostring(c2,50),lobtostring(c3,50),lobtostring(c3,50) from tlob$$TESTNUM$$ext2;

(EXPR)                                              (EXPR)                                              (EXPR)
--------------------------------------------------  --------------------------------------------------  --------------------------------------------------

first lob                                           can allow this                                      can allow this                                    
The cat and the fiddle,
                            The cat and the fiddle,
                            The cat and the fiddle,
                          
third lob                                           The cow jumped over the moon.
                      The cow jumped over the moon.
                    

--- 3 row(s) selected.
>>----negative test
>>insert into tlob$$TESTNUM$$_not_external select * from tlob$$TESTNUM$$ext;

*** ERROR[1432] Input LOB type 5 does not match column's storage type: 2 Column name: C4 .

*** ERROR[8822] The statement was not prepared.

>>obey $$REGRTSTDIR$$/../executor/TEST130(update_lob_handle);
>>-- test lob update via "update lob" command
>>set schema trafodion.lob$$TESTNUM$$;

--- SQL operation complete.
>>drop table if exists t$$TESTNUM$$lob5;

--- SQL operation complete.
>>create table t$$TESTNUM$$lob5 (c1 int not null, c2 blob, c3 blob, primary key (c1));

--- SQL operation complete.
>>insert into t$$TESTNUM$$lob5 values (1,empty_blob(), empty_blob());

--- 1 row(s) inserted.
>>sh clitestdriver 6 < TEST$$TESTNUM$$_argfile3 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test update  lobhandle from a buffer 
Input lob table name :
Table name : TRAFODION.LOB130.t130lob5
Input lob column name to get handle from :
Column Name : c2
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937101093419820746103044844617618212445791957981885016TRAFODION.LOB130
>>select lobtostring(c2,20) from t$$TESTNUM$$lob5;

(EXPR)              
--------------------

zzzzzzzzzzzzzzzzzzzz

--- 1 row(s) selected.
>>sh clitestdriver 7 < TEST$$TESTNUM$$_argfile3 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test append  lobhandle from a buffer 
Input lob table name :
Table name : TRAFODION.LOB130.t130lob5
Input lob column name to get handle from :
Column Name : c2
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937101093419820746103044844617618212445791957981885016TRAFODION.LOB130
>>select lobtostring(c2,47) from t$$TESTNUM$$lob5;

(EXPR)                                         
-----------------------------------------------

zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz       

--- 1 row(s) selected.
>>sh clitestdriver 8 < TEST$$TESTNUM$$_argfile3 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test empty  lobhandle from a buffer 
Input lob table name :
Table name : TRAFODION.LOB130.t130lob5
Input lob column name to get handle from :
Column Name : c2
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937101093419820746103044844617618212445791957981885016TRAFODION.LOB130
>>select lobtostring(c2,20) from t$$TESTNUM$$lob5;

(EXPR)              
--------------------

                    

--- 1 row(s) selected.
>>sh clitestdriver 6 < TEST$$TESTNUM$$_argfile3 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test update  lobhandle from a buffer 
Input lob table name :
Table name : TRAFODION.LOB130.t130lob5
Input lob column name to get handle from :
Column Name : c2
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937101093419820746103044844617618212445791957981885016TRAFODION.LOB130
>>select lobtostring(c2,40) from t$$TESTNUM$$lob5;

(EXPR)                                  
----------------------------------------

zzzzzzzzzzzzzzzzzzzz                    

--- 1 row(s) selected.
>>
>>sh clitestdriver 1 < TEST$$TESTNUM$$_argfile3 2>/dev/null | tee -a LOG$$TESTNUM$$;
***********
   Blob test extract to user buffer 
***********
Extract from a lob column in a lob table

Input lob table name :
Table name : TRAFODION.LOB130.t130lob5
Input lob column name to extract from :
Column Name : c2
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937101093419820746103044844617618212445791957981885016TRAFODION.LOB130
Extracting LOB data length for the above handle...
LOB data length :20
Extracting lob data into user buffer in a loop ...
Writing 20 bytes from user buffer to file lob_output_file in current directory
Data: zzzzzzzzzzzzzzzzzzzz
LOB data length 2 :20
Extracting lob data into user buffer in a loop 2...
Writing 20 bytes from user buffer to file lob_output_file in current directory
Data: zzzzzzzzzzzzzzzzzzzz
LOB data length PrepExec :20
>>select length(c2), lobtostring(c2,100) from t$$TESTNUM$$lob5;

*** WARNING[4181] String funtions on CLOB type are limited to process CLOB data upto CQD value LOB_OUTPUT_SIZE (16777216)

(EXPR)      (EXPR)
----------  ----------------------------------------------------------------------------------------------------

        20  zzzzzzzzzzzzzzzzzzzz                                                                                

--- 1 row(s) selected.
>>
>>-- update 2 columns
>>select length(c2), lobtostring(c2,50), length(c3), lobtostring(c3,50) from t$$TESTNUM$$lob5;

*** WARNING[4181] String funtions on CLOB type are limited to process CLOB data upto CQD value LOB_OUTPUT_SIZE (16777216)

(EXPR)      (EXPR)                                              (EXPR)      (EXPR)
----------  --------------------------------------------------  ----------  --------------------------------------------------

        20  zzzzzzzzzzzzzzzzzzzz                                         0                                                    

--- 1 row(s) selected.
>>sh clitestdriver 10 < TEST$$TESTNUM$$_argfile4 2>/dev/null | tee -a LOG$$TESTNUM$$;
*************************************
Blob test update 2 columns using lobhandle 
Input lob table name :
Table name : TRAFODION.LOB130.t130lob5
Input lob column name 1 to get handle from :
Column Name 1 : c2
Input lob column name 2 to get handle from :
Column Name 2 : c3
Extracting  lob handle for column c2...
LOB handle for c2: LOBH0000000200010820746102937101093419820746103044844617618212445791957981885016TRAFODION.LOB130
Extracting  lob handle for column 2 c3...
LOB handle for c3: LOBH0000000200020820746102937101093419820746103045071993118212445791960198412016TRAFODION.LOB130
>>select length(c2), lobtostring(c2,50), length(c3), lobtostring(c3,50) from t$$TESTNUM$$lob5;

(EXPR)      (EXPR)                                              (EXPR)      (EXPR)
----------  --------------------------------------------------  ----------  --------------------------------------------------

        20  zzzzzzzzzzzzzzzzzzzz                                        20  zzzzzzzzzzzzzzzzzzzz                              

--- 1 row(s) selected.
>>
>>delete from t$$TESTNUM$$lob5;

--- 1 row(s) deleted.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(update_lob_handle_ext);
>>-- test_empty_blob() with external tables
>>delete from tlob$$TESTNUM$$ext;

--- 3 row(s) deleted.
>>-- following empty_blob will be of type 'external'
>>insert into tlob$$TESTNUM$$ext values(1,empty_blob(),empty_clob(),empty_blob());

--- 1 row(s) inserted.
>>select c2 from tlob$$TESTNUM$$ext;

C2
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

LOBH0000000200010820746102937099494719820746103057191388518212445792082436862016TRAFODION.LOB130                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>-- following should return error since only external lobs will be allowed
>>update tlob$$TESTNUM$$ext set c4=stringtolob('gggg');

*** ERROR[1432] Input LOB type 2 does not match column's storage type: 5 Column name: C4 .

*** ERROR[8822] The statement was not prepared.

>>-- following should work. 
>>update tlob$$TESTNUM$$ext set c4=externaltolob('hdfs:///user/trafodion/lobs/lob_input_b1.txt');

--- 1 row(s) updated.
>>delete from tlob$$TESTNUM$$ext;

--- 1 row(s) deleted.
>>
>>-- test to ensure all lob dependent tables and schemas containing lob tables
>>-- get dropped cleanly.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_drop_table_schema);
>>drop schema if exists trafodion.lobsch cascade;

--- SQL operation complete.
>>cleanup schema trafodion.lobsch;

*** WARNING[4255] Provided schema name does not exist in metadata. Cleanup will be performed on objects in this schema, if they exist.

--- SQL operation complete.
>>create schema trafodion.lobsch;

--- SQL operation complete.
>>set schema trafodion.lobsch;

--- SQL operation complete.
>>create table tlob$$TESTNUM$$ts1 (c1 int not null, c2 blob, primary key (c1));

--- SQL operation complete.
>>create table tlob$$TESTNUM$$ts2 (c1 int not null, c2 blob, primary key (c1));

--- SQL operation complete.
>>drop table tlob$$TESTNUM$$ts1;

--- SQL operation complete.
>>get tables;

Tables in Schema TRAFODION.LOBSCH
=================================

LOBDescChunks__08207461029371028987_0001
LOBDescHandle__08207461029371028987_0001
LOBMD__08207461029371028987
SB_HISTOGRAMS
SB_HISTOGRAM_INTERVALS
SB_PERSISTENT_SAMPLES
TLOB130TS2

=======================
 7 row(s) returned

--- SQL operation complete.
>>drop schema trafodion.lobsch cascade;

--- SQL operation complete.
>>select OBJECT_NAME,OBJECT_TYPE from TRAFODION."_MD_".OBJECTS where catalog_name='TRAFODION' AND schema_name='LOBSCH';

--- 0 row(s) selected.
>>--go back to the schema used for the rest of the tests.
>>set schema trafodion.lob$$TESTNUM$$;

--- SQL operation complete.
>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(fix_mantis_8944);
>>create table myloben (id int, data clob);

--- SQL operation complete.
>>insert into table myloben values (0, stringtolob('data'));

--- 1 row(s) inserted.
>>extract loblength(LOB 'select data from myloben');

*** ERROR[3242] This statement is not supported. Reason: ExeUtilExpr::bindLobHandle::1. Provided LOB handle is invalid. Handle=select data from myloben

*** ERROR[8822] The statement was not prepared.

>>
>>obey $$REGRTSTDIR$$/../executor/TEST130(lob_general_cleanup);
>>sh rm -f t$$TESTNUM$$_*;
>>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/tlob$$TESTNUM$$*
+>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/lobinput_a1.txt
+>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/lobinput_b1.txt
+>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/lobinput_c1.txt
+>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/lobinput_d1.txt
+>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/lobinput_e1.txt
+>sh regrhadoop.ksh fs -rm -f /user/trafodion/lobs/reallyLongDirectoryName0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789/lob_input_a1012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789.txt;
>>sh rm -f lobinput_*;
>>sh rm -f deep.jpg;
>>sh rm -f anoush.jpg;
>>drop table if exists tlob$$TESTNUM$$txt1;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin1;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$txt_limit50;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin_limit1K;

--- SQL operation complete.
>>sh rm -f TMPLOG;
>>sh rm -f tlob$$TESTNUM$$txt1;
>>
>>sh rm -f tlob$$TESTNUM$$_txt*.txt;
>>sh rm -f tlob$$TESTNUM$$_deep*.jpg;
>>sh rm -f tlob$$TESTNUM$$_anoush*.jpg;
>>drop table if exists tlob$$TESTNUM$$txt3;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin3;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bt;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$txt2;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$bin2;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$ext;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$ext2;

--- SQL operation complete.
>>sh rm -f TMPLOG;
>>sh rm -f tlob$$TESTNUM$$txt2;
>>sh rm -f lobc2out.jpg;
>>sh rm -f lobc4ext.txt;
>>sh rm -f TEST$$TESTNUM$$_argfile*;
>>drop table if exists tlob$$TESTNUM$$gc;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$gt;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$t5;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$_not_external;

--- SQL operation complete.
>>drop table if exists myloben cascade;

--- SQL operation complete.
>>drop external table if exists date_dim for hive.hive.date_dim;

--- SQL operation complete.
>>drop table if exists tlob$$TESTNUM$$tinline;

--- SQL operation complete.
>>drop schema if exists trafodion.lob$$TESTNUM$$ cascade;

--- SQL operation complete.
>>
>>
>>
>>
>>log;
