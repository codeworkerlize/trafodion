-- ============================================================================
-- Test: TEST0141 (Executor)
-- @@@ START COPYRIGHT @@@
--
-- Licensed to the Apache Software Foundation (ASF) under one
-- or more contributor license agreements.  See the NOTICE file
-- distributed with this work for additional information
-- regarding copyright ownership.  The ASF licenses this file
-- to you under the Apache License, Version 2.0 (the
-- "License"); you may not use this file except in compliance
-- with the License.  You may obtain a copy of the License at
--
--   http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing,
-- software distributed under the License is distributed on an
-- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
-- KIND, either express or implied.  See the License for the
-- specific language governing permissions and limitations
-- under the License.
--
-- @@@ END COPYRIGHT @@@
--
-- Functionality: Test invalidation function
-- Expected files: EXPECTED141
-- Table created: t141idxa t141idxb t141idxc helper
-- Limitations:
-- To do:
-- Revision history:
-- ============================================================================
obey TEST141(clnup);
obey TEST141(ddl);
log LOG141 clear;
obey TEST141(drop_view_vs_select);
obey TEST141(cleanup_view_vs_select);
obey TEST141(drop_index_vs_select_index);
obey TEST141(drop_table_vs_select_index);
obey TEST141(cleanup_index_vs_select_index);
obey TEST141(cleanup_table_vs_select_table);
obey TEST141(drop_table_vs_select_table);
log;
obey TEST141(clnup);
exit;

?section clnup
drop view if exists t141va;
drop view if exists t141vb;
drop index if exists t141idxa;
drop index if exists t141idxb;
drop index if exists t141idxc;
drop table if exists t141a;
drop table if exists t141b;
drop table if exists t141c;

?section ddl

create table t141a (a1 int primary key, a2 int, a3 int);
create table t141b (a1 int primary key, a2 int, a3 int);
create table t141c (a1 int primary key, a2 int, a3 int);
create index t141idxa on t141a(a2);
create index t141idxb on t141b(a2);
create index t141idxc on t141c(a2);
create view t141va as select * from t141a;
create view t141vb as select * from t141b;


?section drop_t141va
drop view t141va;

?section cleanup_t141vb
cleanup view t141vb;

?section drop_t141idxa
drop index t141idxa;

?section drop_t141idxb
drop index t141idxb;

?section cleanup_t141idxc
cleanup index t141idxc;

?section cleanup_t141a
cleanup table t141a;

?section drop_t141b
drop table t141b;

?section drop_t141c
drop table t141c;

?section drop_view_vs_select

select * from t141va;
sh sqlci -i "TEST141(drop_t141va)" ;
select * from t141va;

?section cleanup_view_vs_select

select * from t141vb;
sh sqlci -i "TEST141(cleanup_t141vb)";
select * from t141vb;

?section drop_index_vs_select_index

set parserflags 1;
select * from table (index_table t141idxa);
sh sqlci -i "TEST141(drop_t141idxa)";
select * from table (index_table t141idxa);

?section drop_table_vs_select_index

set parserflags 1;
select * from table (index_table t141idxb);
sh sqlci -i "TEST141(drop_t141b)";
select * from table (index_table t141idxb);

?section cleanup_index_vs_select_index

set parserflags 1;
select * from table (index_table t141idxc);
sh sqlci -i "TEST141(cleanup_t141idxc)" ;
select * from table (index_table t141idxc);

?section cleanup_table_vs_select_table

select * from t141a;
sh sqlci -i "TEST141(cleanup_t141a)";
select * from t141a;

?section drop_table_vs_select_table

select * from t141c;
sh sqlci -i "TEST141(drop_t141c)";
select * from t141c;
