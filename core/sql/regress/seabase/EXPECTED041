>>obey TEST041(creates);
>>create table t041t1 (a int not null primary key, b int)
+>  attribute storage monarch;

--- SQL operation complete.
>>invoke t041t1;

-- Definition of Monarch table TRAFODION.TEST041_SCH.T041T1
-- Definition current  Mon Apr 24 23:15:28 2017

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  )
  PRIMARY KEY (A ASC)

--- SQL operation complete.
>>create index t041t1i1 on t041t1 (b);

--- SQL operation complete.
>>invoke t041t1;

-- Definition of Monarch table TRAFODION.TEST041_SCH.T041T1
-- Definition current  Mon Apr 24 23:15:33 2017

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  )
  PRIMARY KEY (A ASC)

--- SQL operation complete.
>>
>>cqd traf_default_storage_type 'MONARCH';

--- SQL operation complete.
>>create table t041t2 (a int not null primary key, b int);

--- SQL operation complete.
>>invoke t041t2;

-- Definition of Monarch table TRAFODION.TEST041_SCH.T041T2
-- Definition current  Mon Apr 24 23:15:35 2017

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  )
  PRIMARY KEY (A ASC)

--- SQL operation complete.
>>create index t041t2i1 on t041t2 (b);

--- SQL operation complete.
>>invoke t041t2;

-- Definition of Monarch table TRAFODION.TEST041_SCH.T041T2
-- Definition current  Mon Apr 24 23:15:40 2017

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  )
  PRIMARY KEY (A ASC)

--- SQL operation complete.
>>
>>create table t041t3 (a int not null primary key, b int)
+>  attribute storage hbase;

--- SQL operation complete.
>>invoke t041t3;

-- Definition of Trafodion table TRAFODION.TEST041_SCH.T041T3
-- Definition current  Mon Apr 24 23:15:46 2017

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  )
  PRIMARY KEY (A ASC)

--- SQL operation complete.
>>create index t041t3i1 on t041t3 (b);

--- SQL operation complete.
>>invoke t041t3;

-- Definition of Trafodion table TRAFODION.TEST041_SCH.T041T3
-- Definition current  Mon Apr 24 23:15:53 2017

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  )
  PRIMARY KEY (A ASC)

--- SQL operation complete.
>>
>>obey TEST041(inserts);
>>explain options 'f' insert into t041t1 values (1,2);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                  o                               1.00E+000
1    2    3    nested_join                                           1.00E+000
.    .    2    monarch_insert                  T041T1I1              1.00E+000
.    .    1    monarch_insert                  T041T1                1.00E+000

--- SQL operation complete.
>>insert into t041t1 values (1,2);

--- 1 row(s) inserted.
>>explain options 'f' upsert into t041t1 values (3,4);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

10   .    11   root                  o                               2.00E+000
6    9    10   nested_join                                           2.00E+000
7    8    9    blocked_union                                         2.00E+000
.    .    8    monarch_insert                  T041T1I1              1.00E+000
.    .    7    monarch_delete                  T041T1I1              1.00E+000
4    5    6    nested_join                                           1.00E+000
.    .    5    monarch_upsert                  T041T1                1.00E+000
3    .    4    sequence                                              1.00E+000
1    2    3    left_nested_join                                      1.00E+000
.    .    2    monarch_scan                    T041T1                1.00E+000
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>upsert into t041t1 values (3,4);

--- 1 row(s) inserted.
>>upsert into t041t1 values (5,6), (7,8);

--- 2 row(s) inserted.
>>
>>obey TEST041(selects);
>>control query shape scan(path 'T041T1');

--- SQL operation complete.
>>explain options 'f' select * from t041t1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                                                  1.00E+002
.    .    1    monarch_scan                    T041T1                1.00E+002

--- SQL operation complete.
>>select * from t041t1;

A            B          
-----------  -----------

          1            2
          3            4
          5            6
          7            8

--- 4 row(s) selected.
>>control query shape cut;

--- SQL operation complete.
>>explain options 'f' select * from table(index_table t041t1i1);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                                                  1.00E+002
.    .    1    monarch_scan                    T041T1I1              1.00E+002

--- SQL operation complete.
>>select * from table(index_table t041t1i1);

B@           A          
-----------  -----------

          2            1
          4            3
          6            5
          8            7

--- 4 row(s) selected.
>>explain options 'f' select * from t041t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    monarch_scan                    T041T1                1.00E+000

--- SQL operation complete.
>>select * from t041t1 where a = 1;

A            B          
-----------  -----------

          1            2

--- 1 row(s) selected.
>>select * from t041t1 where a = 0;

--- 0 row(s) selected.
>>
>>
>>obey TEST041(drop_index);
>>drop index t041t1i1;

--- SQL operation complete.
>>
>>obey TEST041(deletes_1);
>>explain options 'f' delete from t041t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    monarch_delete                  T041T1                1.00E+000

--- SQL operation complete.
>>delete from t041t1 where a = 1;

--- 1 row(s) deleted.
>>
>>obey TEST041(selects_base_table);
>>control query shape scan(path 'T041T1');

--- SQL operation complete.
>>select * from t041t1;

A            B          
-----------  -----------

          3            4
          5            6
          7            8

--- 3 row(s) selected.
>>control query shape cut;

--- SQL operation complete.
>>
>>obey TEST041(deletes_all);
>>explain options 'f' delete from t041t1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+002
.    .    1    monarch_delete                  T041T1                1.00E+002

--- SQL operation complete.
>>delete from t041t1;

--- 3 row(s) deleted.
>>
>>obey TEST041(selects_base_table);
>>control query shape scan(path 'T041T1');

--- SQL operation complete.
>>select * from t041t1;

--- 0 row(s) selected.
>>control query shape cut;

--- SQL operation complete.
>>
>>
>>obey TEST041(create_index);
>>create index t041t1i1 on t041t1 (b);

--- SQL operation complete.
>>
>>obey TEST041(inserts);
>>explain options 'f' insert into t041t1 values (1,2);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                  o                               1.00E+000
1    2    3    nested_join                                           1.00E+000
.    .    2    monarch_insert                  T041T1I1              1.00E+000
.    .    1    monarch_insert                  T041T1                1.00E+000

--- SQL operation complete.
>>insert into t041t1 values (1,2);

--- 1 row(s) inserted.
>>explain options 'f' upsert into t041t1 values (3,4);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

10   .    11   root                  o                               2.00E+000
6    9    10   nested_join                                           2.00E+000
7    8    9    blocked_union                                         2.00E+000
.    .    8    monarch_insert                  T041T1I1              1.00E+000
.    .    7    monarch_delete                  T041T1I1              1.00E+000
4    5    6    nested_join                                           1.00E+000
.    .    5    monarch_upsert                  T041T1                1.00E+000
3    .    4    sequence                                              1.00E+000
1    2    3    left_nested_join                                      1.00E+000
.    .    2    monarch_scan                    T041T1                1.00E+000
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>upsert into t041t1 values (3,4);

--- 1 row(s) inserted.
>>upsert into t041t1 values (5,6), (7,8);

--- 2 row(s) inserted.
>>
>>obey TEST041(deletes_1);
>>explain options 'f' delete from t041t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                  o                               1.00E+000
1    2    3    nested_join                                           1.00E+000
.    .    2    monarch_delete                  T041T1I1              1.00E+000
.    .    1    monarch_delete                  T041T1                1.00E+000

--- SQL operation complete.
>>delete from t041t1 where a = 1;

--- 1 row(s) deleted.
>>
>>obey TEST041(selects_all);
>>control query shape scan(path 'T041T1');

--- SQL operation complete.
>>select * from t041t1;

A            B          
-----------  -----------

          3            4
          5            6
          7            8

--- 3 row(s) selected.
>>control query shape cut;

--- SQL operation complete.
>>select * from table(index_table t041t1i1);

B@           A          
-----------  -----------

          4            3
          6            5
          8            7

--- 3 row(s) selected.
>>
>>obey TEST041(deletes_all);
>>explain options 'f' delete from t041t1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                                                  1.00E+002
1    2    3    nested_join                                           1.00E+002
.    .    2    monarch_delete                  T041T1I1              1.00E+000
.    .    1    monarch_delete                  T041T1                1.00E+002

--- SQL operation complete.
>>delete from t041t1;

--- 3 row(s) deleted.
>>
>>obey TEST041(selects_all);
>>control query shape scan(path 'T041T1');

--- SQL operation complete.
>>select * from t041t1;

--- 0 row(s) selected.
>>control query shape cut;

--- SQL operation complete.
>>select * from table(index_table t041t1i1);

--- 0 row(s) selected.
>>
>>
>>--obey TEST041(clean_up);
>>log;
