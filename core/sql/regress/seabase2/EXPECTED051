>>
>>-- should not show any entries
>>cleanup metadata, check, return details;
Metadata Cleanup: started, check only

  Start: Cleanup Orphan Objects Entries
  End:   Cleanup Orphan Objects Entries (0 entries found)

  Start: Cleanup Orphan Hbase Entries
  End:   Cleanup Orphan Hbase Entries (0 entries found)

  Start: Cleanup Inconsistent Objects Entries
  End:   Cleanup Inconsistent Objects Entries (0 entries found)

  Start: Cleanup Inconsistent Partitions Entries
  End:   Cleanup Inconsistent Partitions Entries (0 entries found)

  Start: Cleanup Inconsistent Views Entries
  End:   Cleanup Inconsistent Views Entries (0 entries found)

  Start: Cleanup Inconsistent Hive Entries
  End:   Cleanup Inconsistent Hive Entries (0 entries found)

  Start: Cleanup Inconsistent Privilege Entries
  End:   Cleanup Inconsistent Privilege Entries (0 entries found)

  Start: Cleanup Inconsistent User Group Entries
  End:   Cleanup Inconsistent User Group Entries (0 entries found)

  Start: Cleanup Inconsistent TEXT Entries
  End:   Cleanup Inconsistent TEXT Entries (0 entries found)

Metadata Cleanup: done


--- SQL operation complete.
>>
>>cqd traf_blob_as_varchar 'OFF';

--- SQL operation complete.
>>
>>-- return error, tag doesn't exist
>>drop backup snapshot, tag 'test051';

*** ERROR[5050] DROP BACKUP SNAPSHOT command could not be completed. Reason: Specified tag does not exist.

--- SQL operation failed with errors.
>>
>>drop schema if exists sch051 cascade;

--- SQL operation complete.
>>create schema sch051;

--- SQL operation complete.
>>set schema sch051;

--- SQL operation complete.
>>cqd traf_restore_parallel '1';

--- SQL operation complete.
>>
>>-- precreate tags
>>backup trafodion, create tags ('test051incr1', 'test051incr2', 'test051incr3');

--- SQL operation complete.
>>
>>-- incremental backup tests
>>drop schema if exists sch0511 cascade;

--- SQL operation complete.
>>create schema if not exists sch0511;

--- SQL operation complete.
>>showddl schema sch0511;

CREATE PRIVATE SCHEMA TRAFODION.SCH0511 AUTHORIZATION DB__ROOT NAMESPACE
  'TRAF_regr'  STORED DESC ;

--- SQL operation complete.
>>
>>set schema sch0511;

--- SQL operation complete.
>>
>>cqd TRAF_NON_XN_INCR_BACKUP_OPERATION 'ON';

--- SQL operation complete.
>>create table loadt(
+>        colkey int not null,
+>        colint int not null,
+>        -- coldate date,
+>        colnum numeric(11,3),
+>        colchariso char(11) character set iso88591 not null,
+>        colcharucs2 char(11) character set ucs2 not null,
+>        colintn int,
+>        -- colts timestamp,
+>        colcharison char(13) character set iso88591,
+>        colcharucs2n char(13) character set ucs2,
+>        primary key(colint, colchariso, colcharucs2, colkey)
+>        ) attributes incremental backup
+>        ;

--- SQL operation complete.
>>
>>load into loadt select
+>         c1+c2*10+c3*100+c4*1000+c5*10000, --colkey
+>         c1+c2*10+c3*100+c4*1000+c5*10000, --colint
+>         cast(c1+c2*10+c3*100+c4*1000+c5*10000 as numeric(11,3)), --colnum
+>        cast(c1+c2*10+c3*100+c4*1000+c5*10000 as char(11) character set iso88591), --colchariso
+>          cast(c1+c2*10+c3*100+c4*1000+c5*10000 as char(11) character set ucs2), --colcharucs2
+>         c1+c2*10+c3*100+c4*1000+c5*10000, --colintn
+>         cast(c1+c2*10+c3*100+c4*1000+c5*10000 as char(13) character set iso88591), --colvchriso
+>         cast(c1+c2*10+c3*100+c4*1000+c5*10000 as char(13) character set ucs2) --colvchrucs2
+>         from (values(1)) t
+>         transpose 0,1,2,3,4,5,6,7,8,9 as c1
+>         transpose 0,1,2,3,4,5,6,7,8,9 as c2
+>         transpose 0,1,2,3,4,5,6,7,8,9 as c3
+>        transpose 0,1,2,3,4,5,6,7,8,9 as c4
+>        transpose 0,1,2,3,4,5,6,7,8,9 as c5
+>           ;
Task:  LOAD            Status: Started    Object: TRAFODION.SCH0511.LOADT
Task:  CLEANUP         Status: Started    Time: 2019-10-22 04:42:46.461681
Task:  CLEANUP         Status: Ended      Time: 2019-10-22 04:42:46.475272
Task:  CLEANUP         Status: Ended      Elapsed Time:    00:00:00.014
Task:  LOADING DATA    Status: Started    Time: 2019-10-22 04:42:46.475325
       Rows Processed: 100000 
       Error Rows:     0 
Task:  LOADING DATA    Status: Ended      Time: 2019-10-22 04:42:56.143023
Task:  LOADING DATA    Status: Ended      Elapsed Time:    00:00:09.668
Task:  COMPLETION      Status: Started    Time: 2019-10-22 04:42:56.143079
       Rows Loaded:    100000 
Task:  COMPLETION      Status: Ended      Time: 2019-10-22 04:42:57.189789
Task:  COMPLETION      Status: Ended      Elapsed Time:    00:00:01.047

--- 100000 row(s) loaded.
>>
>>select count(*) from loadt;

(EXPR)              
--------------------

              100000

--- 1 row(s) selected.
>>
>>-- Should succeed, but will perform regular snapshot since prior doesn't exist
>>backup trafodion, tag 'test051incr1', table(loadt),incremental,override;

--- SQL operation complete.
>>get all backup snapshots, match 'test051%';

BackupTag      BackupTime           BackupStatus  BackupOperation        BackupOwner
======================================================================================

test051incr1   2019-10-22:04:43:16  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>
>>-- Add 2 more rows to our incremental table
>>insert into loadt values(100001,100001,100001.000,'100001','100001',100001,'100001','100001');

--- 1 row(s) inserted.
>>insert into loadt values(100002,100002,100002.000,'100002','100002',100002,'100002','100002');

--- 1 row(s) inserted.
>>select count(*) from loadt;

(EXPR)              
--------------------

              100002

--- 1 row(s) selected.
>>
>>-- Reusing the tag.  This is a drop and new incremental backup. Mantis 6542
>>backup trafodion, tag 'test051incr1', table(loadt),incremental,override;

--- SQL operation complete.
>>get all backup snapshots, match 'test051%';

BackupTag      BackupTime           BackupStatus  BackupOperation        BackupOwner
======================================================================================

test051incr1   2019-10-22:04:43:31  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>
>>drop table loadt cascade;

--- SQL operation complete.
>>restore trafodion, tag 'test051incr1';

--- SQL operation complete.
>>select count(*) from loadt;

*** WARNING[6008] Statistics for column (COLKEY) from table TRAFODION.SCH0511.LOADT were not available. As a result, the access path chosen might not be the best possible.

*** WARNING[6008] Statistics for column (COLINT) from table TRAFODION.SCH0511.LOADT were not available. As a result, the access path chosen might not be the best possible.

*** WARNING[6008] Statistics for column (COLCHARISO) from table TRAFODION.SCH0511.LOADT were not available. As a result, the access path chosen might not be the best possible.

*** WARNING[6008] Statistics for column (COLCHARUCS2) from table TRAFODION.SCH0511.LOADT were not available. As a result, the access path chosen might not be the best possible.

(EXPR)              
--------------------

              100002

--- 1 row(s) selected.
>>cqd TRAF_NON_XN_INCR_BACKUP_OPERATION 'OFF';

--- SQL operation complete.
>>
>>create table t1incr(a int not null primary key, b int) 
+>  attribute incremental backup;

--- SQL operation complete.
>>showddl t1incr;

CREATE TABLE TRAFODION.SCH0511.T1INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr' INCREMENTAL BACKUP
;

--- SQL operation complete.
>>alter table t1incr attribute no incremental backup;

--- SQL operation complete.
>>showddl t1incr;

CREATE TABLE TRAFODION.SCH0511.T1INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
;

--- SQL operation complete.
>>alter table t1incr attribute incremental backup;

--- SQL operation complete.
>>create table t2noincr(a int);

--- SQL operation complete.
>>showddl t2noincr;

CREATE TABLE TRAFODION.SCH0511.T2NOINCR
  (
    A                                INT DEFAULT NULL
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
;

--- SQL operation complete.
>>create table t2incr(a int not null primary key, b int, c blob) 
+>  attribute incremental backup;

--- SQL operation complete.
>>showddl t2incr;

CREATE TABLE TRAFODION.SCH0511.T2INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , C                                BLOB( 5368709120 bytes) DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr' INCREMENTAL BACKUP
;

--- SQL operation complete.
>>
>>insert into t2noincr values (1);

--- 1 row(s) inserted.
>>
>>insert into t1incr values (1, 10);

--- 1 row(s) inserted.
>>explain options 'f' insert into t1incr values (1,10);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     1.00E+000
.    .    1    trafodion_insert                T1INCR                1.00E+000

--- SQL operation complete.
>>insert into t2incr values (1, 10, '50');

--- 1 row(s) inserted.
>>backup trafodion, tag 'test051reg1', tables (t1incr, t1incr, t2noincr), override;

--- SQL operation complete.
>>upsert into t1incr values (1,10), (2,20), (3,30);

--- 3 row(s) inserted.
>>upsert into t2incr values (1,10,'10');

--- 1 row(s) inserted.
>>upsert into t2incr values (2,20,'20');

--- 1 row(s) inserted.
>>upsert into t2incr values (3,30,'30');

--- 1 row(s) inserted.
>>backup trafodion, tag 'test051incr1', tables (t2noincr, t1incr, t2incr), incremental, override;

--- SQL operation complete.
>>update t1incr set b = 30 where a = 2;

--- 1 row(s) updated.
>>update t2incr set b = 30 where a = 2;

--- 1 row(s) updated.
>>update t2incr set c = '30' where a = 2;

--- 1 row(s) updated.
>>delete from t1incr where a = 1 and b = 20;

--- 0 row(s) deleted.
>>delete from t2incr where a = 1 and b = 20;

--- 0 row(s) deleted.
>>-- expect (1, 10), (2, 30), (3, 30)
>>select * from t1incr;

A            B          
-----------  -----------

          1           10
          2           30
          3           30

--- 3 row(s) selected.
>>-- expect (1, 10, '10'), (2, 30, '30'), (3, 30, '30')
>>select a, b, lobtostring(c,100) from t2incr;

A            B            (EXPR)
-----------  -----------  ----------------------------------------------------------------------------------------------------

          1           10  10                                                                                                  
          2           30  30                                                                                                  
          3           30  30                                                                                                  

--- 3 row(s) selected.
>>-- Here we have pending mutations for t1incr and t2incr.  When we restore a subset of
>>-- incremental tables from the incremental backup we should see mutations for t1incr
>>-- removed, but mutations for t2incr left untouched.  A subsequent backup will prove.
>>-- Mantis 7197
>>restore trafodion, tag 'test051incr1', tables (t1incr);

--- SQL operation complete.
>>-- expect (1, 10), (2, 20), (3, 30)
>>select * from t1incr;

A            B          
-----------  -----------

          1           10
          2           20
          3           30

--- 3 row(s) selected.
>>-- expect (1, 10, '10'), (2, 30, '30'), (3, 30, '30')
>>select a, b, lobtostring(c,100) from t2incr;

A            B            (EXPR)
-----------  -----------  ----------------------------------------------------------------------------------------------------

          1           10  10                                                                                                  
          2           30  30                                                                                                  
          3           30  30                                                                                                  

--- 3 row(s) selected.
>>backup trafodion, tag 'test051incr2', tables (t2noincr, t1incr, t2incr), incremental, override;

--- SQL operation complete.
>>update t1incr set b = 40 where a = 2;

--- 1 row(s) updated.
>>update t2incr set b = 40 where a = 2;

--- 1 row(s) updated.
>>update t2incr set c = '40' where a = 2;

--- 1 row(s) updated.
>>restore trafodion, tag 'test051incr2';

--- SQL operation complete.
>>-- expect (1, 10), (2, 20), (3, 30)
>>select * from t1incr;

A            B          
-----------  -----------

          1           10
          2           20
          3           30

--- 3 row(s) selected.
>>-- expect (1, 10, '10'), (2, 30, '30'), (3, 30, '30') 
>>select a, b, lobtostring(c,100) from t2incr;

A            B            (EXPR)
-----------  -----------  ----------------------------------------------------------------------------------------------------

          1           10  10                                                                                                  
          2           30  30                                                                                                  
          3           30  30                                                                                                  

--- 3 row(s) selected.
>>restore trafodion, tag 'test051reg1';

--- SQL operation complete.
>>showddl t1incr;

CREATE TABLE TRAFODION.SCH0511.T1INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr' INCREMENTAL BACKUP
;

--- SQL operation complete.
>>select * from t1incr;

A            B          
-----------  -----------

          1           10

--- 1 row(s) selected.
>>restore trafodion, tag 'test051incr1';

--- SQL operation complete.
>>showddl t1incr;

CREATE TABLE TRAFODION.SCH0511.T1INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr' INCREMENTAL BACKUP
;

--- SQL operation complete.
>>select * from t1incr;

A            B          
-----------  -----------

          1           10
          2           20
          3           30

--- 3 row(s) selected.
>>
>>get all backup snapshots, match 'test051%';

BackupTag      BackupTime           BackupStatus  BackupOperation        BackupOwner
======================================================================================

test051reg1    2019-10-22:04:46:52  VALID         REGULAR                DB__ROOT
test051incr1   2019-10-22:04:47:04  VALID         INCREMENTAL            DB__ROOT
test051incr2   2019-10-22:04:48:07  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>select a, b, lobtostring(c,100) from t2incr;

A            B            (EXPR)
-----------  -----------  ----------------------------------------------------------------------------------------------------

          1           10  10                                                                                                  
          2           20  20                                                                                                  
          3           30  30                                                                                                  

--- 3 row(s) selected.
>>select a, b, lobtostring(c,100) from t1incr;

*** ERROR[4001] Column C is not found.  Tables in scope: TRAFODION.SCH0511.T1INCR.  Default schema: TRAFODION.SCH0511.

*** ERROR[8822] The statement was not prepared.

>>
>>create index t1incri1 on t1incr(b);

--- SQL operation complete.
>>showddl t1incr;

CREATE TABLE TRAFODION.SCH0511.T1INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr' INCREMENTAL BACKUP
;

CREATE INDEX T1INCRI1 ON TRAFODION.SCH0511.T1INCR
  (
    B ASC
  )
;

--- SQL operation complete.
>>backup trafodion, tag 'test051incr3', table (t1incr), override;

--- SQL operation complete.
>>insert into t1incr values (4,40);

--- 1 row(s) inserted.
>>backup trafodion, tag 'test051incr4', table (t1incr), incremental, override;

--- SQL operation complete.
>>get all backup snapshots, match 'test051%';

BackupTag      BackupTime           BackupStatus  BackupOperation        BackupOwner
======================================================================================

test051reg1    2019-10-22:04:46:52  VALID         REGULAR                DB__ROOT
test051incr1   2019-10-22:04:47:04  VALID         INCREMENTAL            DB__ROOT
test051incr2   2019-10-22:04:48:07  VALID         INCREMENTAL            DB__ROOT
test051incr3   2019-10-22:04:51:22  VALID         REGULAR                DB__ROOT
test051incr4   2019-10-22:04:53:10  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>restore trafodion, tag 'test051incr4', table (t1incr);

--- SQL operation complete.
>>showddl t1incr;

CREATE TABLE TRAFODION.SCH0511.T1INCR
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr' INCREMENTAL BACKUP
;

CREATE INDEX T1INCRI1 ON TRAFODION.SCH0511.T1INCR
  (
    B ASC
  )
;

--- SQL operation complete.
>>select * from t1incr;

A            B          
-----------  -----------

          1           10
          2           20
          3           30
          4           40

--- 4 row(s) selected.
>>purgedata t1incr;

--- SQL operation complete.
>>backup trafodion, tag 'test051incr5', table (t1incr), incremental, override;

--- SQL operation complete.
>>select * from t1incr;

--- 0 row(s) selected.
>>get all backup snapshots, match 'test051%';

BackupTag      BackupTime           BackupStatus  BackupOperation        BackupOwner
======================================================================================

test051reg1    2019-10-22:04:46:52  VALID         REGULAR                DB__ROOT
test051incr1   2019-10-22:04:47:04  VALID         INCREMENTAL            DB__ROOT
test051incr2   2019-10-22:04:48:07  VALID         INCREMENTAL            DB__ROOT
test051incr3   2019-10-22:04:51:22  VALID         REGULAR                DB__ROOT
test051incr4   2019-10-22:04:53:10  VALID         INCREMENTAL            DB__ROOT
test051incr5   2019-10-22:04:55:52  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>
>>-- incremental backup error cases
>>drop index t1incri1;

--- SQL operation complete.
>>delete with no rollback from t1incr;

*** ERROR[1425] This operation could not be performed on TRAFODION.SCH0511.T1INCR. Reason: Non-transactional operations not supported on tables enabled for incremental backup.

*** ERROR[8822] The statement was not prepared.

>>upsert using load into t1incr values (5,50);

*** ERROR[1425] This operation could not be performed on TRAFODION.SCH0511.T1INCR. Reason: Non-transactional operations not supported on tables enabled for incremental backup.

*** ERROR[8822] The statement was not prepared.

>>create volatile table t (a int) attribute incremental backup;

*** ERROR[3242] This statement is not supported. Reason: Cannot specify 'incremental backup' for volatile tables.

--- SQL operation failed with errors.
>>
>>-- cannot drop, dependent objects exist
>>drop backup snapshot, tag 'test051reg1';

*** ERROR[5050] DROP BACKUP SNAPSHOT command could not be completed. Reason: Error occurred during delete Backup operation.

--- SQL operation failed with errors.
>>
>>-- Should restore t1incr
>>restore trafodion, tag 'test051reg1';

--- SQL operation complete.
>>
>>select * from t1incr;

A            B          
-----------  -----------

          1           10

--- 1 row(s) selected.
>>
>>-- need to drop incr backup first as cascade option doesn't work yet. TBD.
>>drop backup snapshot, tag 'test051incr5';

--- SQL operation complete.
>>drop backup snapshot, tag 'test051incr4';

--- SQL operation complete.
>>drop backup snapshot, tag 'test051incr3';

--- SQL operation complete.
>>drop backup snapshot, tag 'test051incr2';

--- SQL operation complete.
>>drop backup snapshot, tag 'test051incr1';

--- SQL operation complete.
>>drop backup snapshot, tag 'test051reg1', force, cascade;

--- SQL operation complete.
>>
>>-- incr backup with cdc
>>drop table if exists t1incr6;

--- SQL operation complete.
>>create table t1incr6 (i int, j int) attribute incremental backup;

--- SQL operation complete.
>>backup trafodion, tag 'test051reg1', tables(t1incr6), override;

--- SQL operation complete.
>>upsert into t1incr6 values (1,1), (2, 2), (1, 2), (2, 1);

--- 4 row(s) inserted.
>>update t1incr6 set i = 5 where j = 2;

--- 2 row(s) updated.
>>delete from t1incr6 where i = 1;

--- 1 row(s) deleted.
>>select * from t1incr6 order by 1,2;

I            J          
-----------  -----------

          2            1
          5            2
          5            2

--- 3 row(s) selected.
>>backup trafodion, tag 'test051incr1', tables(t1incr6), incremental, override;

--- SQL operation complete.
>>restore trafodion, tag 'test051incr1', tables(t1incr6);

--- SQL operation complete.
>>select * from t1incr6 order by 1,2;

I            J          
-----------  -----------

          2            1
          5            2
          5            2

--- 3 row(s) selected.
>>
>>drop backup snapshot, tag 'test051incr1';

--- SQL operation complete.
>>drop backup snapshot, tag 'test051reg1', force, cascade;

--- SQL operation complete.
>>
>>--M7900
>>create table test3(a int, b varchar(20)) attribute incremental backup;

--- SQL operation complete.
>>backup trafodion, tag 'test051reg1', table(test3),override;

--- SQL operation complete.
>>-- expect 0 rows
>>select * from test3;

--- 0 row(s) selected.
>>insert into test3 values(1,'inc1');

--- 1 row(s) inserted.
>>backup trafodion, tag 'test051incr1', table(test3),incremental,override;

--- SQL operation complete.
>>alter table test3 add column addco11 varchar(20);

--- SQL operation complete.
>>insert into test3 values(2,'inc2','inc2');

--- 1 row(s) inserted.
>>select * from test3;

A            B                     ADDCO11             
-----------  --------------------  --------------------

          1  inc1                  ?                   
          2  inc2                  inc2                

--- 2 row(s) selected.
>>backup trafodion, tag 'test051incr2', table(test3),incremental,override;

--- SQL operation complete.
>>get all backup tags, show details, match 'test051%';

BackupTag     BackupTime           BackupStatus  BackupOperation        BackupOwner
=====================================================================================

test051incr4                       NO_SNAPSHOT   UNKNOWN                Not Available
test051incr3                       NO_SNAPSHOT   UNKNOWN                Not Available
test051incr5                       NO_SNAPSHOT   UNKNOWN                Not Available
test051reg1   2019-10-22:05:02:30  VALID         REGULAR                DB__ROOT
test051incr1  2019-10-22:05:03:30  VALID         INCREMENTAL            DB__ROOT
test051incr2  2019-10-22:05:04:36  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>delete from test3;

--- 2 row(s) deleted.
>>restore trafodion, tag 'test051incr1';

--- SQL operation complete.
>>--expect 1, 'inc1'
>>select * from test3;

A            B                   
-----------  --------------------

          1  inc1                

--- 1 row(s) selected.
>>insert into test3 values(1,'inc3'),(2,'inc3');

--- 2 row(s) inserted.
>>select * from test3;

A            B                   
-----------  --------------------

          1  inc1                
          1  inc3                
          2  inc3                

--- 3 row(s) selected.
>>backup trafodion, tag 'test051incr3', table(test3),incremental,override;

--- SQL operation complete.
>>delete from test3;

--- 3 row(s) deleted.
>>restore trafodion, tag 'test051incr3';

--- SQL operation complete.
>>-- expect
>>--        1, 'inc1'
>>--        1, 'inc3'
>>--        2, 'inc3'
>>select * from test3;

A            B                   
-----------  --------------------

          1  inc1                
          1  inc3                
          2  inc3                

--- 3 row(s) selected.
>>restore trafodion, tag 'test051incr2';

--- SQL operation complete.
>>select * from test3;

A            B                     ADDCO11             
-----------  --------------------  --------------------

          1  inc1                  ?                   
          2  inc2                  inc2                

--- 2 row(s) selected.
>>
>>-- end state
>>get all backup snapshots, match 'test051%';

BackupTag      BackupTime           BackupStatus  BackupOperation        BackupOwner
======================================================================================

test051reg1    2019-10-22:05:03:16  VALID         REGULAR                DB__ROOT
test051incr1   2019-10-22:05:04:07  VALID         INCREMENTAL            DB__ROOT
test051incr2   2019-10-22:05:05:16  VALID         INCREMENTAL            DB__ROOT
test051incr3   2019-10-22:05:07:58  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>get all backup tags, show details, match 'test051%';

BackupTag     BackupTime           BackupStatus  BackupOperation        BackupOwner
=====================================================================================

test051incr4                       NO_SNAPSHOT   UNKNOWN                Not Available
test051incr5                       NO_SNAPSHOT   UNKNOWN                Not Available
test051reg1   2019-10-22:05:02:30  VALID         REGULAR                DB__ROOT
test051incr1  2019-10-22:05:03:30  VALID         INCREMENTAL            DB__ROOT
test051incr2  2019-10-22:05:04:36  VALID         INCREMENTAL            DB__ROOT
test051incr3  2019-10-22:05:07:22  VALID         INCREMENTAL            DB__ROOT

--- SQL operation complete.
>>drop all backup snapshots, match 'test051%';

--- SQL operation complete.
>>get all backup tags, show details, match 'test051%';

BackupTag     BackupTime           BackupStatus  BackupOperation        BackupOwner
=====================================================================================

test051incr2                       NO_SNAPSHOT   UNKNOWN                Not Available
test051incr3                       NO_SNAPSHOT   UNKNOWN                Not Available
test051incr4                       NO_SNAPSHOT   UNKNOWN                Not Available
test051incr5                       NO_SNAPSHOT   UNKNOWN                Not Available
test051reg1                        NO_SNAPSHOT   UNKNOWN                Not Available
test051incr1                       NO_SNAPSHOT   UNKNOWN                Not Available

--- SQL operation complete.
>>get all backup metadata, match 'test051%';

Metadata(OBSOLETE  ): _BACKUP_test051incr1_
Metadata(OBSOLETE  ): _BACKUP_test051incr2_
Metadata(OBSOLETE  ): _BACKUP_test051incr3_
Metadata(OBSOLETE  ): _BACKUP_test051incr4_
Metadata(OBSOLETE  ): _BACKUP_test051incr5_
Metadata(OBSOLETE  ): _BACKUP_test051reg1_

--- SQL operation complete.
>>
>>log;
