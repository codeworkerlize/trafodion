>>
>>-- should not show any entries
>>cleanup metadata, check, return details;
Metadata Cleanup: started, check only

  Start: Cleanup Orphan Objects Entries
  End:   Cleanup Orphan Objects Entries (0 entries found)

  Start: Cleanup Orphan Hbase Entries
  End:   Cleanup Orphan Hbase Entries (0 entries found)

  Start: Cleanup Inconsistent Objects Entries
  End:   Cleanup Inconsistent Objects Entries (0 entries found)

  Start: Cleanup Inconsistent Partitions Entries
  End:   Cleanup Inconsistent Partitions Entries (0 entries found)

  Start: Cleanup Inconsistent Views Entries
  End:   Cleanup Inconsistent Views Entries (0 entries found)

  Start: Cleanup Inconsistent Hive Entries
  End:   Cleanup Inconsistent Hive Entries (0 entries found)

  Start: Cleanup Inconsistent Privilege Entries
  End:   Cleanup Inconsistent Privilege Entries (0 entries found)

  Start: Cleanup Inconsistent User Group Entries
  End:   Cleanup Inconsistent User Group Entries (0 entries found)

  Start: Cleanup Inconsistent TEXT Entries
  End:   Cleanup Inconsistent TEXT Entries (0 entries found)

Metadata Cleanup: done


--- SQL operation complete.
>>
>>cqd traf_blob_as_varchar 'OFF';

--- SQL operation complete.
>>drop backup snapshot, tag 'test050';

*** ERROR[5050] DROP BACKUP SNAPSHOT command could not be completed. Reason: Specified tag does not exist.

--- SQL operation failed with errors.
>>
>>drop schema if exists sch050 cascade;

--- SQL operation complete.
>>create schema sch050;

--- SQL operation complete.
>>set schema sch050;

--- SQL operation complete.
>>cqd traf_restore_parallel '1';

--- SQL operation complete.
>>
>>create table t1 (a int not null primary key, 
+>  b int not null unique,
+>  c char(10),
+>  d int not null,
+>  e largeint not null generated by default as identity,
+>  f int,
+>  l blob)
+>salt using 2 partitions;

--- SQL operation complete.
>>
>>alter table t1 add constraint t1c1 unique (d);

--- SQL operation complete.
>>alter table t1 add column g int;

--- SQL operation complete.
>>alter table t1 alter column f largeint;

--- SQL operation complete.
>>alter table t1 add constraint t1c2 check (c != ' ');

--- SQL operation complete.
>>alter table t1 alter hbase_options (ttl = '999999');

--- SQL operation complete.
>>
>>create index t1i1 on t1 (c) salt like table;

--- SQL operation complete.
>>create unique index t1i2 on t1 (c);

--- SQL operation complete.
>>
>>create table t2 (a int not null primary key references t1(d));

--- SQL operation complete.
>>
>>create view v1 as select * from t1;

--- SQL operation complete.
>>
>>grant select on t1 to sql_user1;

--- SQL operation complete.
>>grant select on schema sch050 to sql_user1;

--- SQL operation complete.
>>
>>get objects in schema sch050;

Tables in Schema TRAFODION.SCH050
=================================

LOBCHUNKS__05886414054949194872
SB_HISTOGRAMS
SB_HISTOGRAM_INTERVALS
SB_PERSISTENT_SAMPLES
T1
T2

=======================
 6 row(s) returned

Views in Schema TRAFODION.SCH050
================================

V1

=======================
 1 row(s) returned

Indexes in Schema TRAFODION.SCH050
==================================

T1C1
T1I1
T1I2
T1_578382992_6657

=======================
 4 row(s) returned

Sequences in schema TRAFODION.SCH050
====================================

_TRAFODION_SCH050_T1_E_

=======================
 1 row(s) returned

--- SQL operation complete.
>>showddl schema sch050;

CREATE PRIVATE SCHEMA TRAFODION.SCH050 AUTHORIZATION DB__ROOT NAMESPACE
  'TRAF_regr'  STORED DESC ;

--- SQL operation complete.
>>showddl t1;

CREATE TABLE TRAFODION.SCH050.T1
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      (  START WITH 1  INCREMENT BY 1  MAXVALUE 9223372036854775806  MINVALUE 1
       CACHE 25  NOORDER  NO CYCLE  LARGEINT  ) NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , G                                INT DEFAULT NULL /*added_col*/
  , PRIMARY KEY (A ASC)
  )
  SALT USING 2 PARTITIONS
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
  HBASE_OPTIONS
  (
    TTL = '999999'
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1C1 ON TRAFODION.SCH050.T1
  (
    D ASC
  )
;

CREATE INDEX T1I1 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
 SALT LIKE TABLE
;

CREATE UNIQUE INDEX T1I2 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1_578382992_6657 ON TRAFODION.SCH050.T1
  (
    B ASC
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C1 UNIQUE
  (
    D
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT
  TRAFODION.SCH050.T1_578382992_6657 UNIQUE
  (
    B
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C2 CHECK
  (TRAFODION.SCH050.T1.C != ' ')
;

--- SQL operation complete.
>>showddl t2;

CREATE TABLE TRAFODION.SCH050.T2
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
;

ALTER TABLE TRAFODION.SCH050.T2 ADD CONSTRAINT
  TRAFODION.SCH050.T2_718513992_6657 FOREIGN KEY
  (
    A
  )
 REFERENCES TRAFODION.SCH050.T1
  (
    D
  )
;

--- SQL operation complete.
>>showddl v1;

CREATE VIEW TRAFODION.SCH050.V1 AS
  SELECT TRAFODION.SCH050.T1.A, TRAFODION.SCH050.T1.B, TRAFODION.SCH050.T1.C,
    TRAFODION.SCH050.T1.D, TRAFODION.SCH050.T1.E, TRAFODION.SCH050.T1.F,
    TRAFODION.SCH050.T1.L, TRAFODION.SCH050.T1.G FROM TRAFODION.SCH050.T1 ;

--- SQL operation complete.
>>
>>-- insert rows
>>insert into t1 values (1,2,'a',3,4,5,empty_blob(),6);

--- 1 row(s) inserted.
>>update statistics for table t1 on every column;

--- SQL operation complete.
>>showstats for table t1 on every column;

Histogram data for Table TRAFODION.SCH050.T1
Table ID: 5886414054949194872

   Hist ID # Ints    Rowcount         UEC Colname(s)
========== ====== =========== =========== ===========================
1234116759      1           1           1 A
1234116754      1           1           1 B
1234116749      1           1           1 C
1234116744      1           1           1 D
1234116739      1           1           1 E
1234116734      1           1           1 F
1234116729      1           1           1 "_SALT_"
1234116724      1           1           1 G
1234116774      1           1           1 "_SALT_", A
1234116769      1           1           1 "_SALT_", C, A
1234116764      1           1           1 "_SALT_", C


--- SQL operation complete.
>>
>>-- backup schema sch050
>>backup trafodion, tag 'test050', schemas (sch050), show objects;

MetaData Objects
================

TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".INDEXES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".KEYS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOBCHUNKS__01968282270495999691
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOB_COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".REF_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".ROUTINES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SEQ_GEN
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLE_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TEXT
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".UNIQUE_REF_CONSTR_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMN_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECT_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SCHEMA_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAMS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAM_INTERVALS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_PERSISTENT_SAMPLES

User objects
============

TABLE:   TRAF_regr:TRAFODION.SCH050.LOBCHUNKS__05886414054949194872
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAMS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAM_INTERVALS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_PERSISTENT_SAMPLES
TABLE:   TRAF_regr:TRAFODION.SCH050.T1
TABLE:   TRAF_regr:TRAFODION.SCH050.T2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1C1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1_578382992_6657
VIEW:    TRAFODION.SCH050.V1

Backup Stats
============
  Total:     34
  Metadata:  23
  Tables:    6
  Indexes:   4
  Views:     1


--- SQL operation complete.
>>backup trafodion, tag 'test050', schemas (sch050), override;

--- SQL operation complete.
>>
>>drop schema sch050 cascade;

--- SQL operation complete.
>>showddl schema sch050;

*** ERROR[1003] Schema TRAFODION.SCH050 does not exist.

*** ERROR[1389] Object TRAFODION.SCH050."__SCHEMA__" does not exist in Trafodion.

*** ERROR[1003] Schema TRAFODION.SCH050 does not exist.

--- SQL operation failed with errors.
>>get objects in schema sch050;

--- SQL operation complete.
>>
>>-- restore schema sch050
>>restore trafodion, tag 'test050', schemas (sch050), show objects;

MetaData Objects
================

TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMN_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".INDEXES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".KEYS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOBCHUNKS__06543376650629891402
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOB_COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECT_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".REF_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".ROUTINES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAMS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAM_INTERVALS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_PERSISTENT_SAMPLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SCHEMA_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SEQ_GEN
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLE_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TEXT
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".UNIQUE_REF_CONSTR_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS_USAGE

User objects
============

TABLE:   TRAF_regr:TRAFODION.SCH050.LOBCHUNKS__05886414054949194872
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAMS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAM_INTERVALS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_PERSISTENT_SAMPLES
TABLE:   TRAF_regr:TRAFODION.SCH050.T1
TABLE:   TRAF_regr:TRAFODION.SCH050.T2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1C1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1_578382992_6657
VIEW:    TRAFODION.SCH050.V1

Restore Stats
=============
  Total:     34
  Metadata:  23
  Tables:    6
  Indexes:   4
  Views:     1


--- SQL operation complete.
>>restore trafodion, tag 'test050', show objects;

MetaData Objects
================

TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMN_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".INDEXES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".KEYS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOBCHUNKS__06543376650629891402
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOB_COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECT_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".REF_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".ROUTINES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAMS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAM_INTERVALS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_PERSISTENT_SAMPLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SCHEMA_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SEQ_GEN
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLE_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TEXT
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".UNIQUE_REF_CONSTR_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS_USAGE

User objects
============

TABLE:   TRAF_regr:TRAFODION.SCH050.LOBCHUNKS__05886414054949194872
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAMS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAM_INTERVALS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_PERSISTENT_SAMPLES
TABLE:   TRAF_regr:TRAFODION.SCH050.T1
TABLE:   TRAF_regr:TRAFODION.SCH050.T2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1C1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1_578382992_6657
VIEW:    TRAFODION.SCH050.V1

Restore Stats
=============
  Total:     34
  Metadata:  23
  Tables:    6
  Indexes:   4
  Views:     1


--- SQL operation complete.
>>
>>restore trafodion, tag 'test050', show objects;

MetaData Objects
================

TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMN_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".INDEXES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".KEYS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOBCHUNKS__06543376650629891402
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOB_COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECT_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".REF_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".ROUTINES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAMS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAM_INTERVALS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_PERSISTENT_SAMPLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SCHEMA_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SEQ_GEN
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLE_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TEXT
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".UNIQUE_REF_CONSTR_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS_USAGE

User objects
============

TABLE:   TRAF_regr:TRAFODION.SCH050.LOBCHUNKS__05886414054949194872
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAMS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAM_INTERVALS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_PERSISTENT_SAMPLES
TABLE:   TRAF_regr:TRAFODION.SCH050.T1
TABLE:   TRAF_regr:TRAFODION.SCH050.T2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1C1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1_578382992_6657
VIEW:    TRAFODION.SCH050.V1

Restore Stats
=============
  Total:     34
  Metadata:  23
  Tables:    6
  Indexes:   4
  Views:     1


--- SQL operation complete.
>>restore trafodion, tag 'test050';

--- SQL operation complete.
>>get objects in schema sch050;

Tables in Schema TRAFODION.SCH050
=================================

LOBCHUNKS__05886414054949194872
SB_HISTOGRAMS
SB_HISTOGRAM_INTERVALS
SB_PERSISTENT_SAMPLES
T1
T2

=======================
 6 row(s) returned

Views in Schema TRAFODION.SCH050
================================

V1

=======================
 1 row(s) returned

Indexes in Schema TRAFODION.SCH050
==================================

T1C1
T1I1
T1I2
T1_578382992_6657

=======================
 4 row(s) returned

Sequences in schema TRAFODION.SCH050
====================================

_TRAFODION_SCH050_T1_E_

=======================
 1 row(s) returned

--- SQL operation complete.
>>showddl schema sch050;

CREATE PRIVATE SCHEMA TRAFODION.SCH050 AUTHORIZATION DB__ROOT NAMESPACE
  'TRAF_regr'  STORED DESC ;

--- SQL operation complete.
>>showddl t1;

CREATE TABLE TRAFODION.SCH050.T1
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      (  START WITH 1  INCREMENT BY 1  MAXVALUE 9223372036854775806  MINVALUE 1
       CACHE 25  NOORDER  NO CYCLE  LARGEINT  ) NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , G                                INT DEFAULT NULL /*added_col*/
  , PRIMARY KEY (A ASC)
  )
  SALT USING 2 PARTITIONS
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
  HBASE_OPTIONS
  (
    TTL = '999999'
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1C1 ON TRAFODION.SCH050.T1
  (
    D ASC
  )
;

CREATE INDEX T1I1 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
 SALT LIKE TABLE
;

CREATE UNIQUE INDEX T1I2 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1_578382992_6657 ON TRAFODION.SCH050.T1
  (
    B ASC
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C1 UNIQUE
  (
    D
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT
  TRAFODION.SCH050.T1_578382992_6657 UNIQUE
  (
    B
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C2 CHECK
  (TRAFODION.SCH050.T1.C != ' ')
;

--- SQL operation complete.
>>showddl t2;

CREATE TABLE TRAFODION.SCH050.T2
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
;

ALTER TABLE TRAFODION.SCH050.T2 ADD CONSTRAINT
  TRAFODION.SCH050.T2_718513992_6657 FOREIGN KEY
  (
    A
  )
 REFERENCES TRAFODION.SCH050.T1
  (
    D
  )
;

--- SQL operation complete.
>>showddl v1;

CREATE VIEW TRAFODION.SCH050.V1 AS
  SELECT TRAFODION.SCH050.T1.A, TRAFODION.SCH050.T1.B, TRAFODION.SCH050.T1.C,
    TRAFODION.SCH050.T1.D, TRAFODION.SCH050.T1.E, TRAFODION.SCH050.T1.F,
    TRAFODION.SCH050.T1.L, TRAFODION.SCH050.T1.G FROM TRAFODION.SCH050.T1 ;

--- SQL operation complete.
>>showstats for table t1 on every column;

Histogram data for Table TRAFODION.SCH050.T1
Table ID: 5886414054949194872

   Hist ID # Ints    Rowcount         UEC Colname(s)
========== ====== =========== =========== ===========================
1234116759      1           1           1 A
1234116754      1           1           1 B
1234116749      1           1           1 C
1234116744      1           1           1 D
1234116739      1           1           1 E
1234116734      1           1           1 F
1234116729      1           1           1 "_SALT_"
1234116724      1           1           1 G
1234116774      1           1           1 "_SALT_", A
1234116769      1           1           1 "_SALT_", C, A
1234116764      1           1           1 "_SALT_", C


--- SQL operation complete.
>>select * from t1;

A            B            C           D            E                     F                     L                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 G
-----------  -----------  ----------  -----------  --------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------

          1            2  a                     3                     4                     5  LOBH00010002000605886414054949194872000000000000000000480588641405517033264600000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            6

--- 1 row(s) selected.
>>
>>drop schema sch050 cascade;

--- SQL operation complete.
>>cleanup schema sch050;

*** WARNING[4255] Provided schema name does not exist in metadata. Cleanup will be performed on objects in this schema, if they exist.

--- SQL operation complete.
>>restore trafodion, tag 'test050', schemas (sch050);

--- SQL operation complete.
>>get objects in schema sch050;

Tables in Schema TRAFODION.SCH050
=================================

LOBCHUNKS__05886414054949194872
SB_HISTOGRAMS
SB_HISTOGRAM_INTERVALS
SB_PERSISTENT_SAMPLES
T1
T2

=======================
 6 row(s) returned

Views in Schema TRAFODION.SCH050
================================

V1

=======================
 1 row(s) returned

Indexes in Schema TRAFODION.SCH050
==================================

T1C1
T1I1
T1I2
T1_578382992_6657

=======================
 4 row(s) returned

Sequences in schema TRAFODION.SCH050
====================================

_TRAFODION_SCH050_T1_E_

=======================
 1 row(s) returned

--- SQL operation complete.
>>showddl schema sch050;

CREATE PRIVATE SCHEMA TRAFODION.SCH050 AUTHORIZATION DB__ROOT NAMESPACE
  'TRAF_regr'  STORED DESC ;

--- SQL operation complete.
>>showddl t1;

CREATE TABLE TRAFODION.SCH050.T1
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      (  START WITH 1  INCREMENT BY 1  MAXVALUE 9223372036854775806  MINVALUE 1
       CACHE 25  NOORDER  NO CYCLE  LARGEINT  ) NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , G                                INT DEFAULT NULL /*added_col*/
  , PRIMARY KEY (A ASC)
  )
  SALT USING 2 PARTITIONS
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
  HBASE_OPTIONS
  (
    TTL = '999999'
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1C1 ON TRAFODION.SCH050.T1
  (
    D ASC
  )
;

CREATE INDEX T1I1 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
 SALT LIKE TABLE
;

CREATE UNIQUE INDEX T1I2 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1_578382992_6657 ON TRAFODION.SCH050.T1
  (
    B ASC
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C1 UNIQUE
  (
    D
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT
  TRAFODION.SCH050.T1_578382992_6657 UNIQUE
  (
    B
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C2 CHECK
  (TRAFODION.SCH050.T1.C != ' ')
;

--- SQL operation complete.
>>showddl t2;

CREATE TABLE TRAFODION.SCH050.T2
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
;

ALTER TABLE TRAFODION.SCH050.T2 ADD CONSTRAINT
  TRAFODION.SCH050.T2_718513992_6657 FOREIGN KEY
  (
    A
  )
 REFERENCES TRAFODION.SCH050.T1
  (
    D
  )
;

--- SQL operation complete.
>>showddl v1;

CREATE VIEW TRAFODION.SCH050.V1 AS
  SELECT TRAFODION.SCH050.T1.A, TRAFODION.SCH050.T1.B, TRAFODION.SCH050.T1.C,
    TRAFODION.SCH050.T1.D, TRAFODION.SCH050.T1.E, TRAFODION.SCH050.T1.F,
    TRAFODION.SCH050.T1.L, TRAFODION.SCH050.T1.G FROM TRAFODION.SCH050.T1 ;

--- SQL operation complete.
>>showstats for table t1 on every column;

Histogram data for Table TRAFODION.SCH050.T1
Table ID: 5886414054949194872

   Hist ID # Ints    Rowcount         UEC Colname(s)
========== ====== =========== =========== ===========================
1234116759      1           1           1 A
1234116754      1           1           1 B
1234116749      1           1           1 C
1234116744      1           1           1 D
1234116739      1           1           1 E
1234116734      1           1           1 F
1234116729      1           1           1 "_SALT_"
1234116724      1           1           1 G
1234116774      1           1           1 "_SALT_", A
1234116769      1           1           1 "_SALT_", C, A
1234116764      1           1           1 "_SALT_", C


--- SQL operation complete.
>>select * from t1;

A            B            C           D            E                     F                     L                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 G
-----------  -----------  ----------  -----------  --------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------

          1            2  a                     3                     4                     5  LOBH00010002000605886414054949194872000000000000000000480588641405517033264600000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            6

--- 1 row(s) selected.
>>
>>-- restores tables
>>drop view v1;

--- SQL operation complete.
>>drop table sch050.t1 cascade;

--- SQL operation complete.
>>drop table sch050.t2;

--- SQL operation complete.
>>restore trafodion, tag 'test050', table (sch050.t1), show objects;

MetaData Objects
================

TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".COLUMN_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".INDEXES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".KEYS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LIBRARIES_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOBCHUNKS__06543376650629891402
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".LOB_COLUMNS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".OBJECT_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".REF_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".ROUTINES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAMS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_HISTOGRAM_INTERVALS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SB_PERSISTENT_SAMPLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SCHEMA_PRIVILEGES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".SEQ_GEN
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLES
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TABLE_CONSTRAINTS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".TEXT
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".UNIQUE_REF_CONSTR_USAGE
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS
TRAF_RSRVD_3:TRAFODION."_BACKUP_test050_".VIEWS_USAGE

User objects
============

TABLE:   TRAF_regr:TRAFODION.SCH050.LOBCHUNKS__05886414054949194872
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAMS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_HISTOGRAM_INTERVALS
TABLE:   TRAF_regr:TRAFODION.SCH050.SB_PERSISTENT_SAMPLES
TABLE:   TRAF_regr:TRAFODION.SCH050.T1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1C1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I1
INDEX:   TRAF_regr:TRAFODION.SCH050.T1I2
INDEX:   TRAF_regr:TRAFODION.SCH050.T1_578382992_6657

Restore Stats
=============
  Total:     32
  Metadata:  23
  Tables:    5
  Indexes:   4


--- SQL operation complete.
>>restore trafodion, tag 'test050', table (sch050.t1);

--- SQL operation complete.
>>get objects in schema sch050;

Tables in Schema TRAFODION.SCH050
=================================

LOBCHUNKS__05886414054949194872
SB_HISTOGRAMS
SB_HISTOGRAM_INTERVALS
SB_PERSISTENT_SAMPLES
T1

=======================
 5 row(s) returned

Indexes in Schema TRAFODION.SCH050
==================================

T1C1
T1I1
T1I2
T1_578382992_6657

=======================
 4 row(s) returned

Sequences in schema TRAFODION.SCH050
====================================

_TRAFODION_SCH050_T1_E_

=======================
 1 row(s) returned

--- SQL operation complete.
>>showddl schema sch050;

CREATE PRIVATE SCHEMA TRAFODION.SCH050 AUTHORIZATION DB__ROOT NAMESPACE
  'TRAF_regr'  STORED DESC ;

--- SQL operation complete.
>>showddl t1;

CREATE TABLE TRAFODION.SCH050.T1
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      (  START WITH 1  INCREMENT BY 1  MAXVALUE 9223372036854775806  MINVALUE 1
       CACHE 25  NOORDER  NO CYCLE  LARGEINT  ) NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , G                                INT DEFAULT NULL /*added_col*/
  , PRIMARY KEY (A ASC)
  )
  SALT USING 2 PARTITIONS
 ATTRIBUTES ALIGNED FORMAT NAMESPACE 'TRAF_regr'
  HBASE_OPTIONS
  (
    TTL = '999999'
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1C1 ON TRAFODION.SCH050.T1
  (
    D ASC
  )
;

CREATE INDEX T1I1 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
 SALT LIKE TABLE
;

CREATE UNIQUE INDEX T1I2 ON TRAFODION.SCH050.T1
  (
    C ASC
  )
;

-- The following index is a system created index --
CREATE UNIQUE INDEX T1_578382992_6657 ON TRAFODION.SCH050.T1
  (
    B ASC
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C1 UNIQUE
  (
    D
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT
  TRAFODION.SCH050.T1_578382992_6657 UNIQUE
  (
    B
  )
;

ALTER TABLE TRAFODION.SCH050.T1 ADD CONSTRAINT TRAFODION.SCH050.T1C2 CHECK
  (TRAFODION.SCH050.T1.C != ' ')
;

--- SQL operation complete.
>>showddl t2;

*** ERROR[4082] Object TRAFODION.SCH050.T2 does not exist or is inaccessible.

*** ERROR[8822] The statement was not prepared.

>>showddl v1;

*** ERROR[4082] Object TRAFODION.SCH050.V1 does not exist or is inaccessible.

*** ERROR[8822] The statement was not prepared.

>>showstats for table t1 on every column;

Histogram data for Table TRAFODION.SCH050.T1
Table ID: 5886414054949194872

   Hist ID # Ints    Rowcount         UEC Colname(s)
========== ====== =========== =========== ===========================

No Histograms exist for the requested columns or groups


--- SQL operation complete.
>>select * from t1;

A            B            C           D            E                     F                     L                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 G
-----------  -----------  ----------  -----------  --------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------

          1            2  a                     3                     4                     5  LOBH00010002000605886414054949194872000000000000000000480588641405517033264600000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            6

--- 1 row(s) selected.
>>
>>-- restore table fails followed by recovery of original table with 2 rows.
>>-- backup tag 'test050' contains table sch050.t1 with single row.
>>set envvar RESTORE_ERR_INJECT_3;

--- SQL operation complete.
>>restore trafodion, tag 'test050', table (sch050.t1), show objects;

*** ERROR[5050] This command could not be completed. Error injected at RESTORE_ERR_INJECT_3.

--- SQL operation failed with errors.
>>restore trafodion, tag 'test050', table (sch050.t1);

*** ERROR[5050] This command could not be completed. Error injected at RESTORE_ERR_INJECT_3.

--- SQL operation failed with errors.
>>select * from t1;

*** ERROR[4264] Object TRAFODION.SCH050.T1 is locked by a backup or restore operation and cannot be accessed until that operation is finished. Details: test050(RESTORE)

*** ERROR[4082] Object TRAFODION.SCH050.T1 does not exist or is inaccessible.

*** ERROR[8822] The statement was not prepared.

>>restore trafodion, tag 'test050', table (sch050.t1);

*** ERROR[5050] RESTORE command could not be completed. Reason: Snapshot metadata is currently locked for Tag: test050

--- SQL operation failed with errors.
>>cleanup backup, tag 'test050';

--- SQL operation complete.
>>select * from t1;

A            B            C           D            E                     F                     L                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 G
-----------  -----------  ----------  -----------  --------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------

          1            2  a                     3                     4                     5  LOBH00010002000605886414054949194872000000000000000000480588641405517033264600000000000000000001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            6

--- 1 row(s) selected.
>>reset envvar RESTORE_ERR_INJECT_3;

--- SQL operation complete.
>>
>>-- delete backups
>>get all backup snapshots, match 'test050%';

BackupTag  BackupTime           BackupStatus  BackupOperation        BackupOwner
==================================================================================

test050    2019-11-25:13:46:50  VALID         REGULAR                DB__ROOT

--- SQL operation complete.
>>get all backup metadata, match 'test050%';

Metadata(ACTIVE    ): _BACKUP_test050_

--- SQL operation complete.
>>get backup snapshot, tag 'test050';

BackupTag  BackupTime           BackupStatus  BackupOperation        BackupOwner
==================================================================================

test050    2019-11-25:13:46:50  VALID         REGULAR                DB__ROOT

--- SQL operation complete.
>>drop backup snapshot, tag 'test050', force;

--- SQL operation complete.
>>get all backup snapshots, match 'test050%';

--- SQL operation complete.
>>get all backup metadata, match 'test050%';

--- SQL operation complete.
>>get backup snapshot, tag 'test050';

*** ERROR[5050] GET BACKUP SNAPSHOT command could not be completed. Reason: Specified tag does not exist.

--- SQL operation failed with errors.
>>
>>-- backup and alter of tables
>>invoke sch050.t1;

-- Definition of Trafodion table TRAFODION.SCH050.T1
-- Definition of hbase table TRAF_regr:TRAFODION.SCH050.T1
-- Definition current  Mon Nov 25 12:57:26 2019

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , "_SALT_"                         INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , G                                INT DEFAULT NULL /*added_col*/
  )
  PRIMARY KEY ("_SALT_" ASC, A ASC)

--- SQL operation complete.
>>backup trafodion, tag 'test050', table (sch050.t1), override;

--- SQL operation complete.
>>alter table sch050.t1 add column z int;

--- SQL operation complete.
>>invoke sch050.t1;

-- Definition of Trafodion table TRAFODION.SCH050.T1
-- Definition of hbase table TRAF_regr:TRAFODION.SCH050.T1
-- Definition current  Mon Nov 25 12:57:45 2019

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , "_SALT_"                         INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , G                                INT DEFAULT NULL /*added_col*/
  , Z                                INT DEFAULT NULL /*added_col*/
  )
  PRIMARY KEY ("_SALT_" ASC, A ASC)

--- SQL operation complete.
>>restore trafodion, tag 'test050';

--- SQL operation complete.
>>invoke sch050.t1;

-- Definition of Trafodion table TRAFODION.SCH050.T1
-- Definition of hbase table TRAF_regr:TRAFODION.SCH050.T1
-- Definition current  Mon Nov 25 12:58:32 2019

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , "_SALT_"                         INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , G                                INT DEFAULT NULL /*added_col*/
  )
  PRIMARY KEY ("_SALT_" ASC, A ASC)

--- SQL operation complete.
>>drop backup snapshot, tag 'test050', force, cascade;

--- SQL operation complete.
>>
>>-- backup restore with a dot in tag.
>>invoke sch050.t1;

-- Definition of Trafodion table TRAFODION.SCH050.T1
-- Definition of hbase table TRAF_regr:TRAFODION.SCH050.T1
-- Definition current  Mon Nov 25 12:58:34 2019

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , "_SALT_"                         INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , G                                INT DEFAULT NULL /*added_col*/
  )
  PRIMARY KEY ("_SALT_" ASC, A ASC)

--- SQL operation complete.
>>backup trafodion, tag 'test.050', table (sch050.t1), override;

--- SQL operation complete.
>>restore trafodion, tag 'test.050';

--- SQL operation complete.
>>invoke sch050.t1;

-- Definition of Trafodion table TRAFODION.SCH050.T1
-- Definition of hbase table TRAF_regr:TRAFODION.SCH050.T1
-- Definition current  Mon Nov 25 13:01:16 2019

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , C                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , D                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , E                                LARGEINT GENERATED BY DEFAULT AS IDENTITY
      NOT NULL NOT DROPPABLE
  , F                                LARGEINT DEFAULT NULL /*altered_col*/
  , L                                BLOB( 5368709120 bytes) DEFAULT NULL
  , "_SALT_"                         INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , G                                INT DEFAULT NULL /*added_col*/
  )
  PRIMARY KEY ("_SALT_" ASC, A ASC)

--- SQL operation complete.
>>drop backup tag, tag 'test.050', force, cascade;

--- SQL operation complete.
>>
>>-- backup with quoted schema name table.
>>create schema "sch050a";

--- SQL operation complete.
>>set schema "sch050a";

--- SQL operation complete.
>>create table t1(i int) attribute incremental backup;

--- SQL operation complete.
>>backup trafodion, tag 'test050', tables(t1), override;

--- SQL operation complete.
>>drop schema "sch050a" cascade;

--- SQL operation complete.
>>drop backup snapshot, tag 'test050', force, cascade;

--- SQL operation complete.
>>set schema sch050;

--- SQL operation complete.
>>
>>-- should not be any orphans in metadata at this point
>>cleanup metadata, check, return details;
Metadata Cleanup: started, check only

  Start: Cleanup Orphan Objects Entries
  End:   Cleanup Orphan Objects Entries (0 entries found)

  Start: Cleanup Orphan Hbase Entries
  End:   Cleanup Orphan Hbase Entries (0 entries found)

  Start: Cleanup Inconsistent Objects Entries
  End:   Cleanup Inconsistent Objects Entries (0 entries found)

  Start: Cleanup Inconsistent Partitions Entries
  End:   Cleanup Inconsistent Partitions Entries (0 entries found)

  Start: Cleanup Inconsistent Views Entries
  End:   Cleanup Inconsistent Views Entries (0 entries found)

  Start: Cleanup Inconsistent Hive Entries
  End:   Cleanup Inconsistent Hive Entries (0 entries found)

  Start: Cleanup Inconsistent Privilege Entries
  End:   Cleanup Inconsistent Privilege Entries (0 entries found)

  Start: Cleanup Inconsistent User Group Entries
  End:   Cleanup Inconsistent User Group Entries (0 entries found)

  Start: Cleanup Inconsistent TEXT Entries
  End:   Cleanup Inconsistent TEXT Entries (0 entries found)

Metadata Cleanup: done


--- SQL operation complete.
>>
>>-- backup with error injection
>>create schema if not exists "sch050a";

--- SQL operation complete.
>>set schema "sch050a";

--- SQL operation complete.
>>create table if not exists t1(i int) attribute incremental backup;

--- SQL operation complete.
>>set envvar BACKUP_ERR_INJECT_3;

--- SQL operation complete.
>>backup trafodion, tag 'test050_22', tables(t1), override;

*** ERROR[5050] This command could not be completed. Error injected at BACKUP_ERR_INJECT_3.

--- SQL operation failed with errors.
>>drop schema if exists "sch050a" cascade;

--- SQL operation complete.
>>drop backup snapshot, tag 'test050_22', force, cascade;

*** ERROR[5050] DROP BACKUP SNAPSHOT command could not be completed. Reason: Specified tag does not exist.

--- SQL operation failed with errors.
>>drop obsolete backup metadata, tag 'test050_22';

--- SQL operation complete.
>>reset envvar BACKUP_ERR_INJECT_3;

--- SQL operation complete.
>>set schema sch050;

--- SQL operation complete.
>>
>>-- should not be any orphans in metadata at this point
>>cleanup metadata, check, return details;
Metadata Cleanup: started, check only

  Start: Cleanup Orphan Objects Entries
  End:   Cleanup Orphan Objects Entries (0 entries found)

  Start: Cleanup Orphan Hbase Entries
  End:   Cleanup Orphan Hbase Entries (0 entries found)

  Start: Cleanup Inconsistent Objects Entries
  End:   Cleanup Inconsistent Objects Entries (0 entries found)

  Start: Cleanup Inconsistent Partitions Entries
  End:   Cleanup Inconsistent Partitions Entries (0 entries found)

  Start: Cleanup Inconsistent Views Entries
  End:   Cleanup Inconsistent Views Entries (0 entries found)

  Start: Cleanup Inconsistent Hive Entries
  End:   Cleanup Inconsistent Hive Entries (0 entries found)

  Start: Cleanup Inconsistent Privilege Entries
  End:   Cleanup Inconsistent Privilege Entries (0 entries found)

  Start: Cleanup Inconsistent User Group Entries
  End:   Cleanup Inconsistent User Group Entries (0 entries found)

  Start: Cleanup Inconsistent TEXT Entries
  End:   Cleanup Inconsistent TEXT Entries (0 entries found)

Metadata Cleanup: done


--- SQL operation complete.
>>
>>-- precreate system tags
>>prepare s from backup trafodion, create 1 system tags;

--- SQL command prepared.
>>
>>-- error cases
>>backup trafodion;

*** ERROR[5050] BACKUP command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>backup trafodion, schemas (sch050);

*** ERROR[5050] BACKUP command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>backup trafodion, tag 't12345678901234567890123456789012345';

*** ERROR[5050] BACKUP command could not be completed. Reason: Tag cannot exceed 32 bytes in length.

*** ERROR[8822] The statement was not prepared.

>>backup trafodion, tag 'tt', to timestamp 'tt';

*** ERROR[5050] BACKUP command could not be completed. Reason: TO TIMESTAMP option cannot be specified.

*** ERROR[8822] The statement was not prepared.

>>backup trafodion, tag 'abc', schemas (noschema);

*** ERROR[4082] Object TRAFODION.NOSCHEMA does not exist or is inaccessible.

--- SQL operation failed with errors.
>>backup trafodion, tag 'abc', table (notable);

*** ERROR[3242] This statement is not supported. Reason: Specified object TRAFODION.SCH050.NOTABLE does not exist or is not a table.

--- SQL operation failed with errors.
>>backup trafodion, tag 'a&c', table (t1);

*** ERROR[5050] BACKUP command could not be completed. Reason: A valid tag can only contain these characters: [a-zA-Z_0-9-.]

*** ERROR[8822] The statement was not prepared.

>>restore trafodion;

*** ERROR[5050] RESTORE command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>restore trafodion, schemas (sch050);

*** ERROR[5050] RESTORE command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>restore trafodion, tag 'abc', to timestamp '';

*** ERROR[5050] RESTORE command could not be completed.  Reason: Tag cannot be specified with 'TO TIMESTAMP' option.

*** ERROR[8822] The statement was not prepared.

>>restore trafodion, to timestamp '';

*** ERROR[5050] RESTORE command could not be completed. Reason: Specified timestamp is not valid.

*** ERROR[8822] The statement was not prepared.

>>restore trafodion, to timestamp '1000-10-45 10:10:10';

*** ERROR[5050] RESTORE command could not be completed. Reason: Specified timestamp is not valid.

*** ERROR[8822] The statement was not prepared.

>>backup trafodion, schema (sch050, sch051);

*** ERROR[5050] BACKUP command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>drop backup snapshot, tag 'test050', table (sch050.t1);

*** ERROR[5050] DROP BACKUP command could not be completed. Reason: Objects cannot be specified.

*** ERROR[8822] The statement was not prepared.

>>import backup from location 'temp';

*** ERROR[5050] IMPORT BACKUP command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>export backup to location 'temp';

*** ERROR[5050] EXPORT BACKUP command could not be completed. Reason: Tag must be specified.

*** ERROR[8822] The statement was not prepared.

>>
>>-- there should not be any locks.
>>get all locked objects;

--- SQL operation complete.
>>
>>-- should not be any orphans in metadata at this point
>>cleanup metadata, check, return details;
Metadata Cleanup: started, check only

  Start: Cleanup Orphan Objects Entries
  End:   Cleanup Orphan Objects Entries (0 entries found)

  Start: Cleanup Orphan Hbase Entries
  End:   Cleanup Orphan Hbase Entries (0 entries found)

  Start: Cleanup Inconsistent Objects Entries
  End:   Cleanup Inconsistent Objects Entries (0 entries found)

  Start: Cleanup Inconsistent Partitions Entries
  End:   Cleanup Inconsistent Partitions Entries (0 entries found)

  Start: Cleanup Inconsistent Views Entries
  End:   Cleanup Inconsistent Views Entries (0 entries found)

  Start: Cleanup Inconsistent Hive Entries
  End:   Cleanup Inconsistent Hive Entries (0 entries found)

  Start: Cleanup Inconsistent Privilege Entries
  End:   Cleanup Inconsistent Privilege Entries (0 entries found)

  Start: Cleanup Inconsistent User Group Entries
  End:   Cleanup Inconsistent User Group Entries (0 entries found)

  Start: Cleanup Inconsistent TEXT Entries
  End:   Cleanup Inconsistent TEXT Entries (0 entries found)

Metadata Cleanup: done


--- SQL operation complete.
>>
>>get all backup snapshots, match 'test050%';

--- SQL operation complete.
>>get all backup tags, show details, match 'test050%';

--- SQL operation complete.
>>drop all backup snapshots, match 'test050%';

--- SQL operation complete.
>>get all backup tags, show details, match 'test050%';

--- SQL operation complete.
>>get all backup metadata, match 'test050%';

--- SQL operation complete.
>>
>>log;
