obey TEST147(clean);
obey TEST147(setup);

obey TEST147(TEST);

obey TEST147(clean);

exit;

?section clean
drop group group1;
drop group group2;
drop user user1;
drop user user2;
drop user user3;
drop user user4;
drop role role1;
drop procedure fun1;
drop procedure fun2;

?section setup
create user user1;
create user user2;
create user user3;
create user user4;
create group group1;
create group group2;
create role role1;

create procedure fun1() as
//begin
    select count(*) from "_MD_".text as t join "_MD_".auths as a on t.TEXT_UID = a.AUTH_ID 
    where a.AUTH_DB_NAME = 'USER1' and t.TEXT_TYPE = 19;
end//;

create procedure fun2() as
//begin
    select count(*) from "_MD_".text as t join "_MD_".auths as a on t.TEXT_UID = a.AUTH_ID 
    where a.AUTH_DB_NAME = 'group1' and t.TEXT_TYPE = 19;
end//;



?section TEST
log LOG147 clear;
log LOG147;

get groups;

--ok
REGISTER GROUP group3;
get groups;
UNREGISTER GROUP group3;
get groups;

REGISTER GROUP group3 config 'abc';
get groups;
UNREGISTER GROUP group3 RESTRICT;
get groups;

call fun1();

alter user user1 add groups(group1);

call fun1();

alter user user1 add groups(group1,group2);

call fun1();

drop user user1;

call fun2();

create user user1;

call fun1();

alter user user1 add groups(group1);
alter user user2 add groups(group1);

call fun2();

drop group group1;

call fun1();

create group group1;





--ng
create group group1;
create group user1;
drop group user1;
UNREGISTER GROUP group10;

--user
get groups for user user1;
get members in group group1;

alter user user1 add groups(group1);
get groups for user user1;
get members in group group1;
alter user user1 remove groups(group1);
get groups for user user1;
get members in group group1;

get members in group group2;
alter user user1 add groups(group1,group2);
get groups for user user1;
get members in group group1;
get members in group group2;
alter user user1 remove groups(group1,group2);
get groups for user user1;
get members in group group1;
get members in group group2;

alter user user1 add groups(group1,group1,group1,group1,group1);
get groups for user user1;
get members in group group1;

alter user user1 remove groups(group1,group1,group1,group1,group1);
get groups for user user1;
get members in group group1;

alter user user1 add groups(group1,group1,group1,group1,group1,group2);
get groups for user user1;
get members in group group1;
get members in group group2;

alter user user1 remove groups(group1,group1,group1,group1,group1,group2);
get groups for user user1;
get members in group group1;
get members in group group2;

alter user user1 add groups(group1);
get groups for user user1;

alter user user1 remove groups(group2,group1);
get groups for user user1;
get members in group group1;
get members in group group2;

alter user user1 remove groups(group1,group2);
get groups for user user1;
get members in group group1;
get members in group group2;

--NG
alter user user1 add groups(group1);

alter user user1 add groups(abc);
alter user user1 add groups(user1);
alter user user1 add groups(role1);

alter user user1 add groups(abc,user1,group1,group1,group2);
get groups for user user1;
get members in group group1;
get members in group group2;
alter user user1 add groups(group2,group1,role1);
get groups for user user1;
get members in group group1;


--group
get groups for user user1;
get members in group group1;
alter group group1 add members(user1);
get groups for user user1;
get members in group group1;
alter group group1 remove members(user1);
get groups for user user1;
get members in group group1;

alter group group1 add members(user1,user2);
get groups for user user1;
get groups for user user2;
get members in group group1;
alter group group1 remove members(user1,user2);
get groups for user user1;
get groups for user user2;
get members in group group1;

alter group group1 add members(user1,user1,user1,user1);
get groups for user user1;
get members in group group1;

alter group group1 remove members(user1,user1,user1,user1);
get groups for user user1;
get members in group group1;

alter group group1 add members(user1,user1,user2);
get groups for user user1;
get groups for user user2;
get members in group group1;

alter group group1 remove members(user1,user1,user2);
get groups for user user1;
get groups for user user2;
get members in group group1;

alter group group1 add members(user1);
alter group group1 add members(user1);
alter group group1 add members(user1);
alter group group1 add members(user1);
get members in group group1;

alter group group1 remove members(user1);
alter group group1 remove members(user1);
alter group group1 remove members(user1);
alter group group1 remove members(user1);
get groups for user user1;
get members in group group1;

alter group group1 remove members(user2);
get groups for user user2;
get members in group group1;

--NG
alter group group1 add members(abc);
alter group group1 remove members(abc);
alter group group1 add members(group1);
alter group group1 remove members(group1);

alter group group1 add members(abc,user1,user2,group1,group1);
get groups for user user1;
get groups for user user2;
get members in group group1;

alter group group1 add members(user1,user2);
alter group group1 remove members(abc,user1,group1,group1,group2);
get groups for user user2;
get members in group group1;

--NG
get groups for user abc;
get groups for user group1;
get members in group user2;
get members in group group10;

log;