>>
>>cqd traf_composite_datatype_support 'OFF';

--- SQL operation complete.
>>cqd hive_composite_datatype_support 'ON';

--- SQL operation complete.
>>obey TEST061(tests_hive);
>>cqd hive_max_string_length_in_bytes '10';

--- SQL operation complete.
>>cqd hive_max_composite_string_length_in_bytes '10';

--- SQL operation complete.
>>
>>cqd hive_timestamp_precision_in_usec 'ON';

--- SQL operation complete.
>>
>>create database if not exists hive.test061;

--- SQL operation complete.
>>set schema hive.test061;

--- SQL operation complete.
>>
>>drop table if exists t061dummy;

--- SQL operation complete.
>>create table if not exists t061dummy (a int);

--- SQL operation complete.
>>insert into t061dummy values (1);

--- 1 row(s) inserted.
>>
>>drop table if exists t061arr1;

--- SQL operation complete.
>>create table t061arr1 (a array < string >) stored as parquet;

--- SQL operation complete.
>>invoke t061arr1;

-- Definition of hive table HIVE.TEST061.T061ARR1
-- Definition current  Mon Feb 25 22:12:43 2019

  (
    A                                VARCHAR(10 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT ARRAY[25]
  )
  /* stored as parquet */

--- SQL operation complete.
>>sh echo "insert into test061.t061arr1 select (array('abc', 'de')) from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select * from t061arr1;

A
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[abc,de]                                                                                                                                                                                                                                                                                                                                      

--- 1 row(s) selected.
>>
>>drop external table if exists t061row1 for t061row1;

--- SQL operation complete.
>>drop table if exists t061row1;

--- SQL operation complete.
>>create table t061row1 (a struct<a1:string, a2:int>) stored as parquet;

--- SQL operation complete.
>>invoke t061row1;

-- Definition of hive table HIVE.TEST061.T061ROW1
-- Definition current  Mon Feb 25 22:13:09 2019

  (
    A                                ROW(A1 VARCHAR(10 BYTES) CHARACTER SET
      UTF8, A2 INT)
  )
  /* stored as parquet */

--- SQL operation complete.
>>sh echo "insert into test061.t061row1 select (named_struct('a1','abcd', 'a2', 10)) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.t061row1 select named_struct('a1',cast(null as string),'a2',cast(null as int)) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select * from t061row1;

A                             
------------------------------

(abcd,10)                     
(?,?)                         

--- 2 row(s) selected.
>>
>>create external table t061row1(a row(a1 char(10 bytes) character set utf8, 
+>                               a2 smallint)) for hive.test061.t061row1;

*** ERROR[3242] This statement is not supported. Reason: Cannot specify explicit external attributes for composite column A.

--- SQL operation failed with errors.
>>create external table t061row1 for hive.test061.t061row1;

--- SQL operation complete.
>>invoke t061row1;

-- Definition of hive table HIVE.TEST061.T061ROW1
-- Definition current  Mon Feb 25 22:13:36 2019

  (
    A                                ROW(A1 VARCHAR(10 BYTES) CHARACTER SET
      UTF8, A2 INT)
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl t061row1;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.T061ROW1
  (
    A                                struct<a1:string,a2:int>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.T061ROW1;
/* ObjectUID = 502337118715897905 */

CREATE EXTERNAL TABLE T061ROW1
  FOR HIVE.TEST061.T061ROW1
;

--- SQL operation complete.
>>prepare s from select * from hive.test061.t061row1;

--- SQL command prepared.
>>execute s;

A                             
------------------------------

(abcd,10)                     
(?,?)                         

--- 2 row(s) selected.
>>select * from t061row1;

A                             
------------------------------

(abcd,10)                     
(?,?)                         

--- 2 row(s) selected.
>>select a.a1 from t061row1;

A1        
----------

abcd      
?         

--- 2 row(s) selected.
>>
>>drop external table if exists thps3 for thps3;

--- SQL operation complete.
>>drop table if exists thps3;

--- SQL operation complete.
>>create table thps3 (a array < struct <b:int,c:string > >) stored as parquet;

--- SQL operation complete.
>>invoke thps3;

-- Definition of hive table HIVE.TEST061.THPS3
-- Definition current  Mon Feb 25 22:13:44 2019

  (
    A                                ROW(B INT, C VARCHAR(10 BYTES) CHARACTER
      SET UTF8) ARRAY[25]
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl thps3;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS3
  (
    A                                array<struct<b:int,c:string>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS3;
/* ObjectUID = 502337118715901389 */

--- SQL operation complete.
>>sh echo "insert into test061.thps3 select (array (named_struct ('b',10,'c','abc'))) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.thps3 select (array (named_struct ('b',-1,'c','') , named_struct ('b', 20, 'c', 'xy'))) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>get parquet read schema for table thps3;


Parquet Read schema
==================

Table: HIVE.TEST061.THPS3

message HIVE.TEST061.THPS3 {
 optional group a (LIST) {
 repeated group bag {
 optional group array_element {
 optional int32 b;
 optional binary c (UTF8);
 }
 }
 }
}

--- SQL operation complete.
>>get parquet write schema for table thps3;

--- SQL operation complete.
>>select * from thps3;

A
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[(10,abc)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
[(-1,),(20,xy)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   

--- 2 row(s) selected.
>>select a[1] from thps3;

A_1                           
------------------------------

(10,abc)                      
(-1,)                         

--- 2 row(s) selected.
>>select a.b from thps3;

*** ERROR[3242] This statement is not supported. Reason: Array index must be specified for column A.

*** ERROR[8822] The statement was not prepared.

>>select a[1].b from thps3;

B          
-----------

         10
         -1

--- 2 row(s) selected.
>>select a[2] from thps3;

A_2                           
------------------------------

?                             
(20,xy)                       

--- 2 row(s) selected.
>>select a[2].c from thps3;

C         
----------

xy        
?         

--- 2 row(s) selected.
>>select cast(a as array[1]) from thps3;

(EXPR)                                    
------------------------------------------

[(10,abc)]                                
[(-1,)]                                   

--- 2 row(s) selected.
>>select cast(a as array[4]) from thps3;

(EXPR)
---------------------------------------------------------------------------------------------------------------------------------------------

[(10,abc)]                                                                                                                                   
[(-1,),(20,xy)]                                                                                                                              

--- 2 row(s) selected.
>>
>>cqd hive_composite_datatype_support 'ALL';

--- SQL operation complete.
>>select array_length(a || a) from thps3 order by 1;

(EXPR)    
----------

         2
         4

--- 2 row(s) selected.
>>select cast(a || a as char(40)) from thps3 order by 1;

(EXPR)                                  
----------------------------------------

[(-1,),(20,xy),(-1,),(20,xy)]           
[(10,abc),(10,abc)]                     

--- 2 row(s) selected.
>>cqd hive_composite_datatype_support 'ON';

--- SQL operation complete.
>>
>>-- cast to hive composite datatype not yet supported.
>>-- if cast is enabled thru internal cqd, then 
>>-- these stmts crash. Need to be fixed. Commenting them out for now.
>>?ignore
>>cqd hive_composite_datatype_support 'ALL';
>>select cast(a as row(b int, c varchar(10) character set utf8) array[2]) 
+>       from thps3;
>>
>>-- should return one element
>>select cast(a as row(b int, c varchar(10) character set utf8) array[1]) 
+>       from thps3;
>>
>>-- return error
>>create external table thps3 (a row(b smallint, c char(5) character set utf8) array[2]) for thps3;
>>showddl thps3;
>>
>>select * from thps3;
>>cqd hive_composite_datatype_support 'ON';
>>?ignore
>>
>>-- struct of struct
>>drop table if exists thps6;

--- SQL operation complete.
>>create table thps6(a struct<a1:struct<a2:int>>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.thps6 select named_struct('a1',named_struct('a2',10))  from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select * from thps6;

A                      
-----------------------

((10))                 

--- 1 row(s) selected.
>>
>>drop table if exists thps7;

--- SQL operation complete.
>>create table thps7(a struct< a1:struct<a2:int>, b1:struct<b2:int> > ) 
+>   stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.thps7 select named_struct('a1',named_struct('a2',10), 'b1',named_struct('b2',10)) from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select * from thps7;

A                                          
-------------------------------------------

((10),(10))                                

--- 1 row(s) selected.
>>
>>-- array of struct
>>drop view if exists vhps9;

--- SQL operation complete.
>>drop table if exists thps9;

--- SQL operation complete.
>>create table thps9(a int, aa string, 
+>                   b array<struct<b1:string, b2:string>>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.thps9 select 10, 'abcd1', (array(named_struct('b1','xyz11', 'b2', 'uv11'), named_struct('b1','xyz12', 'b2', 'uv12'))) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.thps9 select 20, 'abcd2', (array(named_struct('b1','xyz2', 'b2', 'uv2'))) from test061.t061dummy;" >> TEST061_junk;
>>sh echo "insert into test061.thps9 select 20, 'abcd2', (array(named_struct('b1',cast(null as string), 'b2', 'uv2'))) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>showddl thps9;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS9
  (
    A                                int
  , AA                               string
  , B                                array<struct<b1:string,b2:string>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS9;
/* ObjectUID = 502337118715908632 */

--- SQL operation complete.
>>select * from thps9;

A            AA          B
-----------  ----------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         10  abcd1       [(xyz11,uv11),(xyz12,uv12)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
         20  abcd2       [(xyz2,uv2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
         20  abcd2       [(?,uv2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 3 row(s) selected.
>>select a,aa,b[1].b1,b[2].b2 from thps9;

A            AA          B1          B2        
-----------  ----------  ----------  ----------

         10  abcd1       xyz11       uv12      
         20  abcd2       xyz2        ?         
         20  abcd2       ?           ?         

--- 3 row(s) selected.
>>select array_length(b) from thps9;

(EXPR)    
----------

         1
         2
         1

--- 3 row(s) selected.
>>select * from thps9 where b[1].b1 is null;

A            AA          B
-----------  ----------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         20  abcd2       [(?,uv2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>select * from thps9 where b[1].b1 is not null;

A            AA          B
-----------  ----------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         10  abcd1       [(xyz11,uv11),(xyz12,uv12)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
         20  abcd2       [(xyz2,uv2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             

--- 2 row(s) selected.
>>
>>create view vhps9 as select * from thps9;

--- SQL operation complete.
>>showddl vhps9;

Original native Hive view text:
select * from thps9

Expanded native Hive view text:
select `thps9`.`a`, `thps9`.`aa`, `thps9`.`b` from `TEST061`.`thps9`

Normalized native Hive view text:
CREATE VIEW HIVE.TEST061.VHPS9 AS
  select THPS9.A, THPS9.AA, THPS9.B from TEST061.THPS9 ;

REGISTER /*INTERNAL*/ HIVE VIEW HIVE.TEST061.VHPS9;
/* ObjectUID = 502337118715910895 */

--- SQL operation complete.
>>select * from vhps9;

A            AA          B
-----------  ----------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         10  abcd1       [(xyz11,uv11),(xyz12,uv12)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
         20  abcd2       [(xyz2,uv2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
         20  abcd2       [(?,uv2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 3 row(s) selected.
>>select b[1].b2 from vhps9;

B2        
----------

uv2       
uv11      
uv2       

--- 3 row(s) selected.
>>select b[1].b2 from thps9;

B2        
----------

uv2       
uv11      
uv2       

--- 3 row(s) selected.
>>
>>-- struct of array
>>drop view if exists vhps10;

--- SQL operation complete.
>>drop table if exists thps10;

--- SQL operation complete.
>>create table thps10(z int, a struct<a1:array<int>>) stored as parquet;

--- SQL operation complete.
>>invoke thps10;

-- Definition of hive table HIVE.TEST061.THPS10
-- Definition current  Mon Feb 25 22:15:23 2019

  (
    Z                                INT
  , A                                ROW(A1 INT ARRAY[25])
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl thps10;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS10
  (
    Z                                int
  , A                                struct<a1:array<int>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS10;
/* ObjectUID = 502337118715911289 */

--- SQL operation complete.
>>sh echo "insert into test061.thps10 select 10, named_struct('a1',array(10)) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.thps10 select 20, named_struct('a1',array(2,3)) from test061.t061dummy;" >> TEST061_junk;
>>sh echo "insert into test061.thps10 select null, named_struct('a1',array(2,cast(null as int))) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select * from thps10;

Z            A
-----------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         10  ([10])                                                                                                                                                                                                                                                                                                                                                                       
         20  ([2,3])                                                                                                                                                                                                                                                                                                                                                                      
          ?  ([2,?])                                                                                                                                                                                                                                                                                                                                                                      

--- 3 row(s) selected.
>>
>>create view vhps10 as select * from thps10;

--- SQL operation complete.
>>showddl vhps10;

Original native Hive view text:
select * from thps10

Expanded native Hive view text:
select `thps10`.`z`, `thps10`.`a` from `TEST061`.`thps10`

Normalized native Hive view text:
CREATE VIEW HIVE.TEST061.VHPS10 AS
  select THPS10.Z, THPS10.A from TEST061.THPS10 ;

REGISTER /*INTERNAL*/ HIVE VIEW HIVE.TEST061.VHPS10;
/* ObjectUID = 502337118715913713 */

--- SQL operation complete.
>>select * from vhps10;

Z            A
-----------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         10  ([10])                                                                                                                                                                                                                                                                                                                                                                       
         20  ([2,3])                                                                                                                                                                                                                                                                                                                                                                      
          ?  ([2,?])                                                                                                                                                                                                                                                                                                                                                                      

--- 3 row(s) selected.
>>select a.a1[1] from vhps10 order by 1;

A1_1       
-----------

          2
          2
         10

--- 3 row(s) selected.
>>select a.a1[1] from thps10 order by 1;

A1_1       
-----------

          2
          2
         10

--- 3 row(s) selected.
>>select a.a1[2] from vhps10 order by 1;

A1_2       
-----------

          3
          ?
          ?

--- 3 row(s) selected.
>>select a.a1[2] from thps10 order by 1;

A1_2       
-----------

          3
          ?
          ?

--- 3 row(s) selected.
>>
>>-- varchar/char columns
>>drop table if exists thps11;

--- SQL operation complete.
>>create table thps11(a int,
+>                   b array<struct<b1:varchar(20), b2:char(20)>>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.thps11 select 10, (array(named_struct('b1',cast('xyz11' as varchar(20)), 'b2', cast('uv11' as char(20))))) from test061.t061dummy;" > TEST061_junk;
>>
>>sh echo "insert into test061.thps11 select 20, (array(named_struct('b1',cast('xyz11' as varchar(20)), 'b2', cast('uv11' as char(20))), named_struct('b1',cast('xyz12' as varchar(20)), 'b2', cast('uv12' as char(20))))) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>showddl thps11;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS11
  (
    A                                int
  , B                                array<struct<b1:varchar(20),b2:char(20)>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS11;
/* ObjectUID = 502337118715914027 */

--- SQL operation complete.
>>select * from thps11;

A            B
-----------  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

         10  [(xyz11,uv11)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
         20  [(xyz11,uv11),(xyz12,uv12)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          

--- 2 row(s) selected.
>>select a,b[1].b1,b[2].b2 from thps11;

A            B1                                                                                B2
-----------  --------------------------------------------------------------------------------  --------------------------------------------------------------------------------

         10  xyz11                                                                             ?                                                                               
         20  xyz11                                                                             uv12                                                                            

--- 2 row(s) selected.
>>
>>-- multiple array, struct, array/struct fields
>>drop table if exists thps12;

--- SQL operation complete.
>>create table thps12 (
+>                  a array<int>,
+>                  a1 array<char(10)>,
+>                  a2 array<varchar(10)>,
+>                  b struct<b1:int,b2:int>,
+>                  c array<struct<c1:int,c2:int>>
+>) 
+> stored as parquet;

--- SQL operation complete.
>>invoke thps12;

-- Definition of hive table HIVE.TEST061.THPS12
-- Definition current  Mon Feb 25 22:16:14 2019

  (
    A                                INT ARRAY[25]
  , A1                               CHAR(10 CHARS) CHARACTER SET UTF8 COLLATE
      DEFAULT ARRAY[25]
  , A2                               VARCHAR(10 CHARS) CHARACTER SET UTF8
      COLLATE DEFAULT ARRAY[25]
  , B                                ROW(B1 INT, B2 INT)
  , C                                ROW(C1 INT, C2 INT) ARRAY[25]
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl thps12;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS12
  (
    A                                array<int>
  , A1                               array<char(10)>
  , A2                               array<varchar(10)>
  , B                                struct<b1:int,b2:int>
  , C                                array<struct<c1:int,c2:int>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS12;
/* ObjectUID = 502337118715916431 */

--- SQL operation complete.
>>sh echo "insert into test061.thps12 select array(10,20), array(cast('abc' as char(10))), array(cast('xy' as varchar(10))), named_struct('b1',10,'b2',20), array(named_struct('c1',10,'c2',20), named_struct('c1',100,'c2',200)) from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>select a[1], b.b2, c[2].c1 from thps12;

A_1          B2           C1         
-----------  -----------  -----------

         10           20          100

--- 1 row(s) selected.
>>select a,b,c from  thps12 where c[2].c2 = 200;

A                                                                                                                                                                                                                                                                                                                                                                        B                                C
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -------------------------------  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[10,20]                                                                                                                                                                                                                                                                                                                                                                  (10,20)                          [(10,20),(100,200)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

--- 1 row(s) selected.
>>
>>-- decimal, timestamp columns
>>drop table if exists thps13;

--- SQL operation complete.
>>create table thps13 (
+>                  a array<decimal(5,2)>,
+>                  b struct<b1:decimal(3,0),b2:timestamp>,
+>                  c array<struct<c1:decimal(4,1),c2:timestamp>>
+>) 
+> stored as parquet;

--- SQL operation complete.
>>invoke thps13;

-- Definition of hive table HIVE.TEST061.THPS13
-- Definition current  Mon Feb 25 22:16:35 2019

  (
    A                                NUMERIC(5, 2) ARRAY[25]
  , B                                ROW(B1 NUMERIC(3, 0), B2 TIMESTAMP(6))
  , C                                ROW(C1 NUMERIC(4, 1), C2 TIMESTAMP(6))
      ARRAY[25]
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl thps13;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS13
  (
    A                                array<decimal(5,2)>
  , B                                struct<b1:decimal(3,0),b2:timestamp>
  , C                               
      array<struct<c1:decimal(4,1),c2:timestamp>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS13;
/* ObjectUID = 502337118715918508 */

--- SQL operation complete.
>>sh echo "insert into test061.thps13 select array(cast(10.23 as decimal(5,2)),cast(20 as decimal(5,2))), named_struct('b1',cast(100 as decimal(3,0)),'b2',cast('2018-01-01 10:10:10' as timestamp)), array(named_struct('c1',cast(123.4 as decimal(4,1)),'c2',cast('2019-01-01 10:20:30' as timestamp)), named_struct('c1',cast(100 as decimal(4,1)),'c2',cast('2020-01-01 10:10:10' as timestamp))) from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>select * from thps13;

A                                                                                                                                                                                                                                                                                                                                                                                                 B                                          C
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------------------------------------  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[10.23,20]                                                                                                                                                                                                                                                                                                                                                                                        (100,2018-01-01 10:10:10.000000)           [(123.4,2019-01-01 10:20:30.000000),(100,2020-01-01 10:10:10.000000)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

--- 1 row(s) selected.
>>
>>-- all datatypes
>>drop table if exists thps14;

--- SQL operation complete.
>>create table thps14(aa array<struct<a:char(2), b:varchar(3), c:string, d:decimal(5,2), e:decimal(19,0), f:decimal, g:boolean, h:tinyint, i:float, j:double, k:timestamp , l:int, m:bigint>>) stored as parquet;

--- SQL operation complete.
>>invoke thps14;

-- Definition of hive table HIVE.TEST061.THPS14
-- Definition current  Mon Feb 25 22:16:55 2019

  (
    AA                               ROW(A CHAR(2 CHARS) CHARACTER SET UTF8, B
      VARCHAR(3 CHARS) CHARACTER SET UTF8, C VARCHAR(10 BYTES) CHARACTER SET
      UTF8, D NUMERIC(5, 2), E NUMERIC(19, 0), F NUMERIC(10, 0), G BOOLEAN, H
      TINYINT, I REAL, J FLOAT(54), K TIMESTAMP(6), L INT, M LARGEINT)
      ARRAY[25]
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl thps14;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.THPS14
  (
    AA                              
      array<struct<a:char(2),b:varchar(3),c:string,d:decimal(5,2),e:decimal(19,0),f:decimal(10,0),g:boolean,h:tinyint,i:float,j:double,k:timestamp,l:int,m:bigint>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.THPS14;
/* ObjectUID = 502337118715920553 */

--- SQL operation complete.
>>sh echo "insert into test061.thps14 select array(named_struct('a',cast('ab' as char(2)), 'b',cast('x' as varchar(3)), 'c','abc',  'd',cast(10.12 as decimal(5,2)), 'e',cast(20 as decimal(19,0)), 'f',cast(1234 as decimal),  'g', true,  'h',cast(3 as tinyint),  'i',cast(12.56e10 as float),  'j', -1234.566e4, 'k',cast('2019-01-01 10:20:30' as timestamp), 'l',123, 'm', cast(-546 as bigint)), named_struct('a',cast('ab' as char(2)), 'b',cast('x' as varchar(3)), 'c','abc',  'd',cast(10.12 as decimal(5,2)), 'e',cast(20 as decimal(19,0)), 'f',cast(1234 as decimal),  'g', true,  'h',cast(3 as tinyint),  'i',cast(12.56e10 as float),  'j', -1234.566e4, 'k',cast('2020-01-01 10:20:30' as timestamp), 'l',123, 'm', cast(-546 as bigint))) from test061.t061dummy ;" > TEST061_junk;
>>
>>sh echo "insert into test061.thps14 select array(named_struct('a',cast('ab' as char(2)), 'b',cast('x' as varchar(3)), 'c','abc',  'd',cast(10.12 as decimal(5,2)), 'e',cast(20 as decimal(19,0)), 'f',cast(1234 as decimal),  'g', true,  'h',cast(3 as tinyint),  'i',cast(12.56e10 as float),  'j', -1234.566e4, 'k',cast('2021-01-01 10:20:30' as timestamp), 'l',123, 'm',cast(-546 as bigint) ), named_struct('a',cast('ab' as char(2)), 'b',cast('x' as varchar(3)), 'c','abc',  'd',cast(10.12 as decimal(5,2)), 'e',cast(20 as decimal(19,0)), 'f',cast(1234 as decimal),  'g', true,  'h',cast(3 as tinyint),  'i',cast(12.56e10 as float),  'j', -1234.566e4, 'k',cast('2022-01-01 10:20:30' as timestamp) , 'l',123, 'm',cast(-546 as bigint))) from test061.t061dummy ;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>select cast(aa as varchar(300)) from thps14;

(EXPR)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2019-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2020-01-01 10:20:30.000000,123,-546)]                                                                                 
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2021-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2022-01-01 10:20:30.000000,123,-546)]                                                                                 

--- 2 row(s) selected.
>>select * from unnest(thps14, thps14.aa) x;

A         B             C           D             E                     F                     G      H     I                J                          K                           L                     M
--------  ------------  ----------  ------------  --------------------  --------------------  -----  ----  ---------------  -------------------------  --------------------------  --------------------  --------------------

ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2019-01-01 10:20:30.000000                   123                  -546
ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2020-01-01 10:20:30.000000                   123                  -546
ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2021-01-01 10:20:30.000000                   123                  -546
ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2022-01-01 10:20:30.000000                   123                  -546

--- 4 row(s) selected.
>>select x.* from thps14 lateral view unnest(aa) x;

A         B             C           D             E                     F                     G      H     I                J                          K                           L                     M
--------  ------------  ----------  ------------  --------------------  --------------------  -----  ----  ---------------  -------------------------  --------------------------  --------------------  --------------------

ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2019-01-01 10:20:30.000000                   123                  -546
ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2020-01-01 10:20:30.000000                   123                  -546
ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2021-01-01 10:20:30.000000                   123                  -546
ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2022-01-01 10:20:30.000000                   123                  -546

--- 4 row(s) selected.
>>select cast(thps14.aa as char(300)), x.* from thps14 lateral view unnest(aa) x;

(EXPR)                                                                                                                                                                                                                                                                                                        A         B             C           D             E                     F                     G      H     I                J                          K                           L                     M
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------  ------------  ----------  ------------  --------------------  --------------------  -----  ----  ---------------  -------------------------  --------------------------  --------------------  --------------------

[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2019-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2020-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2019-01-01 10:20:30.000000                   123                  -546
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2019-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2020-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2020-01-01 10:20:30.000000                   123                  -546
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2021-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2022-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2021-01-01 10:20:30.000000                   123                  -546
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2021-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2022-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2022-01-01 10:20:30.000000                   123                  -546

--- 4 row(s) selected.
>>select cast(thps14.aa as char(300)), x.* from thps14 lateral view unnest(aa) x where thps14.aa[1].a = x.a;

(EXPR)                                                                                                                                                                                                                                                                                                        A         B             C           D             E                     F                     G      H     I                J                          K                           L                     M
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------  ------------  ----------  ------------  --------------------  --------------------  -----  ----  ---------------  -------------------------  --------------------------  --------------------  --------------------

[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2019-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2020-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2019-01-01 10:20:30.000000                   123                  -546
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2019-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2020-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2020-01-01 10:20:30.000000                   123                  -546
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2021-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2022-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2021-01-01 10:20:30.000000                   123                  -546
[(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2021-01-01 10:20:30.000000,123,-546),(ab,x,abc,10.12,20,1234,TRUE,3,1.2559999E+011,-1.23456600000000000E+007,2022-01-01 10:20:30.000000,123,-546)]                                                                                   ab        x             abc                10.12                    20                  1234  TRUE      3   1.2559999E+011  -1.23456600000000000E+007  2022-01-01 10:20:30.000000                   123                  -546

--- 4 row(s) selected.
>>select cast(thps14.aa as char(300)), x.* from thps14 lateral view unnest(aa) x where thps14.aa[1].a != x.a;

--- 0 row(s) selected.
>>
>>drop table if exists thps15;

--- SQL operation complete.
>>create table thps15 (a struct<a1:struct<a1:int>, a2:array<int>>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.thps15 select named_struct('a1', named_struct('a1',10), 'a2', array(10)) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.thps15 select named_struct('a1', named_struct('a1',100), 'a2', array(100,200)) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select * from thps15;

A
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

((10),[10])                                                                                                                                                                                                                                                                                                                                                                                      
((100),[100,200])                                                                                                                                                                                                                                                                                                                                                                                

--- 2 row(s) selected.
>>select a, a.a1, a.a2, a.a2[1] from thps15;

A                                                                                                                                                                                                                                                                                                                                                                                                  A1                 A2                                                                                                                                                                                                                                                                                                                                                                       A2_1
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------

((10),[10])                                                                                                                                                                                                                                                                                                                                                                                        (10)               [10]                                                                                                                                                                                                                                                                                                                                                                              10
((100),[100,200])                                                                                                                                                                                                                                                                                                                                                                                  (100)              [100,200]                                                                                                                                                                                                                                                                                                                                                                        100

--- 2 row(s) selected.
>>select a, a.a1, a.a2, a.a2[2] from thps15;

A                                                                                                                                                                                                                                                                                                                                                                                                  A1                 A2                                                                                                                                                                                                                                                                                                                                                                       A2_2
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------------  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -----------

((10),[10])                                                                                                                                                                                                                                                                                                                                                                                        (10)               [10]                                                                                                                                                                                                                                                                                                                                                                               ?
((100),[100,200])                                                                                                                                                                                                                                                                                                                                                                                  (100)              [100,200]                                                                                                                                                                                                                                                                                                                                                                        200

--- 2 row(s) selected.
>>select * from unnest(thps15, thps15.a.a2) x;

A2                  
--------------------

                  10
                 100
                 200

--- 3 row(s) selected.
>>select * from unnest(thps15, a.a2) x;

A2                  
--------------------

                  10
                 100
                 200

--- 3 row(s) selected.
>>select * from unnest(thps15, {thps15.a}.a2) x;

A                   
--------------------

                  10
                 100
                 200

--- 3 row(s) selected.
>>select * from thps15 lateral view unnest(a.a2) x;

A                                                                                                                                                                                                                                                                                                                                                                                                  A2
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------

((10),[10])                                                                                                                                                                                                                                                                                                                                                                                                          10
((100),[100,200])                                                                                                                                                                                                                                                                                                                                                                                                   100
((100),[100,200])                                                                                                                                                                                                                                                                                                                                                                                                   200

--- 3 row(s) selected.
>>select x.* from thps15 lateral view unnest(a.a2) x;

A2                  
--------------------

                  10
                 100
                 200

--- 3 row(s) selected.
>>select x.* from thps15 lateral view unnest(a.a2) x where x.a2 = 100;

A2                  
--------------------

                 100

--- 1 row(s) selected.
>>
>>drop table if exists thps16;

--- SQL operation complete.
>>create table thps16 (col struct<c1:array<int>, c2:array<int>>) stored as parquet;

--- SQL operation complete.
>>select * from thps16 T1, thps16 T2 where (T1.col.c1, T1.col.c2)=(T2.col.c1, T2.col.c2);

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>-- array of array not supported
>>create table thps3err0 (a array < array <int> >) stored as parquet;

--- SQL operation complete.
>>invoke thps3err0;

*** ERROR[1204] Unsupported Hive datatype array<array<int>>.

*** ERROR[8822] The statement was not prepared.

>>
>>-- error: only parquet read supported with composite cols
>>create table thps3err1 (a array < struct <b:int,c:string > >) stored as orc;

--- SQL operation complete.
>>create table thps3err2 (a array < struct <b:int,c:string > >) stored as textfile;

--- SQL operation complete.
>>prepare s from select * from thps3err1;

*** ERROR[3242] This statement is not supported. Reason: Composite columns are not allowed in non-parquet hive tables.

*** ERROR[8822] The statement was not prepared.

>>prepare s from select * from thps3err2;

*** ERROR[3242] This statement is not supported. Reason: Composite columns are not allowed in non-parquet hive tables.

*** ERROR[8822] The statement was not prepared.

>>
>>-- error: write into parq with composite cols not supported
>>insert into test061.thps3 values (row(10, 'ab'));

*** ERROR[3242] This statement is not supported. Reason: Cannot specify composite array or row constructor.

*** ERROR[8822] The statement was not prepared.

>>insert into test061.thps3 default values;

*** ERROR[3242] This statement is not supported. Reason: Insert into hive tables with composite columns is not allowed.

*** ERROR[8822] The statement was not prepared.

>>
>>-- cannot create traf view on a hive table with composite cols
>>create view trafodion.sch.tverr as select * from thps3;

*** ERROR[3242] This statement is not supported. Reason: Cannot specify composite datatypes for a table or view.

--- SQL operation failed with errors.
>>
>>-- for now, cannot concat hive array columns
>>select a || a from thps3;

*** ERROR[3242] This statement is not supported. Reason: Cannot concatenate composite datatypes.

*** ERROR[8822] The statement was not prepared.

>>
>>-- for now, cannot cast composite columns
>>select cast(a[1] as row(b int, c varchar(10))) from thps3;

*** ERROR[3242] This statement is not supported. Reason: Cannot cast to composite datatype.

*** ERROR[8822] The statement was not prepared.

>>
>>
>>obey TEST061(tests_unnest);
>>cqd hive_max_string_length_in_bytes '20';

--- SQL operation complete.
>>cqd hive_max_composite_string_length_in_bytes '20';

--- SQL operation complete.
>>
>>set schema hive.test061;

--- SQL operation complete.
>>drop table if exists t061tun1;

--- SQL operation complete.
>>create table t061tun1 (a bigint, b array<string>,
+>                       c array<struct<c1:int, c2:string>>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.t061tun1 select 1, array('ab','cd','efg'), array(named_struct('c1',10,'c2','xyz'), named_struct('c1',200,'c2','')) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.t061tun1 select 2, array('aaa','b'), array(named_struct('c1',20,'c2','xyz'), named_struct('c1',30,'c2','zz')) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>--insert into t061tun1 values (3, null,  null);
>>
>>select * from t061tun1;

A                     B                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         C
--------------------  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                   1  [ab,cd,efg]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               [(10,xyz),(200,)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                   2  [aaa,b]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   [(20,xyz),(30,zz)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          

--- 2 row(s) selected.
>>select * from unnest(t061tun1, t061tun1.b) x;

B                   
--------------------

ab                  
cd                  
efg                 
aaa                 
b                   

--- 5 row(s) selected.
>>select * from unnest(t061tun1, c) x;

C1                    C2                  
--------------------  --------------------

                  10  xyz                 
                 200                      
                  20  xyz                 
                  30  zz                  

--- 4 row(s) selected.
>>select z.a, x.* from t061tun1 as z lateral view unnest(b) x;

A                     B                   
--------------------  --------------------

                   1  ab                  
                   1  cd                  
                   1  efg                 
                   2  aaa                 
                   2  b                   

--- 5 row(s) selected.
>>select z.a, x.* from t061tun1 as z lateral view unnest(c) x;

A                     C1                    C2                  
--------------------  --------------------  --------------------

                   1                    10  xyz                 
                   1                   200                      
                   2                    20  xyz                 
                   2                    30  zz                  

--- 4 row(s) selected.
>>select z.a, x.*,y.* from t061tun1 as z lateral view unnest(b) x lateral view unnest(c) y;

A                     B                     C1                    C2
--------------------  --------------------  --------------------  --------------------

                   2  aaa                                     20  xyz                 
                   2  b                                       20  xyz                 
                   2  aaa                                     30  zz                  
                   2  b                                       30  zz                  
                   1  ab                                      10  xyz                 
                   1  efg                                     10  xyz                 
                   1  cd                                      10  xyz                 
                   1  ab                                     200                      
                   1  efg                                    200                      
                   1  cd                                     200                      

--- 10 row(s) selected.
>>select z.a, x.*,y.* from t061tun1 as z lateral view unnest(c) x lateral view unnest(c) y order by 1;

A                     C1                    C2                    C1                    C2
--------------------  --------------------  --------------------  --------------------  --------------------

                   1                   200                                          10  xyz                 
                   1                    10  xyz                                    200                      
                   1                   200                                         200                      
                   1                    10  xyz                                     10  xyz                 
                   2                    30  zz                                      20  xyz                 
                   2                    20  xyz                                     30  zz                  
                   2                    30  zz                                      30  zz                  
                   2                    20  xyz                                     20  xyz                 

--- 8 row(s) selected.
>>
>>drop table if exists pageads;

--- SQL operation complete.
>>create table pageAds (pageid string, adid_list array<int>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.pageads select 'front_page', array(1,2,3) from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.pageads select 'contact_page', array(3,4,5) from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>SELECT adid, adtable.adid FROM unnest(pageads, pageads.adid_list) adTable (adid) order by 1;

ADID                  ADID                
--------------------  --------------------

                   1                     1
                   2                     2
                   3                     3
                   3                     3
                   4                     4
                   5                     5

--- 6 row(s) selected.
>>SELECT adid, adtable.adid FROM unnest(pageads, adid_list) adTable (adid) order by 1;

ADID                  ADID                
--------------------  --------------------

                   1                     1
                   2                     2
                   3                     3
                   3                     3
                   4                     4
                   5                     5

--- 6 row(s) selected.
>>
>>SELECT pageid, adid
+>FROM pageAds as pa LATERAL VIEW unnest(adid_list) adTable (adid)
+>order by pageid, 2;

PAGEID                ADID                
--------------------  --------------------

contact_page                             3
contact_page                             4
contact_page                             5
front_page                               1
front_page                               2
front_page                               3

--- 6 row(s) selected.
>>
>>SELECT adid, count(1)
+>FROM pageAds LATERAL VIEW unnest(adid_list) adTable (adid)
+>GROUP BY adid order by adid;

ADID                  (EXPR)              
--------------------  --------------------

                   1                     1
                   2                     1
                   3                     2
                   4                     1
                   5                     1

--- 5 row(s) selected.
>>
>>select b from unnest(pageads, pageads.adid_list) a(b) order by b;

B                   
--------------------

                   1
                   2
                   3
                   3
                   4
                   5

--- 6 row(s) selected.
>>
>>select adid_list[1], adTable.adid from pageads lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>select pageads.adid_list[1], adTable.adid from pageads lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>select test061.pageads.adid_list[1], adTable.adid from pageads lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>select hive.test061.pageads.adid_list[1], adTable.adid from pageads lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>
>>-- use of {} around composite cols to remove any ambiguity
>>select {pageads.adid_list}[1], adTable.adid from pageads lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>
>>select adid_list[1], x.adid_list[1], adTable.adid from pageads as x lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID_LIST_1  ADID                
-----------  -----------  --------------------

          1            1                     1
          1            1                     2
          1            1                     3
          3            3                     3
          3            3                     4
          3            3                     5

--- 6 row(s) selected.
>>
>>select {x.adid_list}[1], adTable.adid from pageads as x lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>
>>select {x.adid_list}[1], adid from pageads as x lateral view unnest(adid_list) adTable(adid);

ADID_LIST_1  ADID                
-----------  --------------------

          1                     1
          1                     2
          1                     3
          3                     3
          3                     4
          3                     5

--- 6 row(s) selected.
>>
>>select hive.test061.pageads.adid_list[1] from hive.test061.pageads;

ADID_LIST_1
-----------

          3
          1

--- 2 row(s) selected.
>>select {hive.test061.pageads.adid_list}[1] from hive.test061.pageads;

ADID_LIST_1
-----------

          3
          1

--- 2 row(s) selected.
>>
>>drop table if exists basetable;

--- SQL operation complete.
>>create table basetable (col1 array<int>, col2 array<string>) stored as parquet;

--- SQL operation complete.
>>sh echo "insert into test061.basetable select array(1,2), array('a','b','c') from test061.t061dummy;" > TEST061_junk;
>>sh echo "insert into test061.basetable select array(3,4), array('d','e','f') from test061.t061dummy;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>select mycol1, col2 from basetable lateral view unnest(col1) mytable1 (mycol1)
+> order by 1;

MYCOL1                COL2
--------------------  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                   1  [a,b,c]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                   2  [a,b,c]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                   3  [d,e,f]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                   4  [d,e,f]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 

--- 4 row(s) selected.
>>
>>select col2[1], mycol1 from basetable lateral view unnest(col1) mytable1 (mycol1) 
+>where mycol1 = 10 order by 1;

--- 0 row(s) selected.
>>
>>select col2[1], mycol1 from basetable lateral view outer unnest(col1) mytable1 (mycol1) 
+>where mycol1 = 10 order by 1;

--- 0 row(s) selected.
>>
>>SELECT myCol1, myCol2 FROM baseTable
+>LATERAL VIEW unnest(col1) myTable1 (myCol1)
+>LATERAL VIEW unnest(col2) myTable2 (myCol2)
+>order by 1,2;

MYCOL1                MYCOL2              
--------------------  --------------------

                   1  a                   
                   1  b                   
                   1  c                   
                   2  a                   
                   2  b                   
                   2  c                   
                   3  d                   
                   3  e                   
                   3  f                   
                   4  d                   
                   4  e                   
                   4  f                   

--- 12 row(s) selected.
>>
>>
>>obey TEST061(tests_jpmc);
>>drop table if exists hive.test061.`party`;

--- SQL operation complete.
>>cqd hive_max_string_length_in_bytes '1000';

--- SQL operation complete.
>>cqd hive_max_composite_string_length_in_bytes '10';

--- SQL operation complete.
>>
>>CREATE EXTERNAL TABLE hive.test061.`party`(                     
+>   `schema` string,                                 
+>   `gwmidentifier` string,                          
+>   `updatetimestamp` string,                        
+>   `updateuseridentifier` string,                   
+>   `clientonlineenrollmentindicator` boolean,       
+>   `insiderindicator` boolean,                      
+>   `jpmcaffiliateindicator` boolean,                
+>   `badaddressindicator` boolean,                   
+>   `pepindicator` boolean,                          
+>   `gwmactiveaccountindicator` boolean,             
+>   `clientsegmentcode` string,                      
+>   `clienttickercode` string,                       
+>   `overalldonottradecode` string,                  
+>   `employeestandardidentifier` string,             
+>   `householdclientclassificationcode` string,      
+>   `insidercode` string,                            
+>   `enterprisecustomersubtypecode` string,          
+>   `enterpriseclientsensitiveindicator` string,     
+>   `amlcustomertypecode` string,                    
+>   `leirecertificationdate` string,                 
+>   `leiidentifier` string,                          
+>   `jpmclegalentitycode` string,                    
+>   `jpmcfiduciaryagentcode` string,                 
+>   `trustcreatorname` string,                       
+>   `jpmcaccountcontrollerroleid` bigint,            
+>   `jpmcclientcontrollerroleid` bigint,             
+>   `pbpartyindicator` boolean,                      
+>   `pcspartyindicator` boolean,                     
+>   `highlysensitiveindicator` boolean,              
+>   `clientemployeeindicator` boolean,               
+>   `partyactiveindicator` boolean,                  
+>   `confidentialnameindicator` boolean,             
+>   `ultrahighlysensitiveindicator` boolean,         
+>   `jsipartyindicator` boolean,                     
+>   `pcdpartyindicator` boolean,                     
+>   `cpcpartyindicator` boolean,                     
+>   `deletedindicator` boolean,                      
+>   `accountvisibilityoverrideindicator` boolean,    
+>   `enterprisepartyindicator` boolean,              
+>   `partyfirstname` string,                         
+>   `partylastname` string,                          
+>   `partyfullname` string,                          
+>   `legaladdresscityname` string,                   
+>   `legaladdressstatecode` string,                  
+>   `legaladdresscountryisocode` string,             
+>   `partymiddlename` string,                        
+>   `clientvisibilitygroupcode` string,              
+>   `eciidentifier` string,                          
+>   `dmeciidentifier` string,                        
+>   `gcrcode` string,                                
+>   `casidentifier` string,                          
+>   `partytypecode` string,                          
+>   `primarylobcode` string,                         
+>   `ucnidentifier` string,                          
+>   `preferredlanguagecode` string,                  
+>   `partyclassificationcode` string,                
+>   `partystatuscode` string,                        
+>   `enterpriseclientacquisitioncode` string,        
+>   `sourceapplicationcode` string,                  
+>   `partyidentifier` bigint,                        
+>   `partydescriptionidentifier` bigint,             
+>   `spnidentifier` string,                          
+>   `clientopendate` string,                         
+>   `partyalternateidentifier` string,               
+>   `partyalternateidentifiertypecode` string,       
+>   `marketingoptoutindicator` boolean,              
+>   `deleteindicator` boolean,                       
+>   `customerlifecycleroleidentifier` bigint,        
+>   `professionaladvisorindicator` boolean,          
+>   `partycategorycode` string,                      
+>   `empldesctext` string,                           
+>   `deceasedindicator` boolean,                     
+>   `birthdateapproximateindicator` boolean,         
+>   `gendercode` string,                             
+>   `maritalstatuscode` string,                      
+>   `employername` string,                           
+>   `mothermaidenname` string,                       
+>   `maidenname` string,                             
+>   `prefixname` string,                             
+>   `suffixname` string,                             
+>   `generationname` string,                         
+>   `cityofbirthname` string,                        
+>   `countryofbirthisocode` string,                  
+>   `cityofbirthcode` string,                        
+>   `provincestatecode` string,                      
+>   `birthdateformatcode` string,                    
+>   `uspermanentresidentindicator` boolean,          
+>   `employmenttypecode` string,                     
+>   `occupationtypecode` string,                     
+>   `occupationdescriptiontext` string,              
+>   `deceaseddate` string,                           
+>   `birthdate` string,                              
+>   `forprofitindicator` boolean,                    
+>   `passwordtext` string,                           
+>   `nonprofitcharitabletrusttypecode` string,       
+>   `nonprofitcharitabletrustsubtypecode` string,    
+>   `nonprofitcharitableentitytypecode` string,      
+>   `estatetrusttypecode` string,                    
+>   `incorporationcountrycode` string,               
+>   `incorporationstatecode` string,                 
+>   `incorporationdate` string,                      
+>   `primarykey` bigint,                             
+>   `valid_from` string,                             
+>   `valid_till` string,                             
+>   `clientcountryrelationships` array<struct<countryISO2Code:string,countryPurposeCode:string,primaryCountryIndicator:boolean,fromDate:string,toDate:string,cityName:string,postalCode:string,provinceStateCode:string,schema:string>>,  
+>   `clientcredithierarchies` array<struct<partyAlternateIdentifier:string,partyAlternateIdentifierTypeCode:string,parentPartyAlternateIdentifier:string,parentPartyAlternateIdentifierTypeCode:string,ultimateParentPartyAlternateIdentifier:string,ultimateParentPartyAlternateIdentifierTypeCode:string,schema:string>>,  
+>   `clientcountryspecialprocesstypes` array<struct<creditSpecialProcessTypeCode:string,schema:string>>,  
+>   `clientkycriskratings` array<struct<clientKYCRiskRatingCode:string,clientKYCCompletionDate:string,schema:string>>,  
+>   `muniadvisorycompliance` array<struct<muniAdvisoryEntityTypeCode:string,attestationCertificationDate:string,attestationExpirationDate:string,muniProceedsIndicator:boolean,schema:string>>,  
+>   `clientaliases` array<struct<languageCode:string,partyAliasName:string,partyAliasNameDescription:string,sourceApplicationCode:string,partyAliasNameSequence:bigint,schema:string>>,  
+>   `clientcreditratings` array<struct<creditRatingCode:string,ratingAgencyPartyIdentifier:bigint,schema:string>>,  
+>   `clientdonottradereasons` array<struct<doNotTradeReasonCode:string,doNotTradeEffectiveDate:string,schema:string>>,  
+>   `governmentidentifications` array<struct<governmentIssuedIdentification:string,issuerCountryCode:string,governmentIssuedIdDescription:string,governmentIssuedIdType:string,issuedLocationName:string,partyVerificationIdNumber:bigint,schema:string>>,  
+>   `industryclassifications` array<struct<primaryIndustryIndicator:boolean,industryClassificationTypeCode:string,industryClassificationSchemeIdentifier:int,industryClassicationCategoryIdentifier:bigint,schema:string>>,  
+>   `clientmarketingbranches` array<struct<marketingBranchIdentifier:bigint,schema:string>>,  
+>   `clientalternatenames` array<struct<businessSystemCode:string,namePurposeTypeCode:string,nameTypeCode:string,partyName:string,confidentialNameIndicator:boolean,sourceApplicationCode:string,nameDescriptionText:string,schema:string>>) 
+> PARTITIONED BY (                                   
+>   `data_group` string,                             
+>   `branchidentifier` bigint)                       
+>stored as parquet;

--- SQL operation complete.
>>
>>set schema hive.test061;

--- SQL operation complete.
>>invoke party;

-- Definition of hive table HIVE.TEST061.PARTY
-- Definition current  Mon Feb 25 22:19:10 2019

  (
    "SCHEMA"                         VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , GWMIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , UPDATETIMESTAMP                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , UPDATEUSERIDENTIFIER             VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CLIENTONLINEENROLLMENTINDICATOR  BOOLEAN
  , INSIDERINDICATOR                 BOOLEAN
  , JPMCAFFILIATEINDICATOR           BOOLEAN
  , BADADDRESSINDICATOR              BOOLEAN
  , PEPINDICATOR                     BOOLEAN
  , GWMACTIVEACCOUNTINDICATOR        BOOLEAN
  , CLIENTSEGMENTCODE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CLIENTTICKERCODE                 VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , OVERALLDONOTTRADECODE            VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , EMPLOYEESTANDARDIDENTIFIER       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , HOUSEHOLDCLIENTCLASSIFICATIONCODE VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INSIDERCODE                      VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , ENTERPRISECUSTOMERSUBTYPECODE    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , ENTERPRISECLIENTSENSITIVEINDICATOR VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , AMLCUSTOMERTYPECODE              VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , LEIRECERTIFICATIONDATE           VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , LEIIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , JPMCLEGALENTITYCODE              VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , JPMCFIDUCIARYAGENTCODE           VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , TRUSTCREATORNAME                 VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , JPMCACCOUNTCONTROLLERROLEID      LARGEINT
  , JPMCCLIENTCONTROLLERROLEID       LARGEINT
  , PBPARTYINDICATOR                 BOOLEAN
  , PCSPARTYINDICATOR                BOOLEAN
  , HIGHLYSENSITIVEINDICATOR         BOOLEAN
  , CLIENTEMPLOYEEINDICATOR          BOOLEAN
  , PARTYACTIVEINDICATOR             BOOLEAN
  , CONFIDENTIALNAMEINDICATOR        BOOLEAN
  , ULTRAHIGHLYSENSITIVEINDICATOR    BOOLEAN
  , JSIPARTYINDICATOR                BOOLEAN
  , PCDPARTYINDICATOR                BOOLEAN
  , CPCPARTYINDICATOR                BOOLEAN
  , DELETEDINDICATOR                 BOOLEAN
  , ACCOUNTVISIBILITYOVERRIDEINDICATOR BOOLEAN
  , ENTERPRISEPARTYINDICATOR         BOOLEAN
  , PARTYFIRSTNAME                   VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYLASTNAME                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYFULLNAME                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , LEGALADDRESSCITYNAME             VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , LEGALADDRESSSTATECODE            VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , LEGALADDRESSCOUNTRYISOCODE       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYMIDDLENAME                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CLIENTVISIBILITYGROUPCODE        VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , ECIIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , DMECIIDENTIFIER                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , GCRCODE                          VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CASIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYTYPECODE                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PRIMARYLOBCODE                   VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , UCNIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PREFERREDLANGUAGECODE            VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYCLASSIFICATIONCODE          VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYSTATUSCODE                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , ENTERPRISECLIENTACQUISITIONCODE  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , SOURCEAPPLICATIONCODE            VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYIDENTIFIER                  LARGEINT
  , PARTYDESCRIPTIONIDENTIFIER       LARGEINT
  , SPNIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CLIENTOPENDATE                   VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYALTERNATEIDENTIFIER         VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PARTYALTERNATEIDENTIFIERTYPECODE VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , MARKETINGOPTOUTINDICATOR         BOOLEAN
  , DELETEINDICATOR                  BOOLEAN
  , CUSTOMERLIFECYCLEROLEIDENTIFIER  LARGEINT
  , PROFESSIONALADVISORINDICATOR     BOOLEAN
  , PARTYCATEGORYCODE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , EMPLDESCTEXT                     VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , DECEASEDINDICATOR                BOOLEAN
  , BIRTHDATEAPPROXIMATEINDICATOR    BOOLEAN
  , GENDERCODE                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , MARITALSTATUSCODE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , EMPLOYERNAME                     VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , MOTHERMAIDENNAME                 VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , MAIDENNAME                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PREFIXNAME                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , SUFFIXNAME                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , GENERATIONNAME                   VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CITYOFBIRTHNAME                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , COUNTRYOFBIRTHISOCODE            VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CITYOFBIRTHCODE                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PROVINCESTATECODE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , BIRTHDATEFORMATCODE              VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , USPERMANENTRESIDENTINDICATOR     BOOLEAN
  , EMPLOYMENTTYPECODE               VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , OCCUPATIONTYPECODE               VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , OCCUPATIONDESCRIPTIONTEXT        VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , DECEASEDDATE                     VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , BIRTHDATE                        VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , FORPROFITINDICATOR               BOOLEAN
  , PASSWORDTEXT                     VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , NONPROFITCHARITABLETRUSTTYPECODE VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , NONPROFITCHARITABLETRUSTSUBTYPECODE VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , NONPROFITCHARITABLEENTITYTYPECODE VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , ESTATETRUSTTYPECODE              VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INCORPORATIONCOUNTRYCODE         VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INCORPORATIONSTATECODE           VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INCORPORATIONDATE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PRIMARYKEY                       LARGEINT
  , VALID_FROM                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , VALID_TILL                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , CLIENTCOUNTRYRELATIONSHIPS       ROW(COUNTRYISO2CODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, COUNTRYPURPOSECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, PRIMARYCOUNTRYINDICATOR BOOLEAN, FROMDATE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, TODATE VARCHAR(10 BYTES) CHARACTER SET UTF8, CITYNAME
      VARCHAR(10 BYTES) CHARACTER SET UTF8, POSTALCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, PROVINCESTATECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  , CLIENTCREDITHIERARCHIES          ROW(PARTYALTERNATEIDENTIFIER VARCHAR(10
      BYTES) CHARACTER SET UTF8, PARTYALTERNATEIDENTIFIERTYPECODE VARCHAR(10
      BYTES) CHARACTER SET UTF8, PARENTPARTYALTERNATEIDENTIFIER VARCHAR(10
      BYTES) CHARACTER SET UTF8, PARENTPARTYALTERNATEIDENTIFIERTYPECODE
      VARCHAR(10 BYTES) CHARACTER SET UTF8,
      ULTIMATEPARENTPARTYALTERNATEIDENTIFIER VARCHAR(10 BYTES) CHARACTER SET
      UTF8, ULTIMATEPARENTPARTYALTERNATEIDENTIFIERTYPECODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8)
      ARRAY[25]
  , CLIENTCOUNTRYSPECIALPROCESSTYPES ROW(CREDITSPECIALPROCESSTYPECODE
      VARCHAR(10 BYTES) CHARACTER SET UTF8, "SCHEMA" VARCHAR(10 BYTES)
      CHARACTER SET UTF8) ARRAY[25]
  , CLIENTKYCRISKRATINGS             ROW(CLIENTKYCRISKRATINGCODE VARCHAR(10
      BYTES) CHARACTER SET UTF8, CLIENTKYCCOMPLETIONDATE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8)
      ARRAY[25]
  , MUNIADVISORYCOMPLIANCE           ROW(MUNIADVISORYENTITYTYPECODE VARCHAR(10
      BYTES) CHARACTER SET UTF8, ATTESTATIONCERTIFICATIONDATE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, ATTESTATIONEXPIRATIONDATE VARCHAR(10 BYTES) CHARACTER
      SET UTF8, MUNIPROCEEDSINDICATOR BOOLEAN, "SCHEMA" VARCHAR(10 BYTES)
      CHARACTER SET UTF8) ARRAY[25]
  , CLIENTALIASES                    ROW(LANGUAGECODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, PARTYALIASNAME VARCHAR(10 BYTES) CHARACTER SET UTF8,
      PARTYALIASNAMEDESCRIPTION VARCHAR(10 BYTES) CHARACTER SET UTF8,
      SOURCEAPPLICATIONCODE VARCHAR(10 BYTES) CHARACTER SET UTF8,
      PARTYALIASNAMESEQUENCE LARGEINT, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET
      UTF8) ARRAY[25]
  , CLIENTCREDITRATINGS              ROW(CREDITRATINGCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, RATINGAGENCYPARTYIDENTIFIER LARGEINT, "SCHEMA"
      VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  , CLIENTDONOTTRADEREASONS          ROW(DONOTTRADEREASONCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, DONOTTRADEEFFECTIVEDATE VARCHAR(10 BYTES) CHARACTER
      SET UTF8, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  , GOVERNMENTIDENTIFICATIONS        ROW(GOVERNMENTISSUEDIDENTIFICATION
      VARCHAR(10 BYTES) CHARACTER SET UTF8, ISSUERCOUNTRYCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, GOVERNMENTISSUEDIDDESCRIPTION VARCHAR(10 BYTES)
      CHARACTER SET UTF8, GOVERNMENTISSUEDIDTYPE VARCHAR(10 BYTES) CHARACTER
      SET UTF8, ISSUEDLOCATIONNAME VARCHAR(10 BYTES) CHARACTER SET UTF8,
      PARTYVERIFICATIONIDNUMBER LARGEINT, "SCHEMA" VARCHAR(10 BYTES) CHARACTER
      SET UTF8) ARRAY[25]
  , INDUSTRYCLASSIFICATIONS          ROW(PRIMARYINDUSTRYINDICATOR BOOLEAN,
      INDUSTRYCLASSIFICATIONTYPECODE VARCHAR(10 BYTES) CHARACTER SET UTF8,
      INDUSTRYCLASSIFICATIONSCHEMEIDENTIFIER INT,
      INDUSTRYCLASSICATIONCATEGORYIDENTIFIER LARGEINT, "SCHEMA" VARCHAR(10
      BYTES) CHARACTER SET UTF8) ARRAY[25]
  , CLIENTMARKETINGBRANCHES          ROW(MARKETINGBRANCHIDENTIFIER LARGEINT,
      "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  , CLIENTALTERNATENAMES             ROW(BUSINESSSYSTEMCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, NAMEPURPOSETYPECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, NAMETYPECODE VARCHAR(10 BYTES) CHARACTER SET UTF8, PARTYNAME
      VARCHAR(10 BYTES) CHARACTER SET UTF8, CONFIDENTIALNAMEINDICATOR BOOLEAN,
      SOURCEAPPLICATIONCODE VARCHAR(10 BYTES) CHARACTER SET UTF8,
      NAMEDESCRIPTIONTEXT VARCHAR(10 BYTES) CHARACTER SET UTF8, "SCHEMA"
      VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  , DATA_GROUP                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , BRANCHIDENTIFIER                 LARGEINT
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl party;

/* Hive DDL */
CREATE EXTERNAL TABLE HIVE.TEST061.PARTY
  (
    "SCHEMA"                         string
  , GWMIDENTIFIER                    string
  , UPDATETIMESTAMP                  string
  , UPDATEUSERIDENTIFIER             string
  , CLIENTONLINEENROLLMENTINDICATOR  boolean
  , INSIDERINDICATOR                 boolean
  , JPMCAFFILIATEINDICATOR           boolean
  , BADADDRESSINDICATOR              boolean
  , PEPINDICATOR                     boolean
  , GWMACTIVEACCOUNTINDICATOR        boolean
  , CLIENTSEGMENTCODE                string
  , CLIENTTICKERCODE                 string
  , OVERALLDONOTTRADECODE            string
  , EMPLOYEESTANDARDIDENTIFIER       string
  , HOUSEHOLDCLIENTCLASSIFICATIONCODE string
  , INSIDERCODE                      string
  , ENTERPRISECUSTOMERSUBTYPECODE    string
  , ENTERPRISECLIENTSENSITIVEINDICATOR string
  , AMLCUSTOMERTYPECODE              string
  , LEIRECERTIFICATIONDATE           string
  , LEIIDENTIFIER                    string
  , JPMCLEGALENTITYCODE              string
  , JPMCFIDUCIARYAGENTCODE           string
  , TRUSTCREATORNAME                 string
  , JPMCACCOUNTCONTROLLERROLEID      bigint
  , JPMCCLIENTCONTROLLERROLEID       bigint
  , PBPARTYINDICATOR                 boolean
  , PCSPARTYINDICATOR                boolean
  , HIGHLYSENSITIVEINDICATOR         boolean
  , CLIENTEMPLOYEEINDICATOR          boolean
  , PARTYACTIVEINDICATOR             boolean
  , CONFIDENTIALNAMEINDICATOR        boolean
  , ULTRAHIGHLYSENSITIVEINDICATOR    boolean
  , JSIPARTYINDICATOR                boolean
  , PCDPARTYINDICATOR                boolean
  , CPCPARTYINDICATOR                boolean
  , DELETEDINDICATOR                 boolean
  , ACCOUNTVISIBILITYOVERRIDEINDICATOR boolean
  , ENTERPRISEPARTYINDICATOR         boolean
  , PARTYFIRSTNAME                   string
  , PARTYLASTNAME                    string
  , PARTYFULLNAME                    string
  , LEGALADDRESSCITYNAME             string
  , LEGALADDRESSSTATECODE            string
  , LEGALADDRESSCOUNTRYISOCODE       string
  , PARTYMIDDLENAME                  string
  , CLIENTVISIBILITYGROUPCODE        string
  , ECIIDENTIFIER                    string
  , DMECIIDENTIFIER                  string
  , GCRCODE                          string
  , CASIDENTIFIER                    string
  , PARTYTYPECODE                    string
  , PRIMARYLOBCODE                   string
  , UCNIDENTIFIER                    string
  , PREFERREDLANGUAGECODE            string
  , PARTYCLASSIFICATIONCODE          string
  , PARTYSTATUSCODE                  string
  , ENTERPRISECLIENTACQUISITIONCODE  string
  , SOURCEAPPLICATIONCODE            string
  , PARTYIDENTIFIER                  bigint
  , PARTYDESCRIPTIONIDENTIFIER       bigint
  , SPNIDENTIFIER                    string
  , CLIENTOPENDATE                   string
  , PARTYALTERNATEIDENTIFIER         string
  , PARTYALTERNATEIDENTIFIERTYPECODE string
  , MARKETINGOPTOUTINDICATOR         boolean
  , DELETEINDICATOR                  boolean
  , CUSTOMERLIFECYCLEROLEIDENTIFIER  bigint
  , PROFESSIONALADVISORINDICATOR     boolean
  , PARTYCATEGORYCODE                string
  , EMPLDESCTEXT                     string
  , DECEASEDINDICATOR                boolean
  , BIRTHDATEAPPROXIMATEINDICATOR    boolean
  , GENDERCODE                       string
  , MARITALSTATUSCODE                string
  , EMPLOYERNAME                     string
  , MOTHERMAIDENNAME                 string
  , MAIDENNAME                       string
  , PREFIXNAME                       string
  , SUFFIXNAME                       string
  , GENERATIONNAME                   string
  , CITYOFBIRTHNAME                  string
  , COUNTRYOFBIRTHISOCODE            string
  , CITYOFBIRTHCODE                  string
  , PROVINCESTATECODE                string
  , BIRTHDATEFORMATCODE              string
  , USPERMANENTRESIDENTINDICATOR     boolean
  , EMPLOYMENTTYPECODE               string
  , OCCUPATIONTYPECODE               string
  , OCCUPATIONDESCRIPTIONTEXT        string
  , DECEASEDDATE                     string
  , BIRTHDATE                        string
  , FORPROFITINDICATOR               boolean
  , PASSWORDTEXT                     string
  , NONPROFITCHARITABLETRUSTTYPECODE string
  , NONPROFITCHARITABLETRUSTSUBTYPECODE string
  , NONPROFITCHARITABLEENTITYTYPECODE string
  , ESTATETRUSTTYPECODE              string
  , INCORPORATIONCOUNTRYCODE         string
  , INCORPORATIONSTATECODE           string
  , INCORPORATIONDATE                string
  , PRIMARYKEY                       bigint
  , VALID_FROM                       string
  , VALID_TILL                       string
  , CLIENTCOUNTRYRELATIONSHIPS      
      array<struct<countryiso2code:string,countrypurposecode:string,primarycountryindicator:boolean,fromdate:string,todate:string,cityname:string,postalcode:string,provincestatecode:string,schema:string>>
  , CLIENTCREDITHIERARCHIES         
      array<struct<partyalternateidentifier:string,partyalternateidentifiertypecode:string,parentpartyalternateidentifier:string,parentpartyalternateidentifiertypecode:string,ultimateparentpartyalternateidentifier:string,ultimateparentpartyalternateidentifiertypecode:string,schema:string>>
  , CLIENTCOUNTRYSPECIALPROCESSTYPES
      array<struct<creditspecialprocesstypecode:string,schema:string>>
  , CLIENTKYCRISKRATINGS            
      array<struct<clientkycriskratingcode:string,clientkyccompletiondate:string,schema:string>>
  , MUNIADVISORYCOMPLIANCE          
      array<struct<muniadvisoryentitytypecode:string,attestationcertificationdate:string,attestationexpirationdate:string,muniproceedsindicator:boolean,schema:string>>
  , CLIENTALIASES                   
      array<struct<languagecode:string,partyaliasname:string,partyaliasnamedescription:string,sourceapplicationcode:string,partyaliasnamesequence:bigint,schema:string>>
  , CLIENTCREDITRATINGS             
      array<struct<creditratingcode:string,ratingagencypartyidentifier:bigint,schema:string>>
  , CLIENTDONOTTRADEREASONS         
      array<struct<donottradereasoncode:string,donottradeeffectivedate:string,schema:string>>
  , GOVERNMENTIDENTIFICATIONS       
      array<struct<governmentissuedidentification:string,issuercountrycode:string,governmentissuediddescription:string,governmentissuedidtype:string,issuedlocationname:string,partyverificationidnumber:bigint,schema:string>>
  , INDUSTRYCLASSIFICATIONS         
      array<struct<primaryindustryindicator:boolean,industryclassificationtypecode:string,industryclassificationschemeidentifier:int,industryclassicationcategoryidentifier:bigint,schema:string>>
  , CLIENTMARKETINGBRANCHES         
      array<struct<marketingbranchidentifier:bigint,schema:string>>
  , CLIENTALTERNATENAMES            
      array<struct<businesssystemcode:string,namepurposetypecode:string,nametypecode:string,partyname:string,confidentialnameindicator:boolean,sourceapplicationcode:string,namedescriptiontext:string,schema:string>>
  )
  PARTITIONED BY (DATA_GROUP string,BRANCHIDENTIFIER bigint)
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.PARTY;
/* ObjectUID = 502337118715934023 */

--- SQL operation complete.
>>select * from party;

--- 0 row(s) selected.
>>select clientcountryrelationships[10].countryPurposeCode from party;

--- 0 row(s) selected.
>>
>>drop table if exists hive.test061.party2;

--- SQL operation complete.
>>CREATE EXTERNAL TABLE hive.test061.`party2`(                     
+>   `schema` string,                                 
+>   `gwmidentifier` string,                          
+>   `insiderindicator` boolean,                      
+>   `incorporationstatecode` string,                 
+>   `incorporationdate` string,                      
+>   `primarykey` bigint,                             
+>   `clientcountryrelationships` array<struct<countryISO2Code:string,countryPurposeCode:string,primaryCountryIndicator:boolean,fromDate:string,toDate:string,cityName:string,postalCode:string,provinceStateCode:string,schema:string>> 
+>--   `governmentidentifications` array<struct<governmentIssuedIdentification:string,issuerCountryCode:string,governmentIssuedIdDescription:string,governmentIssuedIdType:string,issuedLocationName:string,partyVerificationIdNumber:bigint,schema:string>>,  
+>--   `industryclassifications` array<struct<primaryIndustryIndicator:boolean,industryClassificationTypeCode:string,industryClassificationSchemeIdentifier:int,industryClassicationCategoryIdentifier:bigint,schema:string>>
+>)
+>stored as parquet;

--- SQL operation complete.
>>
>>truncate table party2;

--- SQL operation complete.
>>sh echo "insert into test061.party2 select 'abc','de',true,'xyzz','today', 100, array(named_struct('countryISO2Code','ind','countrypurposecode','ab', 'primarycountryindicator', true, 'fromdate','2001-01-01', 'toDate', '2018-01-01', 'cityName', 'milpitas', 'postalcode', '94111', 'provincestatecode', 'CA', 'schema', 'sch')) from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>invoke party2;

-- Definition of hive table HIVE.TEST061.PARTY2
-- Definition current  Mon Feb 25 22:19:33 2019

  (
    "SCHEMA"                         VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , GWMIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INSIDERINDICATOR                 BOOLEAN
  , INCORPORATIONSTATECODE           VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INCORPORATIONDATE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PRIMARYKEY                       LARGEINT
  , CLIENTCOUNTRYRELATIONSHIPS       ROW(COUNTRYISO2CODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, COUNTRYPURPOSECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, PRIMARYCOUNTRYINDICATOR BOOLEAN, FROMDATE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, TODATE VARCHAR(10 BYTES) CHARACTER SET UTF8, CITYNAME
      VARCHAR(10 BYTES) CHARACTER SET UTF8, POSTALCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, PROVINCESTATECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl party2;

/* Hive DDL */
CREATE EXTERNAL TABLE HIVE.TEST061.PARTY2
  (
    "SCHEMA"                         string
  , GWMIDENTIFIER                    string
  , INSIDERINDICATOR                 boolean
  , INCORPORATIONSTATECODE           string
  , INCORPORATIONDATE                string
  , PRIMARYKEY                       bigint
  , CLIENTCOUNTRYRELATIONSHIPS      
      array<struct<countryiso2code:string,countrypurposecode:string,primarycountryindicator:boolean,fromdate:string,todate:string,cityname:string,postalcode:string,provincestatecode:string,schema:string>>
  )
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.PARTY2;
/* ObjectUID = 502337118715934401 */

--- SQL operation complete.
>>select * from party2;

SCHEMA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    GWMIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             INSIDERINDICATOR  INCORPORATIONSTATECODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    INCORPORATIONDATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         PRIMARYKEY            CLIENTCOUNTRYRELATIONSHIPS
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       de                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        TRUE              xyzz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      today                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      100  [(ind,ab,TRUE,2001-01-01,2018-01-01,milpitas,94111,CA,sch)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    

--- 1 row(s) selected.
>>select clientcountryrelationships[1].countryPurposeCode from party2;

COUNTRYPURPOSECODE
------------------

ab                

--- 1 row(s) selected.
>>
>>drop table if exists hive.test061.party3;

--- SQL operation complete.
>>CREATE TABLE hive.test061.`party3`(                     
+>   `schema` string,                                 
+>   `gwmidentifier` string,                          
+>   `insiderindicator` boolean,                      
+>   `incorporationstatecode` string,                 
+>   `incorporationdate` string,                      
+>   `primarykey` bigint,                             
+>   `clientcountryrelationships` array<struct<countryISO2Code:string,countryPurposeCode:string,primaryCountryIndicator:boolean,fromDate:string,toDate:string,cityName:string,postalCode:string,provinceStateCode:string,schema:string>> 
+>)
+> PARTITIONED BY (                                   
+>   `branchidentifier` bigint)                       
+>stored as parquet;

--- SQL operation complete.
>>truncate table party3;

--- SQL operation complete.
>>
>>sh echo "insert into test061.party3 partition (branchidentifier = 100) select 'abc','de',true,'xyzz','today', 100, array(named_struct('countryISO2Code','ind','countrypurposecode','ab', 'primarycountryindicator', true, 'fromdate','2001-01-01', 'toDate', '2018-01-01', 'cityName', 'milpitas', 'postalcode', '94111', 'provincestatecode', 'CA', 'schema', 'sch')) from test061.t061dummy;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>invoke party3;

-- Definition of hive table HIVE.TEST061.PARTY3
-- Definition current  Mon Feb 25 22:19:55 2019

  (
    "SCHEMA"                         VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , GWMIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INSIDERINDICATOR                 BOOLEAN
  , INCORPORATIONSTATECODE           VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , INCORPORATIONDATE                VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT
  , PRIMARYKEY                       LARGEINT
  , CLIENTCOUNTRYRELATIONSHIPS       ROW(COUNTRYISO2CODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, COUNTRYPURPOSECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, PRIMARYCOUNTRYINDICATOR BOOLEAN, FROMDATE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, TODATE VARCHAR(10 BYTES) CHARACTER SET UTF8, CITYNAME
      VARCHAR(10 BYTES) CHARACTER SET UTF8, POSTALCODE VARCHAR(10 BYTES)
      CHARACTER SET UTF8, PROVINCESTATECODE VARCHAR(10 BYTES) CHARACTER SET
      UTF8, "SCHEMA" VARCHAR(10 BYTES) CHARACTER SET UTF8) ARRAY[25]
  , BRANCHIDENTIFIER                 LARGEINT
  )
  /* stored as parquet */

--- SQL operation complete.
>>showddl party3;

/* Hive DDL */
CREATE TABLE HIVE.TEST061.PARTY3
  (
    "SCHEMA"                         string
  , GWMIDENTIFIER                    string
  , INSIDERINDICATOR                 boolean
  , INCORPORATIONSTATECODE           string
  , INCORPORATIONDATE                string
  , PRIMARYKEY                       bigint
  , CLIENTCOUNTRYRELATIONSHIPS      
      array<struct<countryiso2code:string,countrypurposecode:string,primarycountryindicator:boolean,fromdate:string,todate:string,cityname:string,postalcode:string,provincestatecode:string,schema:string>>
  )
  PARTITIONED BY (BRANCHIDENTIFIER bigint)
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.TEST061.PARTY3;
/* ObjectUID = 502337118715936670 */

--- SQL operation complete.
>>select * from party3;

SCHEMA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    GWMIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             INSIDERINDICATOR  INCORPORATIONSTATECODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    INCORPORATIONDATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         PRIMARYKEY            CLIENTCOUNTRYRELATIONSHIPS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       BRANCHIDENTIFIER
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------

abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       de                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        TRUE              xyzz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      today                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      100  [(ind,ab,TRUE,2001-01-01,2018-01-01,milpitas,94111,CA,sch)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100

--- 1 row(s) selected.
>>select clientcountryrelationships[1].countryPurposeCode from party3;

COUNTRYPURPOSECODE
------------------

ab                

--- 1 row(s) selected.
>>
>>-- table PARTYADDRESS
>>create database if not exists hive.db_gwm_morph_mcd;

--- SQL operation complete.
>>set schema hive.db_gwm_morph_mcd;

--- SQL operation complete.
>>drop table if exists partyaddress;

--- SQL operation complete.
>>sh regrhadoop.ksh fs -rm -r /user/hive/warehouse/db_gwm_morph_mcd.db/partyaddress;
>>CREATE EXTERNAL TABLE `partyaddress`(              
+>   `schema` string,                                 
+>   `gwmidentifier` string,                          
+>   `primarykey` bigint,                             
+>   `updatetimestamp` string,                        
+>   `record_update_dt` string,                        
+>   `updateuseridentifier` string,                   
+>   `valid_from` string,                             
+>   `valid_till` string,                             
+>   `clientaddresses` array<struct<callbackIndicator:boolean,confidentialAddressIndicator:boolean,mailingAddressIndicator:boolean,preferredAddressIndicator:boolean,addressCommentsText:string,addressIdentifier:bigint,addressPurposeTypeIdentifier:bigint,addressEffectiveDate:string,addressEndDate:string,taxJurisdictionCode:string,enterpriseAddressIndicator:boolean,enterprisePrimaryAddressIndicator:boolean,sourceApplicationCode:string,partyIdentifier:bigint,addressTypeIdentifier:bigint,websiteAddress:string,countryISO2Code:string,phoneExtensionAddress:string,nonNANPIndicator:boolean,internationalDialingCode:string,formattedPhoneNumberAddress:string,unconvertedPhoneNumberAddress:string,unformattedPhoneNumberAddress:string,internationalIndicator:boolean,formattedAddressIndicator:boolean,cityName:string,countryName:string,stateName:string,stateCode:string,line1Address:string,line2Address:string,line3Address:string,line4Address:string,line5Address:string,line6Address:string,postalCode:string,mailingCompanyName:string,addressLastName:string,mailingTitleName:string,mailingSalutationText:string,provinceStateCode:string,addressFirstName:string,mailingLabelText:string,emailAddress:string,addressTypeName:string,addressPurposeName:string,schema:string>>) 
+> PARTITIONED BY (                                   
+>   `data_group` string,                             
+>   `branchidentifier` bigint)    
+>stored as parquet;

--- SQL operation complete.
>>truncate table partyaddress;

--- SQL operation complete.
>>select * from partyaddress;

--- 0 row(s) selected.
>>
>>-- Query 1
>>select gwmidentifier,branchidentifier,valid_from,record_update_dt,addr.emailaddress,data_group from partyaddress as p lateral view outer unnest(clientaddresses) addr 
+> where  addr.emailaddress like '%@%' order by gwmidentifier,branchidentifier;

--- 0 row(s) selected.
>>
>>select gwmidentifier,branchidentifier,valid_from,record_update_dt,
+>       clientaddresses[1].emailaddress,data_group 
+> from partyaddress
+> where clientaddresses[1].emailaddress like '%@%' 
+>  order by gwmidentifier,branchidentifier;

--- 0 row(s) selected.
>>
>>-- Query 2
>>select data_group, addr.emailaddress,gwmidentifier,branchidentifier, valid_from, record_update_Dt from partyaddress as p lateral view outer unnest(clientaddresses) addr 
+>where gwmidentifier in ('test3456','test1234' ) and branchidentifier =10 order by gwmidentifier;

--- 0 row(s) selected.
>>
>>select data_group, clientaddresses[1].emailaddress,
+>  gwmidentifier,branchidentifier, valid_from, record_update_dt
+>  from partyaddress 
+>  where gwmidentifier in ('test3456','test1234' ) and branchidentifier =10 
+>  order by gwmidentifier;

--- 0 row(s) selected.
>>
>>-- Query 3
>>select distinct a.gwmidentifier,a.branchidentifier,a.valid_from,a.valid_till,a.record_update_dt, a.emailaddress, a.data_group,a.updatetimestamp,b.updatetimestamp,b.record_update_dt 
+>from  
+> (select c.gwmidentifier,c.branchidentifier,c.valid_from,c.valid_till,c.record_update_dt, c.data_group,c.updatetimestamp, addr.* from db_gwm_morph_mcd.partyaddress as c lateral view outer unnest(clientaddresses) addr where data_group='history') a 
+>inner join  
+> (select distinct gwmidentifier,branchidentifier,record_update_dt,updatetimestamp from db_gwm_morph_mcd.partyaddress as p lateral view outer unnest(clientaddresses) addr where data_group='latest' and addr.emailaddress like '%@%') b 
+>on
+> a.gwmidentifier=b.gwmidentifier and a.branchidentifier = b.branchidentifier and b.updatetimestamp > a.updatetimestamp and b.record_update_dt < a.record_update_dt order by a.gwmidentifier, a.branchidentifier ;

--- 0 row(s) selected.
>>
>>drop external table if exists partyaddress2 for hive.db_gwm_morph_mcd.partyaddress2;

--- SQL operation complete.
>>drop table if exists partyaddress2;

--- SQL operation complete.
>>
>>sh regrhadoop.ksh fs -rm -r /user/hive/warehouse/db_gwm_morph_mcd.db/partyaddress2;
>>CREATE EXTERNAL TABLE `partyaddress2`(              
+>   `schema` string,                                 
+>   `gwmidentifier` string,                          
+>   `primarykey` bigint,                             
+>   `updatetimestamp` string,                        
+>   `record_update_dt` string,                        
+>   `updateuseridentifier` string,                   
+>   `valid_from` string,                             
+>   `valid_till` string,                             
+>   `clientaddresses` array<struct<callbackIndicator:boolean,emailAddress:string,addressTypeName:string,schema:string>>) 
+> PARTITIONED BY (                                   
+>   `data_group` string,                             
+>   `branchidentifier` bigint)    
+>stored as parquet;

--- SQL operation complete.
>>truncate table partyaddress2;

--- SQL operation complete.
>>
>>sh echo "insert into db_gwm_morph_mcd.partyaddress2 partition(data_group = 'abc', branchidentifier = 100) select 'abc', 'id12', 100, '2018-01-01 10:10:10', '2018-01-01', 'uid34', 'x', 'y', array(named_struct('callbackIndicator', true, 'emailAddress', 'someone@somewhere.com', 'addressTypeName', 'residential', 'schema', 'sch')) from test061.t061dummy ;" > TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>select * from partyaddress2;

SCHEMA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    GWMIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             PRIMARYKEY            UPDATETIMESTAMP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           RECORD_UPDATE_DT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          UPDATEUSERIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      VALID_FROM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                VALID_TILL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CLIENTADDRESSES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         DATA_GROUP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                BRANCHIDENTIFIER
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------

abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  2018-01-01 10:10:10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                uid34                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         y                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         [(TRUE,someone@so,residentia,sch)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        100

--- 1 row(s) selected.
>>
>>select distinct a.gwmidentifier,a.branchidentifier,a.valid_from,a.valid_till,a.record_update_dt, a.clientaddresses[1].emailaddress, a.data_group,a.updatetimestamp,b.updatetimestamp,b.record_update_dt 
+>from  
+> (select c.gwmidentifier,c.branchidentifier,c.valid_from,c.valid_till,c.record_update_dt, c.data_group,c.updatetimestamp, 
+>   clientaddresses
+>   from db_gwm_morph_mcd.partyaddress2 c where data_group='history') a 
+>inner join  
+> (select distinct gwmidentifier,branchidentifier,record_update_dt,updatetimestamp from db_gwm_morph_mcd.partyaddress2  
+>  where data_group='latest' and clientaddresses[1].emailaddress like '%@%') b 
+>on
+> a.gwmidentifier=b.gwmidentifier and a.branchidentifier = b.branchidentifier and b.updatetimestamp > a.updatetimestamp and b.record_update_dt < a.record_update_dt order by a.gwmidentifier, a.branchidentifier ;

--- 0 row(s) selected.
>>
>>-- should return error
>>create external table partyaddress2(clientaddresses row(a int) array[10]) for hive.db_gwm_morph_mcd.partyaddress2;

*** ERROR[3242] This statement is not supported. Reason: Cannot specify explicit external attributes for composite column CLIENTADDRESSES.

--- SQL operation failed with errors.
>>
>>create external table partyaddress2("SCHEMA" char(10)) for hive.db_gwm_morph_mcd.partyaddress2;

--- SQL operation complete.
>>showddl partyaddress2;

/* Hive DDL */
CREATE EXTERNAL TABLE HIVE.DB_GWM_MORPH_MCD.PARTYADDRESS2
  (
    "SCHEMA"                         string
  , GWMIDENTIFIER                    string
  , PRIMARYKEY                       bigint
  , UPDATETIMESTAMP                  string
  , RECORD_UPDATE_DT                 string
  , UPDATEUSERIDENTIFIER             string
  , VALID_FROM                       string
  , VALID_TILL                       string
  , CLIENTADDRESSES                 
      array<struct<callbackindicator:boolean,emailaddress:string,addresstypename:string,schema:string>>
  )
  PARTITIONED BY (DATA_GROUP string,BRANCHIDENTIFIER bigint)
  stored as parquet
;

/* Trafodion DDL */

REGISTER /*INTERNAL*/ HIVE TABLE HIVE.DB_GWM_MORPH_MCD.PARTYADDRESS2;
/* ObjectUID = 502337118715940330 */

CREATE EXTERNAL TABLE PARTYADDRESS2
  (
    "SCHEMA"                         CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , GWMIDENTIFIER                    VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , PRIMARYKEY                       LARGEINT DEFAULT NULL
  , UPDATETIMESTAMP                  VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , RECORD_UPDATE_DT                 VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , UPDATEUSERIDENTIFIER             VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , VALID_FROM                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , VALID_TILL                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , CLIENTADDRESSES                  ROW(CALLBACKINDICATOR BOOLEAN,
      EMAILADDRESS VARCHAR(10 BYTES) CHARACTER SET UTF8, ADDRESSTYPENAME
      VARCHAR(10 BYTES) CHARACTER SET UTF8, "SCHEMA" VARCHAR(10 BYTES)
      CHARACTER SET UTF8) ARRAY[25] DEFAULT NULL
  , DATA_GROUP                       VARCHAR(1000 BYTES) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , BRANCHIDENTIFIER                 LARGEINT DEFAULT NULL
  )
  FOR HIVE.DB_GWM_MORPH_MCD.PARTYADDRESS2
;

--- SQL operation complete.
>>select * from partyaddress2;

SCHEMA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    GWMIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             PRIMARYKEY            UPDATETIMESTAMP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           RECORD_UPDATE_DT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          UPDATEUSERIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      VALID_FROM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                VALID_TILL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CLIENTADDRESSES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         DATA_GROUP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                BRANCHIDENTIFIER
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------

abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  2018-01-01 10:10:10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                uid34                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         y                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         [(TRUE,someone@so,residentia,sch)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        100

--- 1 row(s) selected.
>>
>>
>>-- test for lateral outer 
>>drop external table if exists partyaddress3 for hive.db_gwm_morph_mcd.partyaddress3;

--- SQL operation complete.
>>drop table if exists partyaddress3;

--- SQL operation complete.
>>
>>CREATE TABLE `partyaddress3`(
+>  `schema` string,
+>  `gwmidentifier` string,
+>  `primarykey` bigint,
+>  `updatetimestamp` string,
+>  `record_update_dt` string,
+>  `updateuseridentifier` string,
+>  `valid_from` string,
+>  `valid_till` string,
+>  `clientaddresses` array<struct<callbackindicator:boolean,confidentialaddressindicator:boolean,mailingaddressindicator:boolean,preferredaddressindicator:boolean,addresscommentstext:string,addressidentifier:int,addresspurposetypeidentifier:int,addresseffectivedate:string,addressenddate:string,taxjurisdictioncode:string,enterpriseaddressindicator:boolean,enterpriseprimaryaddressindicator:boolean,sourceapplicationcode:string,partyidentifier:int,addresstypeidentifier:int,websiteaddress:string,countryiso2code:string,phoneextensionaddress:string,nonnanpindicator:boolean,internationaldialingcode:string,formattedphonenumberaddress:string,unconvertedphonenumberaddress:string,unformattedphonenumberaddress:string,internationalindicator:boolean,formattedaddressindicator:boolean,cityname:string,countryname:string,statename:string,statecode:string,line1address:string,line2address:string,line3address:string,line4address:string,line5address:string,line6address:string,postalcode:string,mailingcompanyname:string,addresslastname:string,mailingtitlename:string,mailingsalutationtext:string,provincestatecode:string,addressfirstname:string,mailinglabeltext:string,emailaddress:string,addresstypename:string,addresspurposename:string,schema:string>>)
+>PARTITIONED BY (
+>  `data_group` string,
+>  `branchidentifier` bigint)
+>  stored as parquet ;

--- SQL operation complete.
>>
>>
>>sh echo "insert into db_gwm_morph_mcd.partyaddress3 partition(data_group = 'abc', branchidentifier = 100) select 'abc', 'id12', 100, '2018-01-01 10:10:10', '2018-01-01', 'uid34', 'x', 'y', array(named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello')) from test061.t061dummy ;" > TEST061_junk;
>>
>>sh echo "insert into db_gwm_morph_mcd.partyaddress3 partition(data_group = 'abc', branchidentifier = 10) select 'abc', 'test1234', 100, '2018-01-01 10:10:10', '2018-01-01', 'uid34', 'x', 'y', array(named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello')) from test061.t061dummy ;" >> TEST061_junk;
>>
>>sh echo "insert into db_gwm_morph_mcd.partyaddress3 partition(data_group = 'abcd', branchidentifier = 10) select 'abc', 'test3456', 100, '2018-01-01 10:10:10', '2018-01-01', 'uid34', 'x', 'y', array(named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello'),named_struct('callbackindicator', true, 'confidentialaddressindicator',  true , 'mailingaddressindicator', true, 'preferredaddressindicator', true, 'addresscommentstext', 'none' , 'addressidentifier', 1 , 'addresspurposetypeidentifier', 1 , 'addresseffectivedate', '01-01-2018', 'addressenddate', '01-01-2019', 'taxjurisdictioncode',  'TX' ,'enterpriseaddressindicator', true, 'enterpriseprimaryaddressindicator', true,'sourceapplicationcode', 'hello' ,'partyidentifier', 1,'addresstypeidentifier', 1,'websiteaddress', 'http://www.yahoo.com','countryiso2Code', 'hello','phoneextensionaddress', 'hello','nonnanpindicator',true,'internationaldialingcode', 'hello','formattedphonenumberaddress', 'hello','unconvertedphonenumberaddress', 'hello','unformattedphonenumberaddress', 'hello','internationalindicator',true,'formattedaddressindicator',true,'cityname', 'hello','countryname', 'hello','statename', 'hello','statecode', 'hello','line1address', 'hello','line2address', 'hello','line3address', 'hello','line4address', 'hello','line5address', 'hello','line6address', 'hello','postalcode', 'hello','mailingcompanyname', 'hello','addresslastname', 'hello','mailingtitlename', 'hello','mailingsalutationtext', 'hello','provincestatecode', 'hello','addressfirstname', 'hello','mailinglabeltext', 'hello','emailaddress', 'someone@yahoo.com','addresstypename', 'hello','addresspurposename', 'hello','schema', 'hello')) from test061.t061dummy ;" >> TEST061_junk;
>>sh regrhive.ksh -f TEST061_junk;
>>
>>select gwmidentifier,branchidentifier,valid_from,record_update_dt,addr.emailaddress,data_group from partyaddress3 lateral view outer unnest(clientaddresses) addr 
+> where  addr.emailaddress like '%@%' order by gwmidentifier,branchidentifier;

GWMIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             BRANCHIDENTIFIER      VALID_FROM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                RECORD_UPDATE_DT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          EMAILADDRESS  DATA_GROUP
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
id12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       100  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                someone@ya    abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    

--- 24 row(s) selected.
>>
>>select data_group, addr.emailaddress,gwmidentifier,branchidentifier, valid_from, record_update_Dt from partyaddress3 lateral view outer unnest(clientaddresses) addr 
+>where gwmidentifier in ('test3456','test1234' ) and branchidentifier =10 order by gwmidentifier;

DATA_GROUP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                EMAILADDRESS  GWMIDENTIFIER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             BRANCHIDENTIFIER      VALID_FROM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                RECORD_UPDATE_DT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       someone@ya    test1234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
abcd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      someone@ya    test3456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    10  x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2018-01-01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              

--- 16 row(s) selected.
>>
>>
>>log;
