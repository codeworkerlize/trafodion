>>obey TEST202(setup);
>>create schema locktest202;

--- SQL operation complete.
>>set schema locktest202;

--- SQL operation complete.
>>
>>obey TEST202(M11994);
>>-- Mantis 11994
>>create table table_pk(a int not null primary key);

--- SQL operation complete.
>>create table table_fk(a int, b int, foreign key(a) references table_pk(a));

--- SQL operation complete.
>>insert into table_pk values(1);

--- 1 row(s) inserted.
>>begin work;

--- SQL operation complete.
>>insert into table_fk values(1,1);

--- 1 row(s) inserted.
>>sh sqlci -i TEST202\(M11994_1\) >> LOG202;
EsgynDB Advanced Conversational Interface 2.7.0
Copyright (c) 2015-2019 Esgyn Corporation
>>?section M11994_1
>>set schema locktest202;

--- SQL operation complete.
>>begin work;

--- SQL operation complete.
>>insert into table_fk values(1,1);

--- 1 row(s) inserted.
>>commit;

--- SQL operation complete.
>>
>>exit;

End of MXCI Session

>>commit;

--- SQL operation complete.
>>select * from table_fk;

A            B          
-----------  -----------

          1            1
          1            1

--- 2 row(s) selected.
>>
>>obey TEST202(M12012);
>>CREATE TABLE dept_fk (deptno DECIMAL(2) not null primary key, dname VARCHAR(14),loc VARCHAR(13));

--- SQL operation complete.
>>INSERT INTO dept_fk VALUES(10, 'ACCOUNTING', 'NEW YORK');

--- 1 row(s) inserted.
>>INSERT INTO dept_fk VALUES(20, 'RESEARCH', 'DALLAS');

--- 1 row(s) inserted.
>>create table emp_fk(employeeno DECIMAL(4), ename VARCHAR(10), deptno DECIMAL(2) references dept_fk(deptno));

--- SQL operation complete.
>>INSERT INTO emp_fk VALUES(7369, 'SMITH', 20);

--- 1 row(s) inserted.
>>
>>begin work;

--- SQL operation complete.
>>insert into emp_fk values(7370, 'TOM', 10);

--- 1 row(s) inserted.
>>sh sqlci -i TEST202\(M12012_1\) >> LOG202;
EsgynDB Advanced Conversational Interface 2.7.0
Copyright (c) 2015-2019 Esgyn Corporation
>>?section M12012_1
>>set schema locktest202;

--- SQL operation complete.
>>delete from dept_fk where deptno = 10;

*** ERROR[30052] ROW LEVEL LOCK TIMEOUT ERROR

--- 0 row(s) deleted.
>>
>>exit;

End of MXCI Session

>>rollback;

--- SQL operation complete.
>>
>>begin work;

--- SQL operation complete.
>>delete from dept_fk where deptno = 10;

--- 1 row(s) deleted.
>>sh sqlci -i TEST202\(M12012_2\) >> LOG202;
EsgynDB Advanced Conversational Interface 2.7.0
Copyright (c) 2015-2019 Esgyn Corporation
>>?section M12012_2
>>set schema locktest202;

--- SQL operation complete.
>>insert into emp_fk values(7370, 'TOM', 10);

*** ERROR[30052] ROW LEVEL LOCK TIMEOUT ERROR

--- 0 row(s) inserted.
>>
>>exit;

End of MXCI Session

>>rollback;

--- SQL operation complete.
>>
>>obey TEST202(M12769);
>>set schema locktest202;

--- SQL operation complete.
>>CREATE TABLE employee(employeeno DECIMAL(4) NOT NULL primary key, ename VARCHAR(10), job VARCHAR(9), mgr DECIMAL(4), hiredate DATE, sal DECIMAL(7, 2), comm DECIMAL(7, 2), deptno DECIMAL(2))
+>hbase_options
+>(
+>  data_block_encoding = 'fast_diff',
+>  compression = 'snappy',
+>  memstore_flush_size = '1073741824'
+>);

--- SQL operation complete.
>>INSERT INTO employee VALUES(7369, 'SMITH', 'CLERK', 7902, DATE '1980-12-17', 800, NULL, 20);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7499, 'ALLEN', 'SALESMAN', 7698, DATE '1981-02-20', 1600, 300, 30);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7521, 'WARD', 'SALESMAN', 7698, DATE '1981-02-22', 1250, 500, 30);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7566, 'JONES', 'MANAGER', 7839, DATE '1981-04-02', 2975, NULL, 20);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7654, 'MARTIN', 'SALESMAN', 7698, DATE '1981-09-28', 1250, 1400, 30);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7698, 'BLAKE', 'MANAGER', 7839, DATE '1981-05-01', 2850, NULL, 30);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7782, 'CLARK', 'MANAGER', 7839, DATE '1981-07-09', 2450, NULL, 10);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7788, 'TAC-MD', 'ANALYST', 7566, DATE '1982-12-09', 3000, NULL, 20);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7839, 'KING', 'PRESIDENT', 7788, DATE '1981-11-17', 5000, NULL, 10);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7844, 'TURNER', 'SALESMAN', 7698, DATE '1981-09-08', 1500, 0, 30);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7876, 'ADAMS', 'CLERK', 7788, DATE '1983-01-12', 1100, NULL, 20);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7900, 'JAMES', 'CLERK', 7698, DATE '1981-12-03', 950, NULL, 30);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7902, 'FORD', 'ANALYST', 7566, DATE '1981-12-03', 3000, NULL, 20);

--- 1 row(s) inserted.
>>INSERT INTO employee VALUES(7934, 'MILLER', 'CLERK', 7782, DATE '1982-01-23', 1300, NULL, 10);

--- 1 row(s) inserted.
>>
>>create index employee_index on employee(employeeno);

--- SQL operation complete.
>>
>>CREATE TABLE dept(deptno DECIMAL(2) not null primary key, dname VARCHAR(14),loc VARCHAR(13));

--- SQL operation complete.
>>INSERT INTO dept VALUES(10, 'ACCOUNTING', 'NEW YORK');

--- 1 row(s) inserted.
>>INSERT INTO dept VALUES(20, 'RESEARCH', 'DALLAS');

--- 1 row(s) inserted.
>>INSERT INTO dept VALUES(30, 'SALES', 'CHICAGO');

--- 1 row(s) inserted.
>>INSERT INTO dept VALUES(40, 'OPERATIONS', 'BOSTON');

--- 1 row(s) inserted.
>>
>>bt;

--- SQL operation complete.
>>alter table employee add constraint lock_pk foreign key(deptno) references dept(deptno);

--- SQL operation complete.
>>sh sqlci -i TEST202\(M12769_2\) >> LOG202;
EsgynDB Advanced Conversational Interface 2.7.0
Copyright (c) 2015-2019 Esgyn Corporation
>>?section M12769_2
>>set schema locktest202;

--- SQL operation complete.
>>begin work;

--- SQL operation complete.
>>update employee set deptno = 50 where deptno = 10;

*** ERROR[30052] ROW LEVEL LOCK TIMEOUT ERROR

*** ERROR[8839] Transaction was aborted.

--- 0 row(s) updated.
>>commit;

--- SQL operation complete.
>>
>>exit;

End of MXCI Session

>>commit;

--- SQL operation complete.
>>select deptno from employee where deptno = 50;

--- 0 row(s) selected.
>>select * from employee where deptno = 50;

--- 0 row(s) selected.
>>select deptno from dept;

DEPTNO
------

    10
    20
    30
    40

--- 4 row(s) selected.
>>
>>obey TEST202(M13320);
>>set schema locktest202;

--- SQL operation complete.
>>create table t202_dept(deptno DECIMAL(2) not null primary key, dname VARCHAR(14) ,loc VARCHAR(13));

--- SQL operation complete.
>>alter table t202_dept drop column loc;

--- SQL operation complete.
>>
>>log;
