>>
>>cqd traf_composite_datatype_support 'ON';

--- SQL operation complete.
>>cqd hive_composite_datatype_support 'OFF';

--- SQL operation complete.
>>obey TEST060(tests1);
>>
>>-- array and row constructors
>>select row(10) from dual;

(EXPR)    
----------

(10)      

--- 1 row(s) selected.
>>select array[10] from dual;

(EXPR)          
----------------

[10]            

--- 1 row(s) selected.
>>select row('ab', 10, date '2018-12-07', 1.2e0, interval '10:10' hour to minute)
+>  from dual;

(EXPR)                                                           
-----------------------------------------------------------------

(ab,10,2018-12-07,1.20000000000000000E+000,10:10)                

--- 1 row(s) selected.
>>select array[10, 12.34, 0.0, -23] from dual;

(EXPR)                                                               
---------------------------------------------------------------------

[10,12.34,0,-23]                                             

--- 1 row(s) selected.
>>select array[10, 12.34, 0.0, 4e0] from dual;

(EXPR)
-------------------------------------------------------------------------------------------------------------------------

[1.00000000000000000E+001,1.23400000000000000E+001,0.00000000000000000E+000,4.00000000000000000E+000]                    

--- 1 row(s) selected.
>>select array['ab', cast('cdd' as varchar(3))] from dual;

(EXPR)               
---------------------

[ab,cdd]             

--- 1 row(s) selected.
>>
>>select array[row(10, 'abc'), row(23456, 'a')] from dual;

(EXPR)                                                       
-------------------------------------------------------------

[(10,abc),(23456,a)]                                         

--- 1 row(s) selected.
>>select array[row('ab', 10), row('cdef', -10.2)] from dual;

(EXPR)                                                 
-------------------------------------------------------

[(ab,10),(cdef,-10.2)]                               

--- 1 row(s) selected.
>>
>>select row(array[10,20000000]) from dual;

(EXPR)                                     
-------------------------------------------

([10,20000000])                            

--- 1 row(s) selected.
>>select row('ab', array[1.2, 4.0001], 10) from dual;

(EXPR)                                                   
---------------------------------------------------------

(ab,[1.2,4.0001],10)                                  

--- 1 row(s) selected.
>>
>>-- empty strings
>>select array[''] from dual;

(EXPR)
-----------------------

[?]

--- 1 row(s) selected.
>>select row('') from dual;

(EXPR)
-----------------

(?)

--- 1 row(s) selected.
>>
>>-- cast stmt on array and row constructors
>>select cast(row(1000000) as row(a int)) from dual;

(EXPR)           
-----------------

(1000000)        

--- 1 row(s) selected.
>>select cast(array[10000] as int array[1]) from dual;

(EXPR)                 
-----------------------

[10000]                

--- 1 row(s) selected.
>>
>>select cast(array[10,20] as int array[2]) from dual;

(EXPR)                               
-------------------------------------

[10,20]                              

--- 1 row(s) selected.
>>
>>select cast(row('ab', row('cd')) as row(aa char(2), bb row(b11 char(2))))  
+> from dual;

(EXPR)             
-------------------

(ab,(cd))          

--- 1 row(s) selected.
>>select cast(row('ab', array['cdef']) as row(b10 char(2), b11 char(4) array[1])) 
+> from dual;

(EXPR)                     
---------------------------

(ab,[cdef])                

--- 1 row(s) selected.
>>
>>select cast(row('ab', array[cast('cde' as char(4))]) as row(b10 char(2), b11 char(4) array[1])) 
+> from dual;

(EXPR)                     
---------------------------

(ab,[cde])                 

--- 1 row(s) selected.
>>
>>select cast(array[row('ab', 'cde')] as row(a char(2), b char(3)) array[1]) from dual;

(EXPR)                    
--------------------------

[(ab,cde)]                

--- 1 row(s) selected.
>>
>>select cast(array[row(cast('abc' as char(2)), 'cde')] as row(a char(2), b char(3)) array[1]) from dual;

(EXPR)                    
--------------------------

[(ab,cde)]                

--- 1 row(s) selected.
>>
>>prepare s from select cast(array[row(cast(1 as int), cast('ab' as char(7))), 
+>                                 row(cast(1234 as int), 'gggg   ')]  
+>                           as row(a int, b char(7)) array[2]) from dual;

--- SQL command prepared.
>>
>>select array[null] from dual;

(EXPR)                 
-----------------------

[?]                    

--- 1 row(s) selected.
>>select row(null) from dual;

(EXPR)           
-----------------

(?)              

--- 1 row(s) selected.
>>select array[null, 10, null] from dual;

(EXPR)                        
------------------------------

[?,10,?]                      

--- 1 row(s) selected.
>>select row(10, null, 20) from dual;

(EXPR)                         
-------------------------------

(10,?,20)                      

--- 1 row(s) selected.
>>
>>select cast(row(array[null]) as row(a int array[1])) from dual;

(EXPR)                       
-----------------------------

([?])                        

--- 1 row(s) selected.
>>select cast(row(null) as row(a int)) from dual;

(EXPR)           
-----------------

(?)              

--- 1 row(s) selected.
>>select cast(array[row(null)] as row(a int) array[1]) from dual;

(EXPR)                       
-----------------------------

[(?)]                        

--- 1 row(s) selected.
>>select cast(array[row(20), row(null)] as row(a int) array[2]) from dual;

(EXPR)                                           
-------------------------------------------------

[(20),(?)]                                       

--- 1 row(s) selected.
>>
>>select case when 1 = 1 then row('ab') else null end from dual;

(EXPR)  
--------

(ab)    

--- 1 row(s) selected.
>>
>>-- array expand and truncate
>>select cast(array[10,20,30] as array[10]) from dual;

(EXPR)
---------------------------------------------------------------------------------------------------

[10,20,30,?,?,?,?,?,?,?]                                                                           

--- 1 row(s) selected.
>>select cast(array[10,20,30] as array[2]) from dual;

(EXPR)                     
---------------------------

[10,20]                    

--- 1 row(s) selected.
>>
>>select * from (values(row('ab')))x(a), (values(array[1]))y(b);

A         B               
--------  ----------------

(ab)      [1]             

--- 1 row(s) selected.
>>
>>select composite_extract(row(1, 'ab'), 1) from dual;

(EXPR)
------

     1

--- 1 row(s) selected.
>>select composite_extract(row(1, 'ab'), 2) from dual;

(EXPR)
------

ab    

--- 1 row(s) selected.
>>select composite_extract(array[1,2,3], 2) from dual;

(EXPR)
------

     2

--- 1 row(s) selected.
>>select 1 + composite_extract(row(1, 'ab'), 1) from dual;

(EXPR)
------

     2

--- 1 row(s) selected.
>>select composite_extract(row(1, 'ab'), 1) + 1 from dual;

(EXPR)
------

     2

--- 1 row(s) selected.
>>
>>select cast(array['abcd'] as char(2)) from dual;

*** WARNING[8402] A string overflow occurred during the evaluation of a character expression.

(EXPR)
------

[a    

--- 1 row(s) selected.
>>select cast(array['abcd'] as varchar(20)) from dual;

(EXPR)              
--------------------

[abcd]              

--- 1 row(s) selected.
>>
>>select array[10] || array[30] from dual;

(EXPR)                     
---------------------------

[10,30]                    

--- 1 row(s) selected.
>>select array[10,20] || array[30] from dual;

(EXPR)                              
------------------------------------

[10,20,30]                          

--- 1 row(s) selected.
>>
>>prepare s from select cast(array[cast(? as int)] as largeint array[1]) 
+>   from dual;

--- SQL command prepared.
>>execute s using 10;

(EXPR)                          
--------------------------------

[10]                            

--- 1 row(s) selected.
>>prepare s from select cast(array[cast(? as char(3))] as char(2) array[1])
+>   from dual;

--- SQL command prepared.
>>execute s using 'abc';

(EXPR)        
--------------

[ab]          

--- 1 row(s) selected.
>>prepare s from select array[?] from dual;

--- SQL command prepared.
>>execute s using 'ab';

(EXPR)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[ab]                                                                                                                                                                                                                                                                       

--- 1 row(s) selected.
>>
>>prepare s from select cast(row(cast(? as int)) as row(a1 largeint))
+>   from dual;

--- SQL command prepared.
>>execute s using 10;

(EXPR)                    
--------------------------

(10)                      

--- 1 row(s) selected.
>>prepare s from select cast(row(cast(? as char(3))) as row(a2 char(2)))
+>   from dual;

--- SQL command prepared.
>>execute s using 'abc';

(EXPR)  
--------

(ab)    

--- 1 row(s) selected.
>>prepare s from select row(?) from dual;

--- SQL command prepared.
>>execute s using 'ab';

(EXPR)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(ab)                                                                                                                                                                                                                                                                 

--- 1 row(s) selected.
>>
>>select array[1] from dual union all select array[2] from dual;

(EXPR)            
------------------

[2]               
[1]               

--- 2 row(s) selected.
>>select row('ab') from dual union all select row('cd') from dual;

(EXPR)  
--------

(cd)    
(ab)    

--- 2 row(s) selected.
>>
>>drop view if exists t060v1;

--- SQL operation complete.
>>create view t060v1 as select array['ab'] a, row(10) b  from dual;

--- SQL operation complete.
>>invoke t060v1;

-- Definition of Trafodion view TRAFODION.SCH.T060V1
-- Definition current  Sat Feb 23 21:21:34 2019

  (
    A                                CHAR(2) CHARACTER SET ISO88591 COLLATE
      DEFAULT ARRAY[1] DEFAULT NULL
  , B                                ROW(ROW_1 NUMERIC(2, 0)) DEFAULT NULL
  )

--- SQL operation complete.
>>drop view t060v1;

--- SQL operation complete.
>>
>>create view t060v1 as select row(10) b  from dual union all 
+>                      select row(20) c from dual;

--- SQL operation complete.
>>invoke t060v1;

-- Definition of Trafodion view TRAFODION.SCH.T060V1
-- Definition current  Sat Feb 23 21:21:36 2019

  (
    B                                ROW(ROW_1 NUMERIC(2, 0)) DEFAULT NULL
  )

--- SQL operation complete.
>>drop view t060v1;

--- SQL operation complete.
>>
>>create view t060v1(z) as select row(10) b  from dual union all 
+>                      select row(20) c from dual;

--- SQL operation complete.
>>invoke t060v1;

-- Definition of Trafodion view TRAFODION.SCH.T060V1
-- Definition current  Sat Feb 23 21:21:38 2019

  (
    Z                                ROW(ROW_1 NUMERIC(2, 0)) DEFAULT NULL
  )

--- SQL operation complete.
>>drop view t060v1;

--- SQL operation complete.
>>
>>select cast(row('ab', array['cde']) as row(b10 char(2), b11 char(4) array[1])) 
+> from dual;

(EXPR)                     
---------------------------

(ab,[cde])                 

--- 1 row(s) selected.
>>select cast(array[row('abc', 'cde')] as row(a char(2), b char(3)) array[1]) from dual;

(EXPR)                    
--------------------------

[(ab,cde)]                

--- 1 row(s) selected.
>>prepare s from select cast(array[row(1, 'ab'), row(1234, 'gggg')]  as row(a int,
+> b char(7)) array[2]) from dual;

--- SQL command prepared.
>>
>>
>>obey TEST060(tests1_errors);
>>-- case then/else must match
>>select case when 1 = 1 then row('ab') else array['ab'] end from dual;

*** ERROR[4049] A CASE expression cannot have a result data type of both ROW(CHAR(2) CHARACTER SET ISO88591) and CHAR(2) CHARACTER SET ISO88591 ARRAY[1].

*** ERROR[8822] The statement was not prepared.

>>
>>select composite_extract(row(1, 'ab'), 3) from dual;

*** ERROR[2006] Internal error: assertion failure ((idx >= 1) && (idx <= fieldTypes_->entries())) in file ../common/CompositeType.cpp at line 625.

*** ERROR[8822] The statement was not prepared.

>>select composite_extract(array[1,2,3], 4) from dual;

*** ERROR[3242] This statement is not supported. Reason: Element to be extracted must be between 1 and max elements(3).

--- 0 row(s) selected.
>>
>>select * from (values(array['a']), (array[20]));

*** ERROR[4055] The select lists or tuples must have comparable data types.  CHAR(1) CHARACTER SET ISO88591 ARRAY[1] and NUMERIC(2) SIGNED ARRAY[1] are not comparable.

*** ERROR[8822] The statement was not prepared.

>>select * from (values(array[10,20]), (array['b','a']));

*** ERROR[4055] The select lists or tuples must have comparable data types.  NUMERIC(2) SIGNED ARRAY[2] and CHAR(1) CHARACTER SET ISO88591 ARRAY[2] are not comparable.

*** ERROR[8822] The statement was not prepared.

>>select * from (values(row('a')), (row(1)));

*** ERROR[4055] The select lists or tuples must have comparable data types.  ROW(CHAR(1) CHARACTER SET ISO88591) and ROW(NUMERIC(1) SIGNED) are not comparable.

*** ERROR[8822] The statement was not prepared.

>>select * from (values(row('a',1)), (row('a','b')));

*** ERROR[4055] The select lists or tuples must have comparable data types.  ROW(CHAR(1) CHARACTER SET ISO88591, NUMERIC(1) SIGNED) and ROW(CHAR(1) CHARACTER SET ISO88591, CHAR(1) CHARACTER SET ISO88591) are not comparable.

*** ERROR[8822] The statement was not prepared.

>>select * from (values(row('a')), (array['a']));

*** ERROR[4055] The select lists or tuples must have comparable data types.  ROW(CHAR(1) CHARACTER SET ISO88591) and CHAR(1) CHARACTER SET ISO88591 ARRAY[1] are not comparable.

*** ERROR[8822] The statement was not prepared.

>>
>>-- comp cols cannot be used in a predicate
>>select * from (values(row('ab')))x(a), (values(array[1]))y(b) where x.a = y.b;

*** ERROR[4041] Type ROW(CHAR(2) CHARACTER SET ISO88591) cannot be compared with type NUMERIC(1) SIGNED ARRAY[1].

*** ERROR[8822] The statement was not prepared.

>>select * from (values(row('ab'))) x(a), (values(row('ab'))) y(b) 
+>    where x.a = y.b;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>-- concatenated elements must match
>>select array[10] || array['ab'] from dual;

*** ERROR[3242] This statement is not supported. Reason: ARRAY elements to be concatenated must have compatible types.

*** ERROR[4062] The preceding error actually occurred in function ||.

*** ERROR[8822] The statement was not prepared.

>>
>>-- error: nesting levels exceeded
>>select array[row(array['ab'])] from dual;

*** ERROR[3242] This statement is not supported. Reason: Number of composite nesting levels(4) cannot exceed the max value(3).

*** ERROR[8822] The statement was not prepared.

>>
>>-- overflow error
>>prepare s from select cast(array[cast(? as int)] as smallint array[1]) 
+>   from dual;

--- SQL command prepared.
>>execute s using 10000000;

*** ERROR[8411] A numeric overflow occurred during an arithmetic computation or data conversion. Conversion of Source Type:INTEGER SIGNED(REC_BIN32_SIGNED) Source Value:10000000 to Target Type:SMALLINT SIGNED(REC_BIN16_SIGNED).

*** ERROR[8146] A runtime error occurred during execution of this statement. Reason: Error returned from ExpCompositeCreate::getCompExpr()->eval() method.

--- 0 row(s) selected.
>>
>>-- cannot typecast param as composite type
>>prepare s from select cast(? as row(a int)) from dual;

*** ERROR[3242] This statement is not supported. Reason: Cannot cast param as composite type.

*** ERROR[8822] The statement was not prepared.

>>prepare s from select cast(? as int array[1]) from dual;

*** ERROR[3242] This statement is not supported. Reason: Cannot cast param as composite type.

*** ERROR[8822] The statement was not prepared.

>>
>>-- cannot use composite type in order by or group by
>>select a from (values(array[10]),(array[5])) x(a) group by a;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select a from (values(array[10]),(array[5])) x(a) order by a;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select distinct a from (values(array[10]),(array[5])) x(a);

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select 1 from (select array[1] a from dual order by a) x;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>select array[1] from dual union select array[2] from dual;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select row('ab') from dual union select row('cd') from dual;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>select sum(a) from dual having array[1] = array[1];

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>
>>
>>obey TEST060(tests2_ddl);
>>create table if not exists t060t1
+>(
+>  a1 row(a1 int),
+>  a2 int array[2],
+>  a3 row(a31 int, a32 char(2)) array[2],
+>  a4 row(a30 char(2), a31 int array[2]),
+>  a5 row(a30 row(a30 int, a32 char(2)))
+>);

--- SQL operation complete.
>>invoke t060t1;

-- Definition of Trafodion table TRAFODION.SCH.T060T1
-- Definition of hbase table TRAFODION.SCH.T060T1
-- Definition current  Sat Feb 23 21:21:43 2019

  (
    SYSKEY                           LARGEINT NO DEFAULT NOT NULL NOT DROPPABLE
  , A1                               ROW(A1 INT) DEFAULT NULL
  , A2                               INT ARRAY[2] DEFAULT NULL
  , A3                               ROW(A31 INT, A32 CHAR(2) CHARACTER SET
      ISO88591) ARRAY[2] DEFAULT NULL
  , A4                               ROW(A30 CHAR(2) CHARACTER SET ISO88591,
      A31 INT ARRAY[2]) DEFAULT NULL
  , A5                               ROW(A30 ROW(A30 INT, A32 CHAR(2) CHARACTER
      SET ISO88591)) DEFAULT NULL
  )

--- SQL operation complete.
>>showddl t060t1;

CREATE TABLE TRAFODION.SCH.T060T1
  (
    A1                               ROW(A1 INT) DEFAULT NULL
  , A2                               INT ARRAY[2] DEFAULT NULL
  , A3                               ROW(A31 INT, A32 CHAR(2) CHARACTER SET
      ISO88591) ARRAY[2] DEFAULT NULL
  , A4                               ROW(A30 CHAR(2) CHARACTER SET ISO88591,
      A31 INT ARRAY[2]) DEFAULT NULL
  , A5                               ROW(A30 ROW(A30 INT, A32 CHAR(2) CHARACTER
      SET ISO88591)) DEFAULT NULL
  )
 ATTRIBUTES ALIGNED FORMAT
;

--- SQL operation complete.
>>
>>drop view if exists t060v1;

--- SQL operation complete.
>>create view t060v1 as select * from t060t1;

--- SQL operation complete.
>>showddl t060v1;

CREATE VIEW TRAFODION.SCH.T060V1 AS
  SELECT TRAFODION.SCH.T060T1.A1, TRAFODION.SCH.T060T1.A2,
    TRAFODION.SCH.T060T1.A3, TRAFODION.SCH.T060T1.A4, TRAFODION.SCH.T060T1.A5
    FROM TRAFODION.SCH.T060T1 ;

--- SQL operation complete.
>>select * from t060v1;

--- 0 row(s) selected.
>>
>>drop view if exists t060v2;

--- SQL operation complete.
>>create view t060v2 as select a3.a31 from t060t1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

--- SQL operation failed with errors.
>>showddl t060v2;

*** ERROR[4082] Object TRAFODION.SCH.T060V2 does not exist or is inaccessible.

*** ERROR[8822] The statement was not prepared.

>>select * from t060v2;

*** ERROR[4082] Object TRAFODION.SCH.T060V2 does not exist or is inaccessible.

*** ERROR[8822] The statement was not prepared.

>>
>>alter table t060t1 add column a6 row(a61 int, a62 char(2) array[2]);

--- SQL operation complete.
>>invoke t060t1;

-- Definition of Trafodion table TRAFODION.SCH.T060T1
-- Definition of hbase table TRAFODION.SCH.T060T1
-- Definition current  Sat Feb 23 21:21:49 2019

  (
    SYSKEY                           LARGEINT NO DEFAULT NOT NULL NOT DROPPABLE
  , A1                               ROW(A1 INT) DEFAULT NULL
  , A2                               INT ARRAY[2] DEFAULT NULL
  , A3                               ROW(A31 INT, A32 CHAR(2) CHARACTER SET
      ISO88591) ARRAY[2] DEFAULT NULL
  , A4                               ROW(A30 CHAR(2) CHARACTER SET ISO88591,
      A31 INT ARRAY[2]) DEFAULT NULL
  , A5                               ROW(A30 ROW(A30 INT, A32 CHAR(2) CHARACTER
      SET ISO88591)) DEFAULT NULL
  , A6                               ROW(A61 INT, A62 CHAR(2) CHARACTER SET
      ISO88591 ARRAY[2]) DEFAULT NULL /*added_col*/
  )

--- SQL operation complete.
>>select * from t060t1;

--- 0 row(s) selected.
>>
>>alter table t060t1 drop column a6;

--- SQL operation complete.
>>invoke t060t1;

-- Definition of Trafodion table TRAFODION.SCH.T060T1
-- Definition of hbase table TRAFODION.SCH.T060T1
-- Definition current  Sat Feb 23 21:22:24 2019

  (
    SYSKEY                           LARGEINT NO DEFAULT NOT NULL NOT DROPPABLE
  , A1                               ROW(A1 INT) DEFAULT NULL
  , A2                               INT ARRAY[2] DEFAULT NULL
  , A3                               ROW(A31 INT, A32 CHAR(2) CHARACTER SET
      ISO88591) ARRAY[2] DEFAULT NULL
  , A4                               ROW(A30 CHAR(2) CHARACTER SET ISO88591,
      A31 INT ARRAY[2]) DEFAULT NULL
  , A5                               ROW(A30 ROW(A30 INT, A32 CHAR(2) CHARACTER
      SET ISO88591)) DEFAULT NULL
  )

--- SQL operation complete.
>>select * from t060t1;

--- 0 row(s) selected.
>>
>>drop table if exists t060t2;

--- SQL operation complete.
>>create table t060t2(
+>  a int not null primary key, 
+>  b int array [3],
+>  c row (c1 int, c2 date) array[2], 
+>  d row (d1 int, d2 char(1) character set iso88591),
+>  e char(2));

--- SQL operation complete.
>>showddl t060t2;

CREATE TABLE TRAFODION.SCH.T060T2
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT ARRAY[3] DEFAULT NULL
  , C                                ROW(C1 INT, C2 DATE) ARRAY[2] DEFAULT NULL
  , D                                ROW(D1 INT, D2 CHAR(1) CHARACTER SET
      ISO88591) DEFAULT NULL
  , E                                CHAR(2) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT
;

--- SQL operation complete.
>>drop table if exists t060t2_like;

--- SQL operation complete.
>>create table t060t2_like like t060t2;

--- SQL operation complete.
>>showddl t060t2_like;

CREATE TABLE TRAFODION.SCH.T060T2_LIKE
  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                INT ARRAY[3] DEFAULT NULL
  , C                                ROW(C1 INT, C2 DATE) ARRAY[2] DEFAULT NULL
  , D                                ROW(D1 INT, D2 CHAR(1) CHARACTER SET
      ISO88591) DEFAULT NULL
  , E                                CHAR(2) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , PRIMARY KEY (A ASC)
  )
 ATTRIBUTES ALIGNED FORMAT
;

--- SQL operation complete.
>>select * from t060t2_like;

--- 0 row(s) selected.
>>
>>drop table if exists t060t3;

--- SQL operation complete.
>>create table t060t3 (
+>  a int array[3],
+>  b row(b1 char(2), b2 int) array[2]);

--- SQL operation complete.
>>insert into t060t3 values (array[1], array[row('ab',10), row('cd',200)]);

--- 1 row(s) inserted.
>>insert into t060t3 values (array[11,22], array[row('cd',200)]);

--- 1 row(s) inserted.
>>insert into t060t3 values (array[11,22, null], 
+>              array[row('cd',200), cast(null as row(b char(2), b1 int))]);

--- 1 row(s) inserted.
>>insert into t060t3 values (array[111,222,333], 
+>              array[row(cast(null as char(2)), null), 
+>                        cast(null as row(b char(2), b1 int))]);

--- 1 row(s) inserted.
>>insert into t060t3 values (array[null, null, null], array[row(cast(null as char(2)), null), cast(null as row(b char(2), b1 int))]);

--- 1 row(s) inserted.
>>insert into t060t3 values (array[null, null, null], array[row(cast(null as char(2)), null)]);

--- 1 row(s) inserted.
>>
>>select * from t060t3;

A                                                    B
---------------------------------------------------  -----------------------------------------------------------

[1]                                                  [(ab,10),(cd,200)]                                         
[11,22]                                              [(cd,200)]                                                 
[11,22,?]                                            [(cd,200),?]                                               
[111,222,333]                                        [(?,?),?]                                                  
[?,?,?]                                              [(?,?),?]                                                  
[?,?,?]                                              [(?,?)]                                                    

--- 6 row(s) selected.
>>select a[3] from t060t3;

A_3        
-----------

          ?
          ?
          ?
        333
          ?
          ?

--- 6 row(s) selected.
>>
>>select b[1] from t060t3;

B_1                   
----------------------

(ab,10)               
(cd,200)              
(cd,200)              
(?,?)                 
(?,?)                 
(?,?)                 

--- 6 row(s) selected.
>>select composite_extract(b,1) from t060t3;

(EXPR)                
----------------------

(ab,10)               
(cd,200)              
(cd,200)              
(?,?)                 
(?,?)                 
(?,?)                 

--- 6 row(s) selected.
>>select b[2].b1 from t060t3;

B1
--

cd
? 
? 
? 
? 
? 

--- 6 row(s) selected.
>>
>>-- error
>>select a[4] from t060t3;

*** ERROR[3242] This statement is not supported. Reason: Specified array index(4) is greater than the max array size(3).

*** ERROR[8822] The statement was not prepared.

>>select b.b1 from t060t3;

*** ERROR[3242] This statement is not supported. Reason: Array index must be specified for column B.

*** ERROR[8822] The statement was not prepared.

>>
>>delete from t060t3;

--- 6 row(s) deleted.
>>insert into t060t3 values (array[1], array[row('ab',10)]);

--- 1 row(s) inserted.
>>select * from t060t3;

A                                                    B
---------------------------------------------------  -----------------------------------------------------------

[1]                                                  [(ab,10)]                                                  

--- 1 row(s) selected.
>>select array_length(a), array_length(b) from t060t3;

(EXPR)      (EXPR)    
----------  ----------

         1           1

--- 1 row(s) selected.
>>select a || array[2] from t060t3;

(EXPR)                                                           
-----------------------------------------------------------------

[1,2]                                                            

--- 1 row(s) selected.
>>select b || array[row('cd',20)] from t060t3;

(EXPR)
------------------------------------------------------------------------------------

[(ab,10),(cd,20)]                                                                   

--- 1 row(s) selected.
>>?ignore
>>-- this statement returns errors, comment it out for now.
>>update t060t3 set a = a || array[2], b = b || array[row('cd',20)];
>>select * from t060t3;
>>?ignore
>>
>>obey TEST060(tests2_ddl_errors);
>>-- must be nullable with default NULL
>>create table t060terr(a row(a1 int) not null);

*** ERROR[3242] This statement is not supported. Reason: ROW or ARRAY datatypes must be nullable.

--- SQL operation failed with errors.
>>
>>-- cannot be primary key
>>create table t060terr(a row(a1 int) primary key);

*** ERROR[3242] This statement is not supported. Reason: ROW or ARRAY datatypes must be nullable.

--- SQL operation failed with errors.
>>create table t060terr(a row(a1 int) primary key nullable);

*** ERROR[1541] Use of ROW datatype as a key of the base table or an index is not allowed.

--- SQL operation failed with errors.
>>
>>create index t060t1i1 on t060t1(a1);

*** ERROR[1541] Use of ROW datatype as a key of the base table or an index is not allowed.

--- SQL operation failed with errors.
>>create table t060terr(a row(a1 int) unique);

*** ERROR[1541] Use of ROW datatype as a key of the base table or an index is not allowed.

*** ERROR[1029] Object TRAFODION.SCH.T060TERR could not be created.

--- SQL operation failed with errors.
>>create table t060terr(a row(a1 int) check (a > row(1)));

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[1029] Object TRAFODION.SCH.T060TERR could not be created.

--- SQL operation failed with errors.
>>
>>create table t060terr(a row(a1 int) references t060t1(a1));

*** ERROR[1541] Use of ROW datatype as a key of the base table or an index is not allowed.

*** ERROR[1029] Object TRAFODION.SCH.T060TERR could not be created.

--- SQL operation failed with errors.
>>
>>create table t060terr(a row(a int, a int));

*** ERROR[3242] This statement is not supported. Reason: Duplicate column names are not allowed within a ROW definition.

*** ERROR[8822] The statement was not prepared.

>>
>>obey TEST060(tests2);
>>insert into t060t1 values
+>(
+>  row(13), 
+>  array[1,2], 
+>  array[row(123456, 'ab'), row(-23, 'z')],
+>  row('ab', array[1,2]),
+>  row(row(789, 'cd'))
+>);

--- 1 row(s) inserted.
>>
>>insert into t060t1 values
+>(
+>  row(10), 
+>  array[1.2,2], 
+>  array[row(1234564, ' '), row(-23, 'zzzz')],
+>  row('cd', array[10000,2]),
+>  row(row(789, cast('cd' as varchar(4))))
+>);

--- 1 row(s) inserted.
>>
>>insert into t060t1 values (null, null, null, null, null);

--- 1 row(s) inserted.
>>insert into t060t1 values (
+>       row(null), 
+>       array[null,null], 
+>       array[row(null,cast(null as char(2))), row(null,cast(null as varchar(1)))],
+>       row(cast(null as char(10)), array[null,null]),
+>       row(row(null, cast(null as varchar(4)))));

--- 1 row(s) inserted.
>>
>>select * from t060t1;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

(13)               [1,2]                                  [(123456,ab),(-23,z)]                                        (ab,[1,2])                                        ((789,cd))                  
(10)               [1,2]                                  [(1234564,),(-23,zz)]                                        (cd,[10000,2])                                    ((789,cd))                  
?                  ?                                      ?                                                            ?                                                 ?                           
(?)                [?,?]                                  [(?,?),(?,?)]                                                (?,[?,?])                                         ((?,?))                     

--- 4 row(s) selected.
>>select a1, a1.a1, a2, a2[1], a3, a3[1], a3[1].a31, a4, a4.a30, a4.a31[2],
+>       a5, a5.a30, a5.a30.a30 from t060t1;

A1                 A1           A2                                     A2_1         A3                                                           A3_1                    A31          A4                                                A30  A31_2        A5                            A30                     A30
-----------------  -----------  -------------------------------------  -----------  -----------------------------------------------------------  ----------------------  -----------  ------------------------------------------------  ---  -----------  ----------------------------  ----------------------  -----------

(13)                        13  [1,2]                                            1  [(123456,ab),(-23,z)]                                        (123456,ab)                  123456  (ab,[1,2])                                        ab             2  ((789,cd))                    (789,cd)                        789
(10)                        10  [1,2]                                            1  [(1234564,),(-23,zz)]                                        (1234564,)                  1234564  (cd,[10000,2])                                    cd             2  ((789,cd))                    (789,cd)                        789
?                            ?  ?                                                ?  ?                                                            ?                                 ?  ?                                                 ?              ?  ?                             ?                                 ?
(?)                          ?  [?,?]                                            ?  [(?,?),(?,?)]                                                (?,?)                             ?  (?,[?,?])                                         ?              ?  ((?,?))                       (?,?)                             ?

--- 4 row(s) selected.
>>
>>-- isnull, isnotnull cannot be used on composite types.
>>select * from t060t1 where a1 is null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

?                  ?                                      ?                                                            ?                                                 ?                           

--- 1 row(s) selected.
>>select * from t060t1 where a1 is not null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

(13)               [1,2]                                  [(123456,ab),(-23,z)]                                        (ab,[1,2])                                        ((789,cd))                  
(10)               [1,2]                                  [(1234564,),(-23,zz)]                                        (cd,[10000,2])                                    ((789,cd))                  
(?)                [?,?]                                  [(?,?),(?,?)]                                                (?,[?,?])                                         ((?,?))                     

--- 3 row(s) selected.
>>select * from t060t1 where (a1,a1) is null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

?                  ?                                      ?                                                            ?                                                 ?                           

--- 1 row(s) selected.
>>select * from t060t1 where (a1,a1) is not null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

(13)               [1,2]                                  [(123456,ab),(-23,z)]                                        (ab,[1,2])                                        ((789,cd))                  
(10)               [1,2]                                  [(1234564,),(-23,zz)]                                        (cd,[10000,2])                                    ((789,cd))                  
(?)                [?,?]                                  [(?,?),(?,?)]                                                (?,[?,?])                                         ((?,?))                     

--- 3 row(s) selected.
>>select * from t060t1 where a5.a30 is null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

?                  ?                                      ?                                                            ?                                                 ?                           

--- 1 row(s) selected.
>>
>>-- isnull, isnotnull can be used on primitive fields of composite types
>>select * from t060t1 where a1.a1 is null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

?                  ?                                      ?                                                            ?                                                 ?                           
(?)                [?,?]                                  [(?,?),(?,?)]                                                (?,[?,?])                                         ((?,?))                     

--- 2 row(s) selected.
>>select * from t060t1 where a1.a1 is not null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

(13)               [1,2]                                  [(123456,ab),(-23,z)]                                        (ab,[1,2])                                        ((789,cd))                  
(10)               [1,2]                                  [(1234564,),(-23,zz)]                                        (cd,[10000,2])                                    ((789,cd))                  

--- 2 row(s) selected.
>>select * from t060t1 where a5.a30.a30 is null;

A1                 A2                                     A3                                                           A4                                                A5
-----------------  -------------------------------------  -----------------------------------------------------------  ------------------------------------------------  ----------------------------

?                  ?                                      ?                                                            ?                                                 ?                           

--- 1 row(s) selected.
>>
>>select sum(a1.a1) from t060t1;

(EXPR)              
--------------------

                  23

--- 1 row(s) selected.
>>
>>select a5.a30.a30 from t060t1;

A30        
-----------

        789
        789
          ?
          ?

--- 4 row(s) selected.
>>select cast(a5.a30.a30 as int)  from t060t1;

(EXPR)     
-----------

        789
        789
          ?
          ?

--- 4 row(s) selected.
>>select a3[1].a32 from t060t1;

A32
---

ab 
   
?  
?  

--- 4 row(s) selected.
>>
>>select a2 || a2 from t060t1;

(EXPR)                                                           
-----------------------------------------------------------------

[1,2,1,2]                                                        
[1,2,1,2]                                                        
?                                                                
[?,?,?,?]                                                        

--- 4 row(s) selected.
>>
>>select a4 from t060t1;

A4                                              
------------------------------------------------

(ab,[1,2])                                      
(cd,[10000,2])                                  
?                                               
(?,[?,?])                                       

--- 4 row(s) selected.
>>select a4.a31 from t060t1;

A31                                  
-------------------------------------

[1,2]                                
[10000,2]                            
?                                    
[?,?]                                

--- 4 row(s) selected.
>>select a2 || a4.a31 from t060t1;

(EXPR)                                                           
-----------------------------------------------------------------

[1,2,1,2]                                                        
[1,2,10000,2]                                                    
?                                                                
[?,?,?,?]                                                        

--- 4 row(s) selected.
>>
>>
>>obey TEST060(tests2_errors);
>>
>>-- column syskey is not a composite col
>>select syskey[1] from t060t1;

*** ERROR[4325] Column SYSKEY is not found or is not a composite column. Tables in scope: TRAFODION.SCH.T060T1.  Default schema: TRAFODION.SCH.

*** ERROR[8822] The statement was not prepared.

>>
>>--overflow error
>>insert into t060t1 values
+>(
+>  row(10), 
+>  array[1.2,2], 
+>  array[row(1234564, ' '), row(-23, 'zzzz')],
+>  row('cd', array[10000,2]),
+>  row(row(7899999999999, cast('cd' as varchar(4))))
+>);

*** ERROR[8411] A numeric overflow occurred during an arithmetic computation or data conversion. Conversion of Source Type:LARGEINT(REC_BIN64_SIGNED) Source Value:7899999999999 to Target Type:INTEGER SIGNED(REC_BIN32_SIGNED).

*** ERROR[8146] A runtime error occurred during execution of this statement. Reason: Error returned from ExpCompositeCreate::getCompExpr()->eval() method.

--- 0 row(s) inserted.
>>
>>select a1 from t060t1 group by a1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select a1 from t060t1 group by 1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select a1.a1 from t060t1 group by a1.a1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select a1 from t060t1 group by a1.a1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select a1.a1 from t060t1 group by 1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>select * from t060t1 order by a1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select * from t060t1 order by a1.a1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select * from t060t1 order by a2;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select * from t060t1 order by a2[1];

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>select distinct a1 from t060t1;

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>select distinct a1.a1 from t060t1;

A1         
-----------

         13
         10
          ?

--- 3 row(s) selected.
>>
>>select sum(a1) from t060t1;

*** ERROR[4038] The operand of an AVG or SUM function must be numeric or interval.

*** ERROR[8822] The statement was not prepared.

>>
>>select * from t060t1 where a1 = row(10);

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>select a3[3].a32 from t060t1;

*** ERROR[3242] This statement is not supported. Reason: Specified array index(3) is greater than the max array size(2).

*** ERROR[8822] The statement was not prepared.

>>
>>-- cannot use composite type in predicate list comparison
>>select * from t060t1 where (a1,a1) = (a1,a1);

*** ERROR[4324] A column with composite datatype(ARRAY or ROW) cannot be used in this clause or function.

*** ERROR[8822] The statement was not prepared.

>>
>>-- index must be >= 1
>>select a3[0].a32 from t060t1;

*** ERROR[3242] This statement is not supported. Reason: Invalid array index specified. Value must be > 0.

*** ERROR[8822] The statement was not prepared.

>>select a3[-1].a32 from t060t1;

*** ERROR[15001] A syntax error occurred at or before: 
select a3[-1].a32 from t060t1;
          ^ (11 characters from start of SQL statement)

*** ERROR[8822] The statement was not prepared.

>>
>>
>>obey TEST060(tests_unnest);
>>drop table if exists t060t1 cascade;

--- SQL operation complete.
>>create table t060t1 (a int primary key, b char(3) array[3],
+>                     c row(c1 int, c2 varchar(5)) array[2]);

--- SQL operation complete.
>>insert into t060t1 values (1, array['ab', 'cd', 'efg'],
+>                           array[row(10, 'xyz'), row(200, ' ')]);

--- 1 row(s) inserted.
>>insert into t060t1 values (2, array['aaa', 'b'],
+>                           array[row(20, 'xyz'), row(30, 'zz')]);

--- 1 row(s) inserted.
>>insert into t060t1 values (3, null,  null);

--- 1 row(s) inserted.
>>
>>select * from t060t1;

A            B                            C
-----------  ---------------------------  -----------------------------------------------------------------

          1  [ab,cd,efg]                  [(10,xyz),(200,)]                                                
          2  [aaa,b]                      [(20,xyz),(30,zz)]                                               
          3  ?                            ?                                                                

--- 3 row(s) selected.
>>select * from unnest(t060t1, t060t1.b) x;

B  
---

ab 
cd 
efg
aaa
b  

--- 5 row(s) selected.
>>select * from unnest(t060t1, c) x;

C1                    C2   
--------------------  -----

                  10  xyz  
                 200       
                  20  xyz  
                  30  zz   

--- 4 row(s) selected.
>>select z.a, x.* from t060t1 as z lateral view unnest(b) x;

A            B  
-----------  ---

          1  ab 
          1  cd 
          1  efg
          2  aaa
          2  b  

--- 5 row(s) selected.
>>select z.a, x.* from t060t1 as z lateral view outer unnest(b) x;

A            B  
-----------  ---

          1  ab 
          1  efg
          1  cd 
          2  aaa
          2  b  
          3  ?  

--- 6 row(s) selected.
>>select z.a, x.* from t060t1 as z lateral view unnest(c) x;

A            C1                    C2   
-----------  --------------------  -----

          1                    10  xyz  
          1                   200       
          2                    20  xyz  
          2                    30  zz   

--- 4 row(s) selected.
>>select z.a, x.*,y.* from t060t1 as z lateral view unnest(b) x lateral view unnest(c) y;

A            B    C1                    C2   
-----------  ---  --------------------  -----

          1  cd                     10  xyz  
          1  cd                    200       
          1  ab                     10  xyz  
          1  ab                    200       
          2  b                      20  xyz  
          2  b                      30  zz   
          2  aaa                    20  xyz  
          2  aaa                    30  zz   
          1  efg                    10  xyz  
          1  efg                   200       

--- 10 row(s) selected.
>>select z.a, x.*,y.* from t060t1 as z lateral view unnest(c) x lateral view unnest(c) y;

A            C1                    C2     C1                    C2   
-----------  --------------------  -----  --------------------  -----

          2                    20  xyz                      20  xyz  
          2                    30  zz                       20  xyz  
          1                    10  xyz                      10  xyz  
          1                   200                           10  xyz  
          1                    10  xyz                     200       
          1                   200                          200       
          2                    20  xyz                      30  zz   
          2                    30  zz                       30  zz   

--- 8 row(s) selected.
>>select z.a, x.*,y.* from t060t1 as z lateral view unnest(c) x(cc1,cc2) lateral view unnest(c) y(dd1,dd2);

A            CC1                   CC2    DD1                   DD2  
-----------  --------------------  -----  --------------------  -----

          1                    10  xyz                     200       
          1                   200                          200       
          1                    10  xyz                      10  xyz  
          1                   200                           10  xyz  
          2                    20  xyz                      20  xyz  
          2                    30  zz                       20  xyz  
          2                    20  xyz                      30  zz   
          2                    30  zz                       30  zz   

--- 8 row(s) selected.
>>
>>select z.a, x.* from t060t1 as z lateral view unnest(b, show pos) x;

A            _POS_                 B  
-----------  --------------------  ---

          1                     1  ab 
          1                     2  cd 
          1                     3  efg
          2                     1  aaa
          2                     2  b  

--- 5 row(s) selected.
>>select z.a, x.* from t060t1 as z lateral view unnest(b, show pos) x 
+>  where "_POS_" = 3;

A            _POS_                 B  
-----------  --------------------  ---

          1                     3  efg

--- 1 row(s) selected.
>>
>>select z.a, x."_POS_" from t060t1 as z lateral view outer unnest(b, show pos) x order by 2;

A            _POS_               
-----------  --------------------

          2                     1
          1                     1
          2                     2
          1                     2
          1                     3
          3                     ?

--- 6 row(s) selected.
>>select z.a, x."_POS_" from t060t1 as z lateral view outer unnest(b, show pos) x 
+>  where "_POS_" = 3 order  by 2;

A            _POS_               
-----------  --------------------

          1                     3

--- 1 row(s) selected.
>>select z.a, x."_POS_" from t060t1 as z lateral view outer unnest(b, show pos) x 
+>  where "_POS_" is null order  by 2;

A            _POS_               
-----------  --------------------

          3                     ?

--- 1 row(s) selected.
>>
>>cqd hive_array_index_mode 'ON';

--- SQL operation complete.
>>select b[0], b[1], b[2] from t060t1 order by 1;

B_0  B_1  B_2
---  ---  ---

aaa  b    ?  
ab   cd   efg
?    ?    ?  

--- 3 row(s) selected.
>>select z.a, x."_POS_" from t060t1 as z lateral view outer unnest(b, show pos) x order by 2;

A            _POS_               
-----------  --------------------

          2                     0
          1                     0
          2                     1
          1                     1
          1                     2
          3                     ?

--- 6 row(s) selected.
>>cqd hive_array_index_mode reset;

--- SQL operation complete.
>>
>>drop table if exists tarr8;

--- SQL operation complete.
>>create table tarr8 (a int primary key, b row(b1 int) array[2]);

--- SQL operation complete.
>>insert into tarr8 select 10, array[row(10), row(20)] from dual;

--- 1 row(s) inserted.
>>insert into tarr8 select 20, array[row(null), row(30)] from dual;

--- 1 row(s) inserted.
>>insert into tarr8 values (30, null);

--- 1 row(s) inserted.
>>insert into tarr8 select 40, array[cast(null as row(a1 int)), row(50)] from dual;

--- 1 row(s) inserted.
>>select * from tarr8;

A            B                                                
-----------  -------------------------------------------------

         10  [(10),(20)]                                      
         20  [(?),(30)]                                       
         30  ?                                                
         40  [?,(50)]                                         

--- 4 row(s) selected.
>>
>>select * from tarr8 lateral view outer unnest(b) x;

A            B                                                  B1
-----------  -------------------------------------------------  --------------------

         10  [(10),(20)]                                                          10
         10  [(10),(20)]                                                          20
         20  [(?),(30)]                                                            ?
         20  [(?),(30)]                                                           30
         30  ?                                                                     ?
         40  [?,(50)]                                                              ?
         40  [?,(50)]                                                             50

--- 7 row(s) selected.
>>select b,x.* from tarr8 lateral view outer unnest(b) x;

B                                                  B1                  
-------------------------------------------------  --------------------

[(10),(20)]                                                          10
[(10),(20)]                                                          20
[(?),(30)]                                                            ?
[(?),(30)]                                                           30
?                                                                     ?
[?,(50)]                                                              ?
[?,(50)]                                                             50

--- 7 row(s) selected.
>>select b,x.* from tarr8 lateral view outer unnest(b) x where b is null;

B                                                  B1                  
-------------------------------------------------  --------------------

?                                                                     ?

--- 1 row(s) selected.
>>select b,x.* from tarr8 lateral view outer unnest(b) x where b is not null;

B                                                  B1                  
-------------------------------------------------  --------------------

[(10),(20)]                                                          10
[(10),(20)]                                                          20
[(?),(30)]                                                            ?
[(?),(30)]                                                           30
[?,(50)]                                                              ?
[?,(50)]                                                             50

--- 6 row(s) selected.
>>select b,x.* from tarr8 lateral view unnest(b) x where x.b1 is null;

B                                                  B1                  
-------------------------------------------------  --------------------

[(?),(30)]                                                            ?
[?,(50)]                                                              ?

--- 2 row(s) selected.
>>select b,x.* from tarr8 lateral view outer unnest(b) x where x.b1 is null;

B                                                  B1                  
-------------------------------------------------  --------------------

[(?),(30)]                                                            ?
?                                                                     ?
[?,(50)]                                                              ?

--- 3 row(s) selected.
>>select b,x.* from tarr8 lateral view outer  unnest(b) x where x.b1 is not null;

B                                                  B1                  
-------------------------------------------------  --------------------

[(10),(20)]                                                          10
[(10),(20)]                                                          20
[(?),(30)]                                                           30
[?,(50)]                                                             50

--- 4 row(s) selected.
>>
>>select cast(array[cast(null as row(a1 int))] as row(b1 int) array[1]) from dual;

(EXPR)                       
-----------------------------

[?]                          

--- 1 row(s) selected.
>>
>>-- needs to be fixed, should display null instead of 0
>>select cast(array[cast(null as row(a1 int))] as row(b1 int) array[2]) from dual;

(EXPR)                                           
-------------------------------------------------

[(0)]                                            

--- 1 row(s) selected.
>>
>>
>>log;
