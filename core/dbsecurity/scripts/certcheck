#!/bin/bash

# @@@ START COPYRIGHT @@@
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
# @@@ END COPYRIGHT @@@
#

usage ()
{
   echo " Usage: certcheck "
   echo "  [ active | all ] "
   echo "     Default is active"
   echo
}

function validateSS()
{
       #Checking validity of self-signed certificate
       if [[ -f "$CERTDIR/server.crt" ]]; then
             echo "  Validity of self signed certificate : " `openssl x509 -enddate -noout -in $CERTDIR/server.crt |cut -f2 -d"="`
       fi
}

function validateCA()
{
       #Checking validity of ca-signed certificate if it exists
       if [[ -f "$HOME/cacerts/server.crt" ]]; then
             echo "  Validity of ca signed certificate   : " `openssl x509 -enddate -noout -in $HOME/cacerts/server.crt |cut -f2 -d"="`
       fi
}

CLUSTNAME=`echo $CLUSTERNAME`
if (test -n "${CLUSTNAME}"); then
  CERTDIR=$HOME/sqcert
else 
  CERTDIR=$TRAF_VAR/sqcert
fi

if [ $# -lt 1 ]
then
    options=active
else 
    options=$1
fi

echo
case $options in 
active)
   if [[ -z $SQCERT_DIR ]]; then
      validateSS
   else
      validateCA
   fi
   ;;

all)
   validateSS
   validateCA
   ;;

-h | -help)
   usage; exit 1;
   ;;

*) usage; exit 1;
esac
echo
