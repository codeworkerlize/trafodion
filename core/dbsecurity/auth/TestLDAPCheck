#
# @@@ START COPYRIGHT @@@
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
# @@@ END COPYRIGHT @@@
#
# ============================================================================
# TestLDAPCheck - tests the ldapcheck utility
#
# to run:  TestLDAPCheck > outfile
# to verify:  compare outfile to TestLDAPCheck.exp
#
# Prerequisite - need to have a special configuration file
# replace .traf_authentication_config with TestLDAPConfig
# ============================================================================

echo "-----------------------------"
echo " test user search            "
echo " all searches succeed        "
echo "-----------------------------"
echo

echo "*** Search user defined in multiple config - no verbose"
echo "ldapcheck --username=sentry_user1"
ldapcheck --username=sentry_user1

echo
echo "*** Search user defined in multiple config - verbose returns multiple sections"
echo "ldapcheck --username=sentry_user1 --verbose"
ldapcheck --username=sentry_user1 --verbose

echo
echo "*** Search user defined in multiple config - specify config number"
echo "ldapcheck --username=sentry_user1 --confignumber=3 --verbose"
ldapcheck --username=sentry_user1 --confignumber=3 --verbose

echo
echo "*** Search user defined in multiple config - specify config name"
echo "ldapcheck --username=sentry_user1 --configname=ad --verbose"
ldapcheck --username=sentry_user1 --configname=ad --verbose

echo
echo "*** Search user defined in only one config - no verbose"
echo "ldapcheck --username=ldap2_user1 "
ldapcheck --username=ldap2_user1 

echo
echo "*** Search user defined in only one config - verbose does not return multiple configs event"
echo "ldapcheck --username=ldap2_user1 --verbose"
ldapcheck --username=ldap2_user1 --verbose

echo
echo "-----------------------------"
echo " test user authentications   "
echo " all authentications succeed "
echo "-----------------------------"

echo
echo "*** Authenticate user defined in multiple config - no verbose"
echo "ldapcheck --username=sentry_user1 --password=traf123"
ldapcheck --username=sentry_user1 --password=traf123

echo
echo "*** Authenticate user defined in multiple config - verbose returns multiple sections"
echo "ldapcheck --username=sentry_user1 --password=traf123 --verbose"
ldapcheck --username=sentry_user1 --password=traf123 --verbose

echo
echo "*** Authenticate user defined in multiple config - specify config number"
echo "ldapcheck --username=sentry_user1 --password=traf123 --confignumber=3 --verbose"
ldapcheck --username=sentry_user1 --password=traf123 --confignumber=3 --verbose

echo
echo "*** Authenticate user defined in multiple config - specify config name"
echo "ldapcheck --username=sentry_user1 --password=traf123 --configname=ad --verbose"
ldapcheck --username=sentry_user1 --password=traf123 --configname=ad --verbose

echo
echo "*** Authenticate user defined in single config - no verbose"
echo "ldapcheck --username=ldap2_user1 --password=traf123"
ldapcheck --username=ldap2_user1 --password=traf123 

echo
echo "*** Authenticate user defined in single config - verbose does not return multiple configs event"
echo "ldapcheck --username=ldap2_user1 --password=traf123 --verbose"
ldapcheck --username=ldap2_user1 --password=traf123 --verbose
echo
echo "-----------------------------"
echo " test group searches         "
echo " all searches succeed        "
echo "-----------------------------"

echo
echo "*** Search group defined in multiple configs, no verbose"
echo "ldapcheck --groupname=sentry_managers"
ldapcheck --groupname=sentry_managers

echo
echo "*** Search group defined in multiple configs, verbose"
echo "ldapcheck --groupname=sentry_managers --verbose"
ldapcheck --groupname=sentry_managers --verbose

echo
echo "*** Search group defined in multiple configs, specify config name"
echo "ldapcheck --groupname=sentry_managers --configname=ldap1  --verbose"
ldapcheck --groupname=sentry_managers --configname=ldap1  --verbose

echo
echo "*** Search group defined in multiple configs, specify config number"
echo "ldapcheck --groupname=sentry_managers --confignumber=1  --verbose"
ldapcheck --groupname=sentry_managers --confignumber=1  --verbose

echo
echo "*** Search group defined in one config, verbose"
echo "ldapcheck --groupname=sentry_users  --verbose"
ldapcheck --groupname=sentry_users  --verbose

echo
echo "-----------------------------"
echo " negative tests              "
echo " all authentications fail    "
echo "-----------------------------"

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --username=invalidName --verbose"
ldapcheck --username=invalidName --verbose

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --username=sentry_user1 --password=badpw --verbose"
ldapcheck --username=sentry_user1 --password=badpw --verbose

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --username=sentry_user1 --password=badpw --configname=ad --verbose"
ldapcheck --username=sentry_user1 --password=badpw --configname=ad --verbose

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --username=ldap2_user1 --password=traf123 --configname=ad --verbose"
ldapcheck --username=ldap2_user1 --password=traf123 --configname=ad --verbose

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --username=ldap2_user1 --password=traf123 --confignumber=1 --verbose"
ldapcheck --username=ldap2_user1 --password=traf123 --confignumber=1 --verbose

echo
echo "*** Unexpected error returned from LDAP - Invalid configuration number 5 specified"
echo "ldapcheck --username=sentry_user1 --confignumber=5 --verbose"
ldapcheck --username=sentry_user1 --confignumber=5 --verbose

echo
echo "*** Unexpected error returned from LDAP, Invalid configuration name 'something' specified"
echo "ldapcheck --username=sentry_user1 --configname=something --verbose"
ldapcheck --username=sentry_user1 --configname=something --verbose

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --groupname=invalidname --verbose"
ldapcheck --groupname=invalidname --verbose

echo
echo "*** Invalid username/groupname or password"
echo "ldapcheck --groupname=sentry_admins, --configname=ldap2 --verbose"
ldapcheck --groupname=sentry_admins, --configname=ldap2 --verbose

echo
echo "*** Unexpected error returned from LDAP, Invalid configuration name 'abc' specified"
echo "ldapcheck --groupname=sentry_managers --configname=abc --verbose"
ldapcheck --groupname=sentry_managers --configname=abc --verbose

echo
echo "*** Unexpected error returned from LDAP, Invalid configuration number 10 specified"
echo "ldapcheck --groupname=sentry_managers --confignumber=10 --verbose"
ldapcheck --groupname=sentry_managers --confignumber=10 --verbose

